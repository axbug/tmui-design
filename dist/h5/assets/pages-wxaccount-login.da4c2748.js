import{d as e,r as t,o,a as r,w as l,b as a,j as s,p as i,q as u,t as n,v as d,x as m,i as f}from"./index-6b165856.js";import{t as p}from"./tm-app.d6cf2f93.js";import{t as c}from"./tm-sheet.3639b36a.js";import{t as g}from"./tm-text.6c910eb0.js";import{t as _}from"./tm-avatar.c34903e3.js";import{t as h}from"./tm-button.80fc9b3b.js";import{t as x}from"./tm-segtab.9ff18f12.js";import{t as v}from"./tm-input.f9dbb6fc.js";import{_ as b,a as j}from"./tm-form-item.vue_vue_type_script_setup_true_lang.a53b7bb5.js";import"./tm-icon.65b53dc0.js";import"./tm-divider.vue_vue_type_script_setup_true_lang.cbbfcb4c.js";const k=e({__name:"login",setup(e){const k=t(1),V=t({user:"",password:""});function w(e){return uni.$tm.u.isEmail(e)}function y(e){i({success:t=>{if("login:ok"!=t.errMsg)return void u({title:t.errMsg});let o=t.code;n({title:"...",mask:!0}),uni.$tm.fetch.post("https://jx2d.cn/tmui/loginuser/",{code:o,userInfo:encodeURIComponent(e.rawData)}).then((e=>{d();const t=e.data;if(0!=t.code)return u({title:"失败，请重试"}),void uni.$tm.u.delCookie("token");uni.$tm.u.setCookie("token",t.data.token),u({title:"登录成功",mask:!0}),setTimeout((function(){m({})}),1300)})).catch((e=>{d(),console.error(e),u({title:"授权失败"})}))},fail:e=>{u({title:"授权login失败"}),rej(e)}})}return(e,t)=>{const i=f;return o(),r(p,{text:!1,color:"white",darkColor:"rgb(20, 20, 20)"},{default:l((()=>[a(c,{margin:[0,0],padding:[32,32],_class:"flex "},{default:l((()=>[a(x,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=e=>k.value=e),width:686,list:[{id:1,text:"微信授权"},{id:2,text:"帐户登录"}],defaultValue:k.value},null,8,["modelValue","defaultValue"]),a(i,{class:"mt-32"},{default:l((()=>[1==k.value?(o(),r(i,{key:0},{default:l((()=>[a(i,{class:"flex-center flex mb-32"},{default:l((()=>[a(_,{border:2,img:"https://picsum.photos/200/300",color:"grey",text:"",size:180,round:25})])),_:1}),a(h,{height:100,round:24,block:"",onGetUserInfo:y,"open-type":"getUserProfile",label:"授权登录"}),a(i,{class:"px-32 text-align-center"},{default:l((()=>[a(g,{"font-size":22,label:"本小程序不会使用到你任何关联的隐私信息，只会获取唯一身份标识。"})])),_:1})])),_:1})):s("v-if",!0),2==k.value?(o(),r(i,{key:1},{default:l((()=>[a(i,{class:"flex-center flex mb-32"},{default:l((()=>[a(_,{border:2,img:"https://picsum.photos/200/300",color:"grey",text:"",size:180,round:25})])),_:1}),a(b,{margin:[0,0],modelValue:V.value,"onUpdate:modelValue":t[1]||(t[1]=e=>V.value=e),border:!1},{default:l((()=>[a(j,{requiredTitleChangeColor:"",showError:!1,field:"user",rules:[{required:!0,message:"帐户验证失败",validator:w}]},{default:l((()=>[a(v,{outlined:"",inputPadding:[36,0],prefix:"tmicon-user-fill",placeholder:"帐户名称",round:24,height:100})])),_:1},8,["rules"]),a(j,{requiredTitleChangeColor:"",showError:!1,field:"password",rules:[{required:!0,message:"请输入密码"}]},{default:l((()=>[a(v,{outlined:"",inputPadding:[36,0],prefix:"tmicon-lock-fill",placeholder:"帐户密码",margin:[0,24],round:24,height:100})])),_:1}),a(j,null,{default:l((()=>[a(h,{round:24,"form-type":"submit",block:"",height:100,label:"邮箱登录(未开放)"})])),_:1})])),_:1},8,["modelValue"]),a(i,{class:"px-32 text-align-center"},{default:l((()=>[a(g,{"font-size":22,label:"本小程序不会使用到你任何关联的隐私信息，只会获取唯一身份标识。"})])),_:1})])),_:1})):s("v-if",!0)])),_:1})])),_:1})])),_:1})}}});export{k as default};
