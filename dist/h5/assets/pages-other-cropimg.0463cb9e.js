import{d as e,r as a,I as l,p as u,m as t,S as v,o as s,a as n,w as o,b as i,U as r,k as c,n as x,O as h,u as p,V as f,g as d,W as y,t as m,T as g,X as w,j as b,H as $,i as I,_}from"./index-5c06cf16.js";import{t as k}from"./tm-app.20954b06.js";import{t as E}from"./tm-text.fdd4f0a8.js";const M=_(e({__name:"tm-cropimg",props:{url:{type:String,default:""},width:{type:Number,default:150},height:{type:Number,default:150}},emits:["confirm","cance"],setup(e,{emit:_}){var k;const M=e,T=(null==(k=d())?void 0:k.proxy)??null,X=a(M.url),{safeArea:H,windowWidth:P,windowHeight:Y,statusBarHeight:W}=l(),j=(null==H?void 0:H.width)||P;let C=(null==H?void 0:H.height)??Y-44;const F=a({px:0,py:0,px2:0,py2:0,xy:0}),L=a({w:M.width,h:M.height,x:0,y:0}),N=a({scale:1,oldscale:1,center:[0,0],sourceImgWidth:0,sourceImgHeight:0,w:0,h:0,x:0,y:0});let S=a(!1),V=0,z=a(!1),A=null;function B(e){if(!X.value)return;S.value=!0;let a=e.touches[0],l=e.touches[1];"mousedown"==e.type&&(a=e),V=function(e,a){if(e>=L.value.x-15&&e<=L.value.x+15&&a>=L.value.y&&a<=L.value.y+L.value.h)return 1;if(e>=L.value.x&&e<=L.value.w&&a>=L.value.y-15&&a<=L.value.y+15)return 1;if(e>=L.value.x+L.value.w-15&&e<=L.value.x+L.value.w+15&&a>=L.value.y&&a<=L.value.y+L.value.h)return 1;if(e>=L.value.x&&e<=L.value.x+L.value.w&&a>=L.value.y+L.value.h-15&&a<=L.value.y+L.value.h+15)return 1;return 0}(a.pageX,a.pageY),0==V?(F.value.px=a.pageX-N.value.x,F.value.py=a.pageY-N.value.y):(F.value.px=a.pageX-L.value.x,F.value.py=a.pageY-L.value.y),l&&(F.value.px2=l.pageX,F.value.py2=l.pageY),N.value.oldscale=N.value.scale}function O(e){if(!X.value)return;let a=e.touches[0];e.touches[1],"mousedown"==e.type&&(a=e),S.value&&(0==V?(N.value.x=a.pageX-F.value.px,N.value.y=a.pageY-F.value.py):(L.value.x=a.pageX-F.value.px,L.value.y=a.pageY-F.value.py))}function U(e){X.value&&(S.value=!1,z.value=!1,L.value.x<=12&&(L.value.x=12),L.value.x>=j-L.value.w-12&&(L.value.x=j-L.value.w-12),L.value.y<=12&&(L.value.y=12),L.value.y>=C-L.value.h-90&&(L.value.y=C-L.value.h-90),N.value.x>=L.value.x&&(N.value.x=L.value.x),N.value.x+N.value.w<=L.value.x+L.value.w&&(N.value.x=L.value.x-(N.value.w-L.value.w)),N.value.y>=L.value.y&&(N.value.y=L.value.y),N.value.y+N.value.h<=L.value.y+L.value.h&&(N.value.y=L.value.y-(N.value.h-L.value.h)))}function q(){y({count:1,success(e){let a=e.tempFilePaths;1==a.length&&(X.value=a[0],N.value.scale=1,N.value.oldscale=1)}})}function D(e){const{width:a,height:l}=e.detail;N.value.sourceImgWidth=a,N.value.sourceImgHeight=l,function(){N.value.x=L.value.x;let e=L.value.w,a=e/(N.value.sourceImgWidth/N.value.sourceImgHeight);N.value.h=a,N.value.w=e,N.value.h<L.value.h&&(N.value.h=L.value.h,N.value.w=N.value.h*(e/a));N.value.y=-(N.value.h-L.value.h)/2+L.value.y,N.value.center=[N.value.w/2,N.value.h/2]}()}function G(e){console.log(e)}function J(){if(!X.value)return void m({title:"未选择",icon:"none"});let e=Math.abs(N.value.x-L.value.x),a=Math.abs(N.value.y-L.value.y);A.drawImage(X.value,-e,-a,N.value.w,N.value.h),A.draw(!1,(e=>{console.log("绘制成功 "),g({canvasId:"imgid",success(e){_("confirm",e.tempFilePath)}},T)}))}return u((()=>{t((function(){setTimeout((function(){A=v("imgid",T)}),50)}))})),function(){let e=(j-L.value.w)/2,a=(C-L.value.h)/2;L.value.x=e,L.value.y=a}(),(e,a)=>{const l=w,u=b,t=$,v=I;return s(),n(u,{onLongpress:a[1]||(a[1]=()=>{}),onTouchstart:B,onTouchmove:f(O,["stop","prevent"]),onTouchend:U,onTouchcancel:U,onMousedown:B,onMousemove:f(O,["stop","prevent"]),onMouseup:U,onMouseleave:U,class:"relative overflow",style:x([{width:`${p(j)}px`,height:`${p(C)}px`,background:"#000000"}])},{default:o((()=>[X.value?c("v-if",!0):(s(),n(u,{key:0,class:"flex flex-center py-24"},{default:o((()=>[i(l,{style:{"font-size":"24rpx",color:"white"}},{default:o((()=>[r("请选择选择图片才可操作")])),_:1})])),_:1})),i(t,{id:"imgid","canvas-id":"imgid",class:"l-0 t-0",style:x([{width:`${L.value.w}px`,height:`${L.value.h}px`,transform:"translate(-1000px,-1000px)"}])},null,8,["style"]),c(" transform: `translate(${imgPos.x}px,${imgPos.y}px) scale(${imgPos.scale},${imgPos.scale})` "),c(' <image v-if="url" :src="url"></image> '),X.value?(s(),n(v,{key:1,onError:G,class:h(["absolute l-0 t-0",[p(S)?"opacity-10":"ani opacity-5"]]),userInteractionEnabled:!1,onLoad:D,src:X.value,style:x([{width:`${N.value.w||1}px`,height:`${N.value.h||1}px`,transform:X.value?`translate(${N.value.x}px,${N.value.y}px) scale(${N.value.scale},${N.value.scale})`:"translate(-1000px,-1000px)","transform-origin":`${N.value.center[0]}px ${N.value.center[1]}px`}])},null,8,["class","src","style"])):c("v-if",!0),c(" \t\t   "),i(u,{class:h([[p(S)?"":"ani"],"absolute l-0 t-0 rect"]),userInteractionEnabled:!1,style:x([{width:L.value.w+"px",height:L.value.h+"px",transform:`translate(${L.value.x}px,${L.value.y}px)`}])},null,8,["class","style"]),i(u,{class:"absolute l-0 b-0",style:x({width:`${p(j)}px`,height:"80px"})},{default:o((()=>[c(' \t<view class="flex-center mb-24">\r\n\t\t\t\t<tm-slider @change="scaleChange" :width="600" :max=\'3\' :min=\'1\'></tm-slider>\r\n\t\t\t</view> '),i(u,{class:"flex-row flex flex-row-center-between"},{default:o((()=>[c(" 翻转 "),c(' <view class="flex-1 flex flex-center">\r\n\t\t\t\t\t<tm-text :userInteractionEnabled="false" color="white" label="旋转"></tm-text>\r\n\t\t\t\t</view> '),c(" 取消 "),i(u,{onClick:a[0]||(a[0]=e=>_("cance")),class:"flex-1 flex flex-center"},{default:o((()=>[i(E,{userInteractionEnabled:!1,color:"white",label:"取消"})])),_:1}),c(" 选择图片 "),i(u,{onClick:q,class:"flex-1 flex flex-center"},{default:o((()=>[i(E,{userInteractionEnabled:!1,color:"white",label:"选择图片"})])),_:1}),c(" 确认 "),i(u,{onClick:J,class:"flex-1 flex flex-center"},{default:o((()=>[i(E,{userInteractionEnabled:!1,color:"white",label:"确认"})])),_:1})])),_:1})])),_:1},8,["style"])])),_:1},8,["onTouchmove","onMousemove","style"])}}}),[["__scopeId","data-v-f09629f2"]]),T=e({__name:"cropimg",setup:e=>(e,a)=>(s(),n(k,null,{default:o((()=>[i(M)])),_:1}))});export{T as default};
