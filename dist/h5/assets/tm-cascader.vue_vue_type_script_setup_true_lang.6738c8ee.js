import{d as e,g as l,P as t,c as a,r as o,ad as r,o as u,a as n,w as i,b as c,u as f,k as d,V as s,O as v,m as h,j as m,e as p,F as y,f as g,n as w,$ as x,p as C,at as b,R as k,N as T,v as _,x as A}from"./index-5c06cf16.js";import{t as S}from"./tm-text.fdd4f0a8.js";import{t as V}from"./tm-icon.5716c798.js";import{t as $}from"./tm-sheet.2873fe67.js";const j=e({__name:"node-cell",props:{followTheme:{type:[Boolean,String],default:!0},data:{type:Object,default:()=>{},required:!0},color:{type:String,default:"primary"},level:{type:Number,default:0}},emits:["click"],setup(e,{emit:p}){var y;const g=e,w=(null==(y=l())?void 0:y.proxy)??null;let x=null==w?void 0:w.$parent;for(;x&&"tmCascader"!=(null==x?void 0:x.tmCascaderName)&&x;)x=(null==x?void 0:x.$parent)??null;const C=t("tmCascaderValue",a((()=>[]))),b=a((()=>g.data)),k=o("");r((()=>function(){let e=C.value.filter((e=>e==b.value.id));k.value=e.length>0?e[0]:""}()));const T=a((()=>k.value==b.value.id));function _(){var e,l,t;b.value.disabled||("object"==typeof(null==(e=b.value)?void 0:e.children)&&Array.isArray(null==(l=b.value)?void 0:l.children)&&(null==(t=b.value)?void 0:t.children.length)>0?null==x||x.addActiveIndex(g.level+1):h((()=>{null==x||x.endSelected()})),null==x||x.pushValue(b.value,g.level,b.value.id),p("click"))}return(e,l)=>{const t=m;return u(),n(t,{onClick:s(_,["stop"]),class:v(["flex px-24 py-24 border-b-1 flex-col-full",[f(b).disabled?"opacity-5":""]])},{default:i((()=>[c(t,{userInteractionEnabled:!1,class:"flex flex-row flex-between"},{default:i((()=>[c(S,{followTheme:!!f(T)&&g.followTheme,color:f(T)?g.color:"",label:f(b).text},null,8,["followTheme","color","label"]),c(t,{"font-size":30,class:"flex flex-row flex-row-center-end"},{default:i((()=>[f(T)?(u(),n(V,{key:0,followTheme:!!f(T)&&g.followTheme,"font-size":28,color:f(T)?g.color:"",name:"tmicon-check"},null,8,["followTheme","color"])):d("v-if",!0),!f(T)&&f(b).children?(u(),n(V,{key:1,"font-size":22,name:"tmicon-angle-right",color:"grey-1"})):d("v-if",!0)])),_:1})])),_:1})])),_:1},8,["onClick","class"])}}}),N=e({__name:"base-cascader",props:{followTheme:{type:[Boolean,String],default:!0},data:{type:Array,default:()=>[],required:!0},height:{type:Number,default:0,required:!0},color:{type:String,default:"primary"},level:{type:Number,default:0}},emits:["cellClick"],setup(e,{emit:l}){const s=e,v=a((()=>s.data)),h=s.level+1,C=t("tmCascaderShowIndex",a((()=>0))),b=t("tmCascaderValue",a((()=>[]))),k=o([]);function T(e){l("cellClick",e)}return r((()=>{var e,l,t,a;if(b.value[s.level]){let o=v.value.filter((e=>e.id==b.value[s.level]));o.length>0&&"object"==typeof(null==(e=o[0])?void 0:e.children)&&Array.isArray(null==(l=o[0])?void 0:l.children)&&(null==(t=o[0])?void 0:t.children.length)>0&&(k.value=null==(a=o[0])?void 0:a.children)}})),(e,l)=>{const t=m,a=x;return u(),p(y,null,[d(' v-if="tmCascaderShowIndex==_level" '),c(t,null,{default:i((()=>[f(C)==s.level?(u(),n(a,{key:0,style:w([{height:`${s.height}rpx`}]),"scroll-y":""},{default:i((()=>[(u(!0),p(y,null,g(f(v),((e,l)=>(u(),n(t,{key:l},{default:i((()=>[c(j,{followTheme:s.followTheme,level:s.level,data:e,onClick:l=>T(e)},null,8,["followTheme","level","data","onClick"])])),_:2},1024)))),128))])),_:1},8,["style"])):d("v-if",!0),k.value.length>0?(u(),n(N,{key:1,followTheme:s.followTheme,level:h,height:s.height,color:s.color,data:k.value,onCellClick:T},null,8,["followTheme","height","color","data"])):d("v-if",!0)])),_:1})],2112)}}});function z(e,l,t="text"){if(!e)return[];const a=[];for(const o of e)l.includes(o.id)&&a.push(o),a.push(...z(o.children,l,t));return a}const I=function(e=[],l="",t=[],a="id"){void 0===t&&(t=[]),Array.isArray(l)||(l=[l]);let o=Array.from(t);for(let r=0,u=e.length;r<u;r++){if(o.push(e[r][a]),e[r].id===l[0])return o;let t=e[r].children;if(t&&t.length){let e=I(t,l,o,a="id");if(e)return e}o.pop()}return""},B=function(e=[],l="",t="id"){let a=null;for(let o=0,r=e.length;o<r;o++){let r=e[o];if(r[t]==l&&r.children){a=r;break}if(r.children){let e=B(r.children,l,t="id");e&&(a=e)}}return a},q=e({__name:"tm-cascader",props:{followTheme:{type:[Boolean,String],default:!0},data:{type:Array,default:()=>[],required:!0},defaultValue:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]},height:{type:Number,default:650},activeColor:{type:String,default:"primary"},color:{type:String,default:"white"},beforeTabClick:{type:[Function,Boolean],default:()=>!1},beforeCellClick:{type:[Function,Boolean],default:()=>!1},slotTabHeigth:{type:Number,default:0}},emits:["update:modelValue","tab-click","cell-click","change"],setup(e,{expose:l,emit:t}){const r=e;let s=o(r.data);let v=o([]);const w=o(""),x=o([]),V=o([]),j=o(0),q=o(0);function F(e=!1){let l=uni.$tm.u.deepClone(r.data),t=uni.$tm.u.deepClone(r.modelValue);e&&(t=uni.$tm.u.deepClone(r.defaultValue));let a=Array.isArray(t)?t:[];if(w.value=0==a.length?"":a[a.length-1],""==w.value||void 0===w.value)return;if(B(l,String(w.value),"id"))return;let o=z(l,a,"text");x.value=t,o.length>0&&(V.value=o.map((e=>e.text))),j.value=x.value.length?x.value.length-1:0,q.value=j.value}function H(){let e=uni.$tm.u.deepClone(x.value),[l]=e.reverse();return function(e,l="",t=[],a="id"){void 0===t&&(t=[]),Array.isArray(l)||(l=[l]);let o=Array.from(t);for(let r=0,u=e.length;r<u;r++){if(o.push(e[r]),e[r].id===l[0])return o;let t=e[r].children;if(t&&t.length){let e=I(t,l,o,"id");if(e)return e}o.pop()}return null}(uni.$tm.u.deepClone(r.data),String(l),[],"id")}async function O(e){if("function"==typeof r.beforeTabClick){_({title:"..."});let e=await r.beforeTabClick();if("function"==typeof e&&(e=await e()),A(),!e)return}j.value=e,t("tab-click",e)}return C((()=>{h((()=>F(!0)))})),b("tmCascaderValue",a((()=>x.value))),b("tmCascaderShowIndex",a((()=>j.value))),k((()=>r.modelValue),(()=>{if(0==r.modelValue.length)return w.value="",v.value=[],x.value=[],V.value=[],j.value=0,void(q.value=0);F()}),{deep:!0}),k((()=>r.data),(()=>{v.value=[],j.value=0,q.value=0,x.value=[],V.value=[]}),{deep:!0}),l({pushValue:function(e,l,t){x.value.length<l?(x.value.push(t),V.value.push(e.text)):(x.value[l]=t,V.value.splice(l,1,e.text),h((()=>{x.value=x.value.slice(0,l+1),V.value=V.value.slice(0,l+1)})))},addActiveIndex:async function(e){if("function"==typeof r.beforeCellClick){_({title:"..."});let e=await r.beforeCellClick();if("function"==typeof e&&(e=await r.beforeCellClick()),A(),!e)return}j.value=e,q.value=e},tmCascaderName:"tmCascader",getValueStr:function(){return H().map((e=>e.text))},getValueObject:H,endSelected:function(){t("update:modelValue",x.value),h((()=>{t("change",x.value)}))},reFresh:function(e=[]){s.value=[],Array.isArray(e)?s.value=e.length>0?e:r.data:console.error("需要提供数组格式")}}),(l,a)=>{const o=m;return u(),n($,{color:r.color,height:r.height,padding:[0,0]},{default:i((()=>[c($,{color:r.color,text:"",round:3,border:0,_class:"flex flex-row overflow",height:68,margin:[0,0],padding:[24,0]},{default:i((()=>[c(o,{style:{height:"68rpx"},class:"flex flex-row flex-row-center-start"},{default:i((()=>[(u(!0),p(y,null,g(V.value,((e,l)=>(u(),n(o,{key:l,class:"flex flex-row flex-row-center-start"},{default:i((()=>[c(o,null,{default:i((()=>[c(S,{followTheme:j.value==l&&r.followTheme,fontSize:28,_class:"text-overflow-1",color:j.value==l?r.activeColor:"",label:e,onClick:e=>O(l)},null,8,["followTheme","color","label","onClick"])])),_:2},1024),l<x.value.length-1?(u(),n(o,{key:0,class:"mx-10"},{default:i((()=>[c(S,{followTheme:r.followTheme,label:"/",fontSize:24,color:r.activeColor},null,8,["followTheme","color"])])),_:1})):d("v-if",!0)])),_:2},1024)))),128)),q.value==x.value.length?(u(),n(S,{key:0,followTheme:j.value==q.value&&r.followTheme,color:j.value==q.value?r.activeColor:"",fontSize:28,_class:"ml-10",label:">请选择",onClick:a[0]||(a[0]=e=>O(q.value))},null,8,["followTheme","color"])):d("v-if",!0)])),_:1})])),_:1},8,["color"]),c(o,{style:{height:"16rpx"}}),e.slotTabHeigth?(u(),n(o,{key:0,class:"flex flex-row flex-row-center-start"},{default:i((()=>[T(l.$slots,"default")])),_:3})):d("v-if",!0),c(o,{style:{height:"16rpx"}}),c(N,{followTheme:r.followTheme,color:r.activeColor,height:r.height-120-e.slotTabHeigth,data:f(s),onCellClick:a[1]||(a[1]=e=>t("cell-click",e))},null,8,["followTheme","color","height","data"])])),_:3},8,["color","height"])}}});export{q as _};
