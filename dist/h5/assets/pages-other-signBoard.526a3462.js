var e=Object.defineProperty,t=(t,o,l)=>(((t,o,l)=>{o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[o]=l})(t,"symbol"!=typeof o?o+"":o,l),l);import{d as o,r as l,m as n,R as a,I as s,K as i,o as u,a as r,w as h,b as d,U as c,n as p,g as f,q as v,S as m,G as g,i as _,e as y,f as w,F as x,u as b}from"./index-6b165856.js";import{t as T}from"./tm-app.d6cf2f93.js";import{t as j}from"./tm-sheet.3639b36a.js";import{t as P}from"./tm-text.6c910eb0.js";import{t as k}from"./tm-button.80fc9b3b.js";import{_ as M}from"./tm-divider.vue_vue_type_script_setup_true_lang.cbbfcb4c.js";import{_ as C,a as V}from"./tm-radio.vue_vue_type_script_setup_true_lang.b4efeb1c.js";import{_ as D}from"./tm-slider.vue_vue_type_script_setup_true_lang.0bb1d17c.js";import"./tm-icon.65b53dc0.js";const W=o({__name:"tm-sign-board",props:{width:{type:Number,default:750},height:{type:Number,default:500},lineWidth:{type:Number,default:5},lineColor:{type:String,default:"red"}},setup(e,{expose:o}){var y,w;const x=e,b=null!=(w=null==(y=f())?void 0:y.proxy)?w:null,T=l("canvasId");let j;T.value="tm"+uni.$tm.u.getUid(5);let P,k=0,M=0;function C(e){if(P)if(-1==e.type.indexOf("mouse")&&1==e.changedTouches.length){var t=e.changedTouches[0];P.down(t.x,t.y)}else P.down(e.pageX-e.currentTarget.offsetLeft-k,e.pageY-e.currentTarget.offsetTop-M)}function V(e){if(P)if((null==e?void 0:e.preventDefault)&&(null==e||e.preventDefault()),(null==e?void 0:e.stopPropagation)&&(null==e||e.stopPropagation()),-1==e.type.indexOf("mouse")&&1==e.changedTouches.length){var t=e.changedTouches[0];P.move(t.x,t.y)}else P.move(e.pageX-e.currentTarget.offsetLeft-k,e.pageY-e.currentTarget.offsetTop-M)}function D(e){if(P)if(-1==e.type.indexOf("mouse")&&1==e.changedTouches.length){var t=e.changedTouches[0];P.up(t.x,t.y)}else P.up(e.pageX-e.currentTarget.offsetLeft-k,e.pageY-e.currentTarget.offsetTop-M)}l(!1),n((()=>{setTimeout((()=>(j=a(T.value,b),void s().in(b).select("#"+T.value).boundingClientRect((e=>{var t,o;k=null!=(t=e.left)?t:0,M=null!=(o=e.top)?o:0,P=new W(j,i(x.width),i(x.height))})).exec())),50)})),o({save:function(){return new Promise(((e,t)=>{if(!j)return v({title:"初始化失败",icon:"none"}),void t("初始化失败");m({x:0,y:0,destWidth:i(x.width),destHeight:i(x.height),width:x.width,height:x.height,canvasId:T.value,canvas:undefined,success:function(t){e(t.tempFilePath)},fail:e=>{console.error(e),t(e)}},b)}))},clear:function(){j?(j.clearRect(0,0,i(x.width),i(x.height)),j.draw(!1)):v({title:"初始化失败",icon:"none"})}});class W{constructor(e,o,l,n=2,a="black"){t(this,"_x",0),t(this,"_y",0),t(this,"_lineWidth",2),t(this,"_lineColor","black"),t(this,"cx"),t(this,"width",0),t(this,"height",0),t(this,"_isDown",!1),t(this,"_points",[]),this._lineColor=a,this._lineWidth=n,this.width=o,this.height=l,this.cx=e}down(e=0,t=0){this._isDown=!0,this._x=e,this._y=t}move(e=0,t=0){this._isDown&&(j.setStrokeStyle(x.lineColor),j.setLineWidth(x.lineWidth),j.setLineCap("round"),j.beginPath(),j.moveTo(this._x,this._y),j.lineTo(e,t),j.stroke(),j.closePath(),j.draw(!0),this._x=e,this._y=t)}up(e=0,t=0){this._isDown=!1,this._x=e,this._y=t}}return(e,t)=>{const o=g,l=_;return u(),r(l,{onMouseleave:D,onTouchcancel:D,ref:"tmspin",style:p({width:`${x.width}rpx`,height:`${x.height}rpx`})},{default:h((()=>[d(o,{onTouchstart:c(C,["stop"]),onTouchmove:c(V,["stop"]),onTouchend:c(D,["stop"]),onMousedown:c(C,["stop"]),onMousemove:c(V,["stop"]),onMouseup:c(D,["stop"]),onMouseleave:c(D,["stop"]),onTouchcancel:c(D,["stop"]),id:T.value,"canvas-id":T.value,class:"canvas",style:p({width:`${x.width}rpx`,height:`${x.height}rpx`,"touch-action":"none"})},null,8,["onTouchstart","onTouchmove","onTouchend","onMousedown","onMousemove","onMouseup","onMouseleave","onTouchcancel","id","canvas-id","style"])])),_:1},8,["style"])}}}),$=o({__name:"signBoard",setup(e){var t,o;const n=null!=(o=null==(t=f())?void 0:t.proxy)?o:null,a=l(null),s=["red","blue","black","green"],i=l("red"),c=l(5),p=()=>{return e=this,t=null,o=function*(){var e;let t=yield null==(e=a.value)?void 0:e.save();v({title:"成功，请查看日志",icon:"none"}),console.log(t)},new Promise(((l,n)=>{var a=e=>{try{i(o.next(e))}catch(t){n(t)}},s=e=>{try{i(o.throw(e))}catch(t){n(t)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(a,s);i((o=o.apply(e,t)).next())}));var e,t,o};return(e,t)=>{const o=_;return u(),r(T,null,{default:h((()=>[d(j,{width:662},{default:h((()=>[d(P,{label:"签名板全端兼容，用于签名使用。请在下方书写"}),d(M),d(W,{"line-color":i.value,"line-width":c.value,ref_key:"board",ref:a,width:638,height:400},null,8,["line-color","line-width"]),d(M),d(o,{class:"py-24"},{default:h((()=>[d(P,{label:"选择书写颜色"})])),_:1}),d(C,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e)},{default:h((()=>[(u(),y(x,null,w(s,((e,t)=>d(V,{color:e,value:e,label:e,key:"index"},null,8,["color","value","label"]))),64))])),_:1},8,["modelValue"]),d(o,{class:"py-24"},{default:h((()=>[d(P,{label:"拖动改变粗细"})])),_:1}),d(D,{max:20,modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),"default-value":c.value},null,8,["modelValue","default-value"]),d(M),d(o,{class:"flex flex-row flex-center"},{default:h((()=>[d(k,{onClick:t[2]||(t[2]=e=>b(n).$refs.board.clear()),label:"清空"}),d(k,{color:"green",margin:[24,0],onClick:p,label:"保存签名"})])),_:1})])),_:1})])),_:1})}}});export{$ as default};
