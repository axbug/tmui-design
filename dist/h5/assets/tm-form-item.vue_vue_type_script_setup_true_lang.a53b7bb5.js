var e=Object.defineProperty,l=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(l,t,r)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[t]=r,u=(e,l)=>{for(var t in l||(l={}))a.call(l,t)&&i(e,t,l[t]);if(r)for(var t of r(l))o.call(l,t)&&i(e,t,l[t]);return e},n=(e,r)=>l(e,t(r));import{d as s,r as d,ad as f,at as m,c as p,Q as v,o as c,a as y,w as g,M as b,k as h,P as x,O as _,L as w,m as F,b as q,N as j,n as C,j as O,u as $,g as A,i as S}from"./index-6b165856.js";import{t as V}from"./tm-sheet.3639b36a.js";import{t as k}from"./tm-text.6c910eb0.js";import{_ as z}from"./tm-divider.vue_vue_type_script_setup_true_lang.cbbfcb4c.js";function E(e,l){return(e=e.map((e=>"function"==typeof e.validator&&!0===e.required?e:"boolean"==typeof e.validator&&!0===e.required?n(u({},e),{validator:e=>{if(null===e||""===e||void 0===e)return!1;if("object"==typeof e)if(Array.isArray(e)){if(0==e.length)return!1}else if(0===Object.keys(e).length&&e.constructor===Object)return!1;if("boolean"==typeof e)return e;if("number"==typeof e){if(isNaN(e))return!1;if(Number(e)<0)return!1}return"string"!=typeof e||0!=e.trim().length}}):n(u({},e),{validator:e=>!0})))).filter((e=>"function"==typeof e.validator&&!0===e.required)).map((e=>{let t=!0;if("function"==typeof e.validator){t=!!e.validator(l)}else t=!0;return{message:String(e.message),validator:t}}))}function N(e,l=""){if(""==l)return e;for(var t=l.split(".");t.length>1;){e=e[String(t.shift())]}return e[t[0]]}const B=s({__name:"tm-form",props:{modelValue:{type:Object,default:()=>({}),required:!0},margin:{type:Array,default:()=>[32,24]},padding:{type:Array,default:()=>[16,0]},layout:{type:String,default:"horizontal"},labelWidth:{type:Number,default:160},labelAlign:{type:String,default:"left"},border:{type:Boolean,default:!0},transprent:{type:Boolean,default:!1}},emits:["submit","validate","reset","clearValidate","update:modelValue"],setup(e,{expose:l,emit:t}){const r=e,a=d(r.modelValue),o=uni.$tm.u.deepClone(r.modelValue);f((()=>{a.value=r.modelValue}));const i=d([]);d(["tm-radio-group","tm-checkbox-box","tm-input","tm-rate","tm-slider","tm-segtab","tm-switch","tm-upload"]);const n=d(""),s=d([]);m("tmFormFun",p((()=>n.value))),m("tmFormLabelWidth",p((()=>r.labelWidth))),m("tmFormLabelAlign",p((()=>r.labelAlign))),m("tmFormLayout",p((()=>r.layout))),m("tmFormBorder",p((()=>r.border))),m("tmFormTransprent",p((()=>r.transprent))),m("formCallFiled",p((()=>a.value))),m("validateResultList",p((()=>s.value)));let _=NaN;function w(){var e,l,t,r;n.value="validate";let o=x(i.value),s=!0,d=[];for(let i=0,n=o.length;i<n;i++){let n=o[i],f=N(a.value,n.field);const m=E(n.rules,f);let p={message:"校验通过",validator:!0};for(let a=0;a<m.length;a++)if(!m[a].validator){s=!1,p.message=null!=(l=null==(e=m[a])?void 0:e.message)?l:"校验通过",p.validator=null==(r=null==(t=m[a])?void 0:t.validator)||r;break}d.push(u({field:n.field},p))}return{result:d,isPass:s,data:x(a.value),validate:s}}return v((()=>r.modelValue),(()=>{clearTimeout(_),"validate"==n.value&&(_=setTimeout((function(){const e=w();s.value=[...e.result]}),100))}),{deep:!0}),l({reset:function(){n.value="reset";let e=uni.$tm.u.deepClone(o);t("update:modelValue",e),t("reset"),a.value=e},validate:w,clearValidate:function(){n.value="clearValidate",h((()=>{t("clearValidate")}))},submit:function(){n.value="validate",uni.$tm.u.throttle((()=>{const e=w();s.value=[...e.result],t("submit",u({data:x(a.value)},e))}),220,!1)},pushKey:function(e){if(!e.field)return;let l=i.value.findIndex((l=>l.id==e.id));-1==l?i.value.push(e):i.value[l]=u({},e)},delKey:function(e){let l=i.value.findIndex((l=>l.id==e.id));l>-1&&i.value.splice(l,1)},tmFormComnameId:"tmFormId"}),(e,l)=>(c(),y(V,{transprent:r.transprent,round:3,_class:"flex flex-col overflow",padding:r.padding,margin:r.margin},{default:g((()=>[b(e.$slots,"default")])),_:3},8,["transprent","padding","margin"]))}}),I=s({__name:"tm-form-item",props:{parentClass:{type:String,default:""},align:{type:String,default:""},label:{type:String,default:""},desc:{type:String,default:""},margin:{type:Array,default:()=>[12,12]},padding:{type:Array,default:()=>[0,0]},field:{type:String,default:""},help:{type:String,default:""},required:{type:Boolean,default:!1},rules:{type:[Object,Array],default:()=>[{validator:!1,required:!1}]},border:{type:Boolean,default:null},showError:{type:Boolean,default:!0},showTopErrorGap:{type:Boolean,default:!0},requiredTitleChangeColor:{type:Boolean,default:!1},transprent:{type:[Boolean,String],default:null},round:{type:Number,default:0},errHeight:{type:Number,default:30},labelWidth:{type:Number,default:0}},setup(e,{expose:l}){var t,r,a;const o=e,i=null!=(r=null==(t=A())?void 0:t.proxy)?r:null,s=d({label:"",field:o.field,value:null,isRequiredError:!1,message:"",id:uni.$tm.u.getUid(1),componentsName:"",rules:[]}),f=d(o.required),m=_("tmFormLabelWidth",p((()=>100))),h=_("tmFormLabelAlign",p((()=>"left"))),x=_("tmFormLayout",p((()=>"horizontal"))),E=_("tmFormBorder",p((()=>!0))),N=_("tmFormTransprent",p((()=>!1))),B=_("tmFormFun",p((()=>""))),I=_("validateResultList",p((()=>[]))),L=p((()=>null!==o.border&&"boolean"==typeof o.border?o.border:E.value)),T=p((()=>o.label));let P=null==i?void 0:i.$parent;for(;P&&"tmFormId"!=(null==P?void 0:P.tmFormComnameId)&&P;)P=null!=(a=null==P?void 0:P.$parent)?a:void 0;w((()=>{K()}));const R=p((()=>{var e,l,t,r,a;let i=[];return Array.isArray(null==o?void 0:o.rules)?null==o||o.rules.forEach((e=>{var l,t;let r=(null==e?void 0:e.required)||o.required;i.push({message:null!=(l=null==e?void 0:e.message)?l:"请填写必要的内容",required:r,validator:null!=(t=null==e?void 0:e.validator)&&t})})):i=[{message:null!=(l=null==(e=null==o?void 0:o.rules)?void 0:e.message)?l:"请填写必要的内容",required:(null==(t=o.rules)?void 0:t.required)||o.required,validator:null!=(a=null==(r=o.rules)?void 0:r.validator)&&a}],i}));function W(e){P&&(s.value=n(u(u({},s.value),null!=e?e:{}),{rules:R.value}),P.pushKey(u({},s.value)))}function K(){P&&P.delKey(s.value)}return l({pushCom:W,delCom:K,tmFormComnameFormItem:"tmFormComnameFormItem"}),F((()=>{W()})),v((()=>I.value),(()=>{const e=I.value.filter((e=>e.field==o.field));e.length>0&&(s.value.message=e[0].message,s.value.isRequiredError=!e[0].validator)}),{deep:!0,immediate:!0}),(e,l)=>{const t=S;return c(),y(t,{class:j([`mx-${o.margin[0]}`])},{default:g((()=>[q(V,{transprent:null!==o.transprent?o.transprent:$(N),round:o.round,margin:[0,0],padding:o.padding},{default:g((()=>[q(t,{class:j([`py-${o.margin[1]}`])},{default:g((()=>[o.showError&&o.showTopErrorGap?(c(),y(t,{key:0,style:C({height:`${o.errHeight}rpx`})},null,8,["style"])):O("v-if",!0),q(t,{class:j(["flex","horizontal"==$(x)?"flex-row ":" ","horizontal"!=$(x)||o.align?"":"flex-row-center-start","vertical"!=$(x)||o.align?"":"flex-col",o.align,o.parentClass])},{default:g((()=>[$(T)?(c(),y(t,{key:0,style:C(["horizontal"==$(x)?{width:(o.labelWidth||$(m))+"rpx"}:""]),class:j(["flex flex-row",["right"==$(h)?"flex-row-center-end":"flex-row-center-start","horizontal"!=$(x)?"mb-24 flex-1 ":"mr-32 "]])},{default:g((()=>[q(t,{style:{width:"12px"},class:"flex flex-row flex-row-center-center"},{default:g((()=>[f.value?(c(),y(k,{key:0,color:"red","font-size":30,label:"*"})):O("v-if",!0)])),_:1}),q(t,{class:"flex flex-1",style:{width:"0px"}},{default:g((()=>[q(k,{color:"validate"==$(B)&&1==s.value.isRequiredError&&o.requiredTitleChangeColor?"red":"","font-size":30,label:$(T)},null,8,["color","label"])])),_:1})])),_:1},8,["style","class"])):O("v-if",!0),q(t,{class:"flex-1",style:C(["horizontal"==$(x)?{width:"0px"}:""])},{default:g((()=>[b(e.$slots,"default")])),_:3},8,["style"])])),_:3},8,["class"]),q(t,{class:j(o.desc?"pt-12":"")},{default:g((()=>[b(e.$slots,"desc",{},(()=>[q(k,{color:"grey-darken-2","font-size":22,label:o.desc},null,8,["label"])]))])),_:3},8,["class"]),o.showError?(c(),y(t,{key:1,style:C({height:`${o.errHeight}rpx`})},{default:g((()=>["validate"==$(B)&&1==s.value.isRequiredError?(c(),y(t,{key:0},{default:g((()=>[b(e.$slots,"error",{data:{message:s.value.message}},(()=>[q(k,{color:"red","font-size":22,label:s.value.message},null,8,["label"])]))])),_:3})):O("v-if",!0)])),_:3},8,["style"])):O("v-if",!0)])),_:3},8,["class"])])),_:3},8,["transprent","round","padding"]),$(L)?(c(),y(t,{key:0},{default:g((()=>[q(z,{border:2,padding:[0,0],margin:[0,0]})])),_:1})):O("v-if",!0)])),_:3},8,["class"])}}});export{B as _,I as a};
