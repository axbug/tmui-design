import{d as e,r as t,P as l,c as a,ax as o,R as n,p as u,m as r,o as i,a as s,w as f,b as c,N as d,u as p,V as v,n as m,O as y,k as h,ay as x,g as w,L as k,j as b,_ as g}from"./index-5c06cf16.js";import{t as C}from"./tm-translate.4fbb7927.js";import{t as _}from"./tm-text.fdd4f0a8.js";import{t as S}from"./tm-icon.5716c798.js";import{t as N}from"./tm-overlay.3ea1101a.js";import{c as z,u as B,f as T,g as H,d as I,h as O}from"./tm-app.20954b06.js";const j=g(e({__name:"tm-drawer",props:{...z,mask:{type:[Boolean,String],default:!0},placement:{type:String,default:"bottom"},show:{type:[Boolean],default:!1},width:{type:Number,default:500},height:{type:Number,default:600},round:{type:Number,default:10},duration:{type:Number,default:300},overlayClick:{type:Boolean,default:!0},transprent:{type:[Boolean,String],default:!1},closeable:{type:[Boolean,String],default:!1},color:{type:String,default:"white"},title:[String],okText:{type:[String],default:"完成"},okColor:{type:[String],default:"primary"},okLoading:{type:[Boolean,String],default:!1},cancelText:{type:[String],default:"取消"},hideCancel:{type:[Boolean,String],default:!1},hideHeader:{type:[Boolean,String],default:!1},disabled:{type:Boolean,default:!1},zIndex:{type:[Number,String],default:401},unit:{type:String,default:"rpx"},disabbleScroll:{type:Boolean,default:!1},inContent:{type:Boolean,default:!1},footHeight:{type:Number,default:0},teleport:{type:Boolean,default:!0},beforeOpen:{type:Function,default:null},beforeOk:{type:Function,default:null},beforeCance:{type:Function,default:null}},emits:["click","open","close","update:show","ok","cancel"],setup(e,{expose:g,emit:z}){var j;const $=e,F=t(null),L=t(null),P=B();null==(j=w())||j.proxy;const A=l("tmuiSysInfo",a((()=>({bottom:0,height:750,width:k(750),top:0,isCustomHeader:!1,sysinfo:null})))),U=a((()=>P.tmStore)),V=a((()=>T($))),Y=a((()=>H($))),R=a((()=>I($,U.value))),Z=a((()=>O($,R.value,U.value))),q=a((()=>A.value.width)),D=a((()=>A.value.height)),E=t(!0),G=t(0);let J=NaN,K=!1;o();let M=t($.show);function Q(e,t=500,l=!1){if(isNaN(J)||clearTimeout(J),l){var a=!J;J=setTimeout((()=>{J=NaN}),t),a&&"function"==typeof e&&e()}else J=setTimeout((()=>{"function"==typeof e&&e()}),t)}G.value=uni.$tm.u.getUid(4),M.value&&(E.value=!1),n((()=>$.show),(e=>{var t;e?E.value=!0:(E.value=!1,null==(t=L.value)||t.close()),M.value!==$.show&&r((()=>{var e;null==(e=F.value)||e.play()})),M.value=$.show})),u((()=>{M.value&&pe()}));const W=a((()=>$.okLoading)),X=t(!1),ee=a((()=>"left"==le.value?"round-r-"+$.round:"right"==le.value?"round-l-"+$.round:"up"==le.value?"round-b-"+$.round:"down"==le.value?"round-t-"+$.round:"zoom"==le.value?"round-"+$.round:void 0)),te=a((()=>"zoom"!=le.value?E.value:!E.value)),le=a((()=>"center"==$.placement?"zoom":"top"==$.placement?"up":"bottom"==$.placement?"down":$.placement)),ae=a((()=>"zoom"==le.value||"left"==$.placement||"right"==$.placement?$.width+$.unit:q.value+"px")),oe=a((()=>"top"==$.placement||"bottom"==$.placement||"zoom"==le.value?$.height+0+$.unit:D.value+"px")),ne=a((()=>{let e=$.hideHeader?0:44,t=uni.$tm.u.topx($.footHeight);if("top"==$.placement||"bottom"==$.placement||"zoom"==le.value){let l=$.height;return"rpx"==$.unit&&(l=k($.height)),l-e-t+"px"}return D.value-e-t+"px"})),ue=a((()=>"down"==le.value?"flex-col-bottom-center":"up"==le.value?"flex-top-custom":"left"==le.value?"flex-row-top-start":"right"==le.value?"flex-row-bottom-start":"zoom"==le.value?"flex-center":void 0));async function re(){let e=!0;if("function"!=typeof $.beforeCance||(X.value=!0,e=await $.beforeCance(),"function"==typeof e&&(e=await e()),X.value=!1,e))return e}function ie(){!async function(){if("function"==typeof $.beforeOpen){X.value=!0;let e=await $.beforeOpen();"function"==typeof e&&(e=await e()),X.value=!1}}(),M.value=!0,z("open"),z("update:show",!0)}function se(){r((()=>{M.value=!1,z("close"),z("update:show",!1)}))}async function fe(e){z("click",e),$.overlayClick&&!$.disabled&&L.value&&!X.value&&await re()&&(E.value=!1,function(e,t=500,l=!0){l?K||(K=!0,"function"==typeof e&&e(),setTimeout((()=>{K=!1}),t)):K||(K=!0,setTimeout((()=>{K=!1,"function"==typeof e&&e()}),t))}((()=>{var e,t;z("cancel"),null==(e=L.value)||e.close(),null==(t=F.value)||t.play()}),$.duration+80,!0))}async function ce(){$.disabled||X.value||await async function(){let e=!0;if("function"!=typeof $.beforeOk||(X.value=!0,e=await $.beforeOk(),"function"==typeof e&&(e=await e()),X.value=!1,e))return e}()&&(E.value=!1,Q((()=>{var e,t;z("ok"),null==(e=L.value)||e.close(),null==(t=F.value)||t.play()}),500,!0))}async function de(){$.disabled||X.value||await re()&&(E.value=!1,Q((()=>{var e,t;z("cancel"),null==(e=L.value)||e.close(),null==(t=F.value)||t.play()}),500,!0))}function pe(){E.value=!0,M.value=!0,r((()=>{var e;null==(e=F.value)||e.play()}))}return g({close:function(){var e,t;E.value=!1,null==(e=L.value)||e.close(),null==(t=F.value)||t.play()},open:pe}),(t,l)=>{const a=b;return i(),s(a,null,{default:f((()=>[c(a,{onClick:pe},{default:f((()=>[d(t.$slots,"trigger",{},void 0,!0)])),_:3}),c(N,{inContent:$.inContent,ref_key:"overlayAni",ref:L,duration:$.duration+80,onOpen:ie,onClose:se,zIndex:$.zIndex,transprent:!$.mask,onClick:fe,align:p(ue),teleport:$.teleport,overlayClick:!1,show:p(M),"onUpdate:show":l[1]||(l[1]=e=>x(M)?M.value=e:M=e)},{default:f((()=>[c(C,{reverse:p(te),width:p(ae),height:p(oe),ref_key:"drawerANI",ref:F,"auto-play":!1,name:p(le),duration:$.duration},{default:f((()=>[c(a,{onClick:l[0]||(l[0]=v((e=>e.stopPropagation()),["stop"])),style:m([{width:p(ae),height:p(oe)},$.transprent?"":p(Z).borderCss,$.transprent?"":p(Z).backgroundColorCss,$.transprent?"":p(Z).shadowColor,p(V)]),class:y([p(ee),"flex flex-col overflow ",p(Y)])},{default:f((()=>[$.closeable||$.hideHeader?h("v-if",!0):(i(),s(a,{key:0,class:"flex flex-row flex-row-center-center flex-between px-24",style:{height:"44px"}},{default:f((()=>[c(a,{class:"flex-4 flex-shrink"},{default:f((()=>[$.hideCancel||X.value||p(W)?h("v-if",!0):(i(),s(_,{key:0,onClick:de,label:$.cancelText},null,8,["label"]))])),_:1}),c(a,{class:"flex-8 px-32 flex-center"},{default:f((()=>[d(t.$slots,"title",{},(()=>[c(_,{_class:"text-overflow-1 opacity-7",label:$.title},null,8,["label"])]),!0)])),_:3}),c(a,{class:"flex-4 flex-shrink flex-row flex-row-center-end"},{default:f((()=>[p(W)||X.value?h("v-if",!0):(i(),s(_,{key:0,color:e.okColor,onClick:ce,dark:$.dark,label:$.okText},null,8,["color","dark","label"])),p(W)||X.value?(i(),s(S,{key:1,color:e.okColor,spin:p(W)||X.value,dark:p(R),_class:!0!==p(R)?"opacity-4":"",fontSize:24,name:p(W)||X.value?"tmicon-shuaxin":"tmicon-times-circle-fill"},null,8,["color","spin","dark","_class","name"])):h("v-if",!0)])),_:1})])),_:3})),$.closeable&&!$.hideHeader?(i(),s(a,{key:1,class:"flex flex-row flex-row-center-center flex-between px-24",style:{height:"44px"}},{default:f((()=>[c(a,{class:"flex-9 pr-32"},{default:f((()=>[d(t.$slots,"title",{},(()=>[c(_,{_class:"text-overflow-1 opacity-7",dark:$.dark,label:$.title},null,8,["dark","label"])]),!0)])),_:3}),c(a,{class:"flex-3 flex-shrink flex-row flex-row-center-end"},{default:f((()=>[c(S,{onClick:de,dark:$.dark,_class:!0!==p(R)?"opacity-3":"",fontSize:36,name:"tmicon-times-circle-fill"},null,8,["dark","_class"])])),_:1})])),_:3})):h("v-if",!0),c(a,{style:m({overflowY:$.disabbleScroll?"normal":"auto",height:p(ne)})},{default:f((()=>[d(t.$slots,"default",{},void 0,!0)])),_:3},8,["style"]),d(t.$slots,"foot",{},(()=>[$.footHeight>0?(i(),s(a,{key:0,class:"flex"})):h("v-if",!0)]),!0)])),_:3},8,["style","class"])])),_:3},8,["reverse","width","height","name","duration"])])),_:3},8,["inContent","duration","zIndex","transprent","align","teleport","show"])])),_:3})}}}),[["__scopeId","data-v-f225ae55"]]);export{j as t};
