import{d as e,c as t,r as l,I as a,p as o,R as n,J as r,o as s,a as u,w as c,V as d,n as i,u as p,b as f,k as m,g as v,m as h,H as g,j as w,a9 as x,aa as b,_ as T}from"./index-5c06cf16.js";import{e as y,t as _}from"./tm-app.20954b06.js";import{t as C}from"./tm-sheet.2873fe67.js";import{t as V}from"./tm-text.fdd4f0a8.js";import{_ as X}from"./tm-divider.vue_vue_type_script_setup_true_lang.0bd9a5e3.js";import{g as Y}from"./getCanvas.fd5c9d3a.js";import{t as D}from"./tm-icon.5716c798.js";import{t as S}from"./tm-button.5fc2eaaa.js";const $=e({__name:"tm-color-view",props:{width:{type:Number,default:500},height:{type:Number,default:500},color:{type:String,default:"primary"},modelValue:{type:String,default:"#FF0000"}},emits:["confirm","update:modelValue"],setup(e,{expose:T,emit:_}){var C;const V=e,X=(null==(C=v())?void 0:C.proxy)??null;let $="c_"+uni.$tm.u.getUid(4);const k=t((()=>250)),R=t((()=>200));t((()=>uni.$tm.u.torpx(k.value-30)));let I=null,P=0,j=0,U=NaN;l(null);let F=a().devicePixelRatio;const G=l(!0);let H=y.cssToRgba(V.modelValue);const L=l({...H}),N=l(H.a||0);function A(){N.value=N.value<=0?0:N.value,N.value=N.value>=1?1:N.value;let e=y.rgbaToCss({...L.value,a:N.value});_("update:modelValue",e),h((()=>{_("confirm",e),uni.$tm.u.setClipboardData(e)}))}function z(e){}function J(e){}function M(e){}function K(e,t,l,a=!0){if(e=e-P+15,t=t-j+15,1==l?(e=e<40?40:e,t=t<=2?2:t):(e=e<0?0:e,t=(t=t<0?0:t)>200?200:t),null==I?void 0:I.getImageData){let l=I.getImageData(e*F,t*F,1,1),[o,n,r,s]=l.data,u={r:o,g:n,b:r,a:1};a&&(L.value={...u}),e>=0&&e<=30&&t>=0&&t<=R.value&&O(y.rgbaToHsla(u).h)}else b({canvasId:$,x:e,y:t,width:1,height:1,success(l){let[o,n,r,s]=l.data,u={r:o,g:n,b:r,a:1};a&&(L.value={...u}),e>=0&&e<=30&&t>=0&&t<=R.value&&O(y.rgbaToHsla(u).h)},fail(e){console.error(e)}},X)}function O(e=0){let t=k.value;for(let l=0;l<100;l++){let a=I.createLinearGradient(40,l,t-40,l);a.addColorStop(0,y.rgbaToCss(y.hslaToRgba({h:e,s:0,l:100-l,a:1}))),a.addColorStop(1,y.rgbaToCss(y.hslaToRgba({h:e,s:100,l:50-l/2,a:1}))),I.fillStyle=a,I.fillRect(40,2*(l+1),t-40,2*(l+1)),(null==I?void 0:I.draw)&&(null==I||I.draw(!0))}}function W(e){clearTimeout(U),U=setTimeout((function(){r().in(X).selectAll(".wrapper").boundingClientRect((t=>{if(Array.isArray(t)&&!(t.length<2))if(y.rgbaToHsla(L.value),0===e){K(t[0].left,t[0].top,0,!1),U=setTimeout((()=>{K(t[1].left,t[1].top,1)}),150)}else{K(t[1].left,t[1].top,1)}})).exec()}),200)}function q(e){(null==e?void 0:e.stopPropagation)&&e.stopPropagation(),(null==e?void 0:e.preventDefault)&&e.preventDefault()}return o((()=>{r().in(X).select("#"+$).boundingClientRect((e=>{P=(null==e?void 0:e.left)??0,j=(null==e?void 0:e.top)??0,Y(X,$,k.value,R.value).then((e=>{I=e.ctx,async function(){let e=R.value/3,t=30,l=0,a=I.createLinearGradient(t/2,0,t/2,e);a.addColorStop(0,"rgba(255,0,0,1)"),a.addColorStop(.5,"rgba(255,0,255,1)"),a.addColorStop(1,"rgba(0,0,255,1)"),I.fillStyle=a,I.fillRect(l,0,t,e),(null==I?void 0:I.draw)&&(null==I||I.draw());let o=I.createLinearGradient(t/2,e,t/2,2*e);o.addColorStop(0,"rgba(0,0,255,1)"),o.addColorStop(.5,"rgba(0,255,255,1)"),o.addColorStop(1,"rgba(0,255,0,1)"),I.fillStyle=o,I.fillRect(l,e,t,e),(null==I?void 0:I.draw)&&(null==I||I.draw(!0));let n=I.createLinearGradient(t/2,2*e,t/2,3*e);n.addColorStop(0,"rgba(0,255,0,1)"),n.addColorStop(.5,"rgba(255,255,1,1)"),n.addColorStop(1,"rgba(255,0,0,1)"),I.fillStyle=n,I.fillRect(l,2*e,t,e),(null==I?void 0:I.draw)&&(null==I||I.draw(!0))}(),O()}))})).exec()})),n((()=>V.modelValue),(()=>{let e=y.cssToRgba(V.modelValue);L.value={...e},N.value=e.a})),T({wxsCallPos:function(e,t){}}),(e,t)=>{const l=g,a=w,o=x;return s(),u(a,{onTouchmove:d(q,["stop"]),class:"flex flex-col flex-col-top-center"},{default:c((()=>[G.value?(s(),u(a,{key:0,onTouchmove:d(q,["stop"]),class:"overflow relative",ref:"webviewWk",style:i({width:`${p(k)}px`,height:`${p(R)}px`})},{default:c((()=>[f(l,{onTouchstart:z,onTouchmove:J,onTouchend:M,class:"canvas",id:p($),"canvas-id":p($),style:i({width:`${p(k)}px`,height:`${p(R)}px`,"touch-action":"none"})},null,8,["id","canvas-id","style"]),f(a,{id:"wrapper",class:"absolute l-0 t-0 wrapper item",onTouchstart:e.colorTouch.startDrag,onTouchmove:e.colorTouch.onDrag,onTouchend:e.colorTouch.endDrag,onTouchcancel:e.colorTouch.endDrag},{default:c((()=>[f(a,{class:"itemwk",onTouchend:t[0]||(t[0]=e=>W(0)),onTouchmove:t[1]||(t[1]=e=>W(0))})])),_:1},8,["onTouchstart","onTouchmove","onTouchend","onTouchcancel"]),f(a,{id:"wrapper2",class:"absolute r-0 t-0 wrapper item",onTouchstart:e.colorTouch.startDrag2,onTouchmove:e.colorTouch.onDrag2,onTouchend:e.colorTouch.endDrag2,onTouchcancel:e.colorTouch.endDrag2},{default:c((()=>[f(a,{class:"itemwk",onTouchend:t[2]||(t[2]=e=>W(1)),onTouchmove:t[3]||(t[3]=e=>W(1))})])),_:1},8,["onTouchstart","onTouchmove","onTouchend","onTouchcancel"])])),_:1},8,["onTouchmove","style"])):m("v-if",!0),G.value?m("v-if",!0):(s(),u(a,{key:1,class:"flex flex-row flex-row-center-center"},{default:c((()=>[f(D,{name:"tmicon-shuaxin",spin:""})])),_:1})),f(a,{class:"flex flex-row flex-row-center-center mt-32",style:i({width:`${p(k)}px`})},{default:c((()=>[f(a,{class:"round-0 shadow-4",style:i({width:"30px",height:"60rpx",background:`rgba(${L.value.r},${L.value.g},${L.value.b},${N.value})`})},null,8,["style"]),f(a,{style:{width:"5px"}}),f(a,{style:i({width:p(k)-35+"px"})},{default:c((()=>[f(a,{class:"flex flex-row flex-row-center-start"},{default:c((()=>[f(o,{modelValue:L.value.r,"onUpdate:modelValue":t[4]||(t[4]=e=>L.value.r=e),class:"colorInput",style:i({width:(p(k)-30)/4-6+"px"})},null,8,["modelValue","style"]),f(o,{modelValue:L.value.g,"onUpdate:modelValue":t[5]||(t[5]=e=>L.value.g=e),class:"colorInput",style:i({width:(p(k)-30)/4-6+"px"})},null,8,["modelValue","style"]),f(o,{modelValue:L.value.b,"onUpdate:modelValue":t[6]||(t[6]=e=>L.value.b=e),class:"colorInput",style:i({width:(p(k)-30)/4-6+"px"})},null,8,["modelValue","style"]),f(o,{modelValue:N.value,"onUpdate:modelValue":t[7]||(t[7]=e=>N.value=e),class:"colorInput",style:i({width:(p(k)-30)/4-6+"px"})},null,8,["modelValue","style"])])),_:1})])),_:1},8,["style"])])),_:1},8,["style"]),f(a,{class:"mt-10",style:i({width:`${p(k)}px`})},{default:c((()=>[f(S,{color:V.color,onClick:A,block:"",label:"确认"},null,8,["color"])])),_:1},8,["style"])])),_:1},8,["onTouchmove"])}}});var k,R,I=function(e){R=(k=e).getState()};const P={startDrag:function(e,t){I(t);var l=e.touches[0];R.startX||(R.startX=l.clientX,R.startY=l.clientY)},onDrag:function(e,t){var l,a,o,n,r=e.touches[0];R.deltaX=r.clientX-R.startX,R.deltaY=r.clientY-R.startY,0!=R.deltaX&&(R.deltaX=0),R.deltaY<=-15&&(R.deltaY=-15),R.deltaY>182&&(R.deltaY=182),R.dragging=!0,l=R.deltaX,a=R.deltaY,o="translate3d("+l+"px, "+a+"px, 0)",n=R.dragging?"none":"transform .6s cubic-bezier(0.18, 0.89, 0.32, 1)",k.selectComponent("#wrapper").setStyle({"-webkit-transform":o,"-webkit-transition":n,transform:o,transition:n}),k.callMethod("wxsCallPos",R.deltaX,R.deltaY),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()},endDrag:function(e,t){e.touches[0],R.dragging=!1},startDrag2:function(e,t){I(t);var l=e.touches[0];R.startX2||(R.startX2=l.clientX,R.startY2=l.clientY)},onDrag2:function(e,t){var l,a,o,n,r=e.touches[0];R.deltaX2=r.clientX-R.startX2,R.deltaY2=r.clientY-R.startY2,R.dragging=!0,R.deltaX2>5&&(R.deltaX2=5),R.deltaX2<-182&&(R.deltaX2=-182),R.deltaY2<=-2&&(R.deltaY2=-2),R.deltaY2>185&&(R.deltaY2=185),l=R.deltaX2,a=R.deltaY2,o="translate3d("+l+"px, "+a+"px, 0)",n=R.dragging?"none":"transform .6s cubic-bezier(0.18, 0.89, 0.32, 1)",k.selectComponent("#wrapper2").setStyle({"-webkit-transform":o,"-webkit-transition":n,transform:o,transition:n}),k.callMethod("wxsCallPos",R.deltaX2,R.deltaY2)},endDrag2:function(e,t){e.touches[0],R.dragging=!1}},j=e=>{e.$wxs||(e.$wxs=[]),e.$wxs.push("colorTouch"),e.mixins||(e.mixins=[]),e.mixins.push({beforeCreate(){this.colorTouch=P}})};j($);const U=T($,[["__scopeId","data-v-7c42b9f2"]]),F=e({__name:"colorPicker",setup(e){const t=l("#00FF00");return(e,l)=>{const a=w;return s(),u(_,null,{default:c((()=>[f(C,null,{default:c((()=>[f(V,{label:"颜色选择器,全端兼容.因实现兼容有点小复杂,故属性上我虽然提供了宽和高.但实际上没有用处.也请不要随意赋值.固定值即可.如果确实需要更改宽和高,请自行修改源码."}),f(V,{color:"red",label:"暂时还未实现双向绑定定位颜色位置功能."}),f(V,{label:t.value},null,8,["label"]),f(X)])),_:1}),f(a,{class:"pa-32 flex flex-row flex-row-center-center"},{default:c((()=>[f(U,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=e=>t.value=e)},null,8,["modelValue"])])),_:1})])),_:1})}}});export{F as default};
