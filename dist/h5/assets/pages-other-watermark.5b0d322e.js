var e=(e,t,a)=>new Promise(((l,i)=>{var u=e=>{try{o(a.next(e))}catch(t){i(t)}},n=e=>{try{o(a.throw(e))}catch(t){i(t)}},o=e=>e.done?l(e.value):Promise.resolve(e.value).then(u,n);o((a=a.apply(e,t)).next())}));import{d as t,r as a,c as l,m as i,k as u,Q as n,R as o,H as r,K as d,Z as m,S as s,o as p,a as f,w as h,M as g,b as c,n as v,N as x,u as y,g as b,G as V,i as w}from"./index-6b165856.js";import{t as _}from"./tm-sheet.3639b36a.js";import{t as S}from"./tm-text.6c910eb0.js";import{_ as O}from"./tm-divider.vue_vue_type_script_setup_true_lang.cbbfcb4c.js";import{_ as $,a as H}from"./tm-radio.vue_vue_type_script_setup_true_lang.b4efeb1c.js";import{t as N}from"./tm-input.f9dbb6fc.js";import{t as U}from"./tm-app.d6cf2f93.js";import{_ as G}from"./tm-upload.vue_vue_type_script_setup_true_lang.e0033e99.js";import"./tm-icon.65b53dc0.js";import"./tm-button.80fc9b3b.js";import"./tm-image.vue_vue_type_script_setup_true_lang.b0e5c126.js";import"./tm-translate.1f1c80c0.js";const M=t({__name:"tm-watermark",props:{cross:Boolean,debug:Boolean,fullscreen:Boolean,width:{type:Number,default:64},height:{type:Number,default:64},zIndex:{type:Number,default:999},xGap:{type:Number,default:0},yGap:{type:Number,default:0},yOffset:{type:Number,default:0},xOffset:{type:Number,default:0},rotate:{type:Number,default:0},image:String,imageOpacity:{type:Number,default:1},imageHeight:Number,imageWidth:Number,content:String,selectable:{type:Boolean,default:!0},fontSize:{type:Number,default:14},fontFamily:String,fontStyle:{type:String,default:"normal"},fontVariant:{type:String,default:""},fontWeight:{type:Number,default:400},fontColor:{type:String,default:"rgba(128, 128, 128, .3)"},fontStretch:{type:String,default:""},lineHeight:{type:Number,default:14},unit:{type:String,default:"rpx"}},setup(t){var _,S;const O=t,$=null!=(S=null==(_=b())?void 0:_.proxy)?S:null;a();const H=a({width:O.width,height:O.height}),N=a(),U=l((()=>({zIndex:O.zIndex,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat",top:0,left:0,backgroundSize:"rpx"==O.unit?`${d(O.xGap+O.width)} px`:`${O.xGap+O.width} px`,backgroundPosition:O.cross?`${"rpx"==O.unit?d(O.width/2):O.width/2}px ${"rpx"==O.unit?d(O.height/2):O.height/2}px, 0 0`:"",backgroundImage:O.cross?`url(${N.value}), url(${N.value})`:`url(${N.value})`})));function G(){return e(this,null,(function*(){const e=o("waterCanvas",$),t=r().pixelRatio,{xGap:a,yGap:l,width:i,height:u,yOffset:n,xOffset:s,rotate:p,image:f,content:h,fontColor:g,fontStyle:c,fontVariant:v,fontStretch:x,fontWeight:y,fontFamily:b,fontSize:V,lineHeight:w,debug:_}=O,S=(a+(i>0?i:1))*t,N=(l+(u>0?u:1))*t,U="rpx"==O.unit?d(s*t):s*t,G="rpx"==O.unit?d(n*t):n*t,k="rpx"==O.unit?d(S):S,z="rpx"==O.unit?d(N):N;if(H.value={width:S,height:N},e){e.translate(0,0);const a="rpx"==O.unit?d(i*t):i*t,l="rpx"==O.unit?d(u*t):u*t;if(_&&(e.strokeStyle="grey",e.strokeRect(0,0,a,l)),e.rotate(p*(Math.PI/180)),f){const{imageWidth:a,imageHeight:l}=O;yield m({src:f,success:function(i){e.globalAlpha=O.imageOpacity,e.drawImage(f,U,G,(O.imageWidth||(l?i.width*l/i.height:i.width))*t,(O.imageHeight||(a?i.height*a/i.width:i.height))*t),M({ctx:e,canvas:null,canvasWidthPx:k,canvasHeightPx:z})}})}else if(h){_&&(e.strokeStyle="green",e.strokeRect(0,0,a,l));const i="rpx"==O.unit?d(V*t):V*t,u="rpx"==O.unit?d(w*t):w*t,n="rpx"==O.unit?d(G+w*t):G+w*t;e.font=`${c} ${y} ${i}px/${u}px ${x} ${v} ${b||"sans-serif"}`,e.fillStyle=g,e.fillText(h,U,n),M({ctx:e,canvas:null,canvasWidthPx:k,canvasHeightPx:z})}}}))}function M({ctx:e,canvas:t,canvasWidthPx:a,canvasHeightPx:l}){e.draw(!1,(()=>{s({width:a,height:l,destWidth:a,destHeight:l,canvasId:"waterCanvas",success:function(e){N.value=e.tempFilePath}})}))}return i((()=>{u((function(){return e(this,null,(function*(){yield G()}))}))})),n((()=>O),(()=>e(this,null,(function*(){yield G()}))),{deep:!0}),(e,t)=>{const a=V,l=w;return p(),f(l,null,{default:h((()=>[g(e.$slots,"default"),c(l,{class:"overflow fixed",style:{left:"-999px"}},{default:h((()=>[c(a,{id:"waterCanvas","canvas-id":"waterCanvas",style:v({width:`${H.value.width}${O.unit}`,height:`${H.value.height}${O.unit}`})},null,8,["style"])])),_:1}),c(l,{class:x(O.fullscreen?"fixed":"absolute"),style:v(y(U))},null,8,["class","style"])])),_:3})}}}),k=t({__name:"watermark",setup(e){const t=a({content:"TMUI",fontSize:12,lineHeight:12,fullscreen:!1,width:60,height:60,xGap:0,yGap:0,xOffset:14,yOffset:30,rotate:-20,image:"",imageOpacity:.24,imageWidth:60,imageHeight:60});function l(e){t.value.image=e[0].url}return(e,a)=>{const i=w;return p(),f(U,null,{default:h((()=>[c(_,{followDark:!1},{default:h((()=>[c(S,{_class:"text-weight-b",label:"页面水印"}),c(S,{"font-size":24,label:"简单点，满足就好"})])),_:1}),c(M,{selectable:"","font-size":t.value.fontSize,"line-height":t.value.lineHeight,fullscreen:t.value.fullscreen,width:t.value.width,height:t.value.height,"x-offset":t.value.xOffset,"y-offset":t.value.yOffset,"x-gap":t.value.xGap,"y-gap":t.value.yGap,rotate:t.value.rotate,content:t.value.content,image:t.value.image,"image-width":t.value.imageWidth,"image-height":t.value.imageHeight,"image-opacity":t.value.imageOpacity},{default:h((()=>[c(_,null,{default:h((()=>[c(i,{class:"flex flex-row flex-row-bottom-start"},{default:h((()=>[c(S,{label:"属性设置"}),c(S,{"font-size":22,_class:"ml-10",label:"(实时生效)"})])),_:1}),c(O),c($,{modelValue:t.value.fullscreen,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value.fullscreen=e),defaultValue:!1},{default:h((()=>[c(H,{value:!0,label:"全屏幕"}),c(H,{value:!1,label:"包围内"})])),_:1},8,["modelValue"]),c(O),c(N,{prefixLabel:"文本内容",align:"right",placeholder:"请输入文本",modelValue:t.value.content,"onUpdate:modelValue":a[1]||(a[1]=e=>t.value.content=e)},null,8,["modelValue"]),c(N,{margin:[0,24],prefixLabel:"字体大小",align:"right",placeholder:"请输入字号",modelValue:t.value.fontSize,"onUpdate:modelValue":a[2]||(a[2]=e=>t.value.fontSize=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),c(N,{prefixLabel:"字体行高",align:"right",placeholder:"请输入行高",modelValue:t.value.lineHeight,"onUpdate:modelValue":a[3]||(a[3]=e=>t.value.lineHeight=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),c(N,{margin:[0,24],prefixLabel:"旋转角度",align:"right",placeholder:"请输入旋转角度",modelValue:t.value.rotate,"onUpdate:modelValue":a[4]||(a[4]=e=>t.value.rotate=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),c(N,{prefixLabel:"宽度",align:"right",placeholder:"请输入宽度",modelValue:t.value.width,"onUpdate:modelValue":a[5]||(a[5]=e=>t.value.width=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),c(N,{margin:[0,24],prefixLabel:"高度",align:"right",placeholder:"请输入高度",modelValue:t.value.height,"onUpdate:modelValue":a[6]||(a[6]=e=>t.value.height=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),c(N,{prefixLabel:"x 轴间隔",align:"right",placeholder:"请输入x 轴间隔",modelValue:t.value.xGap,"onUpdate:modelValue":a[7]||(a[7]=e=>t.value.xGap=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),c(N,{margin:[0,24],prefixLabel:"y 轴间隔",align:"right",placeholder:"请输入y 轴间隔",modelValue:t.value.yGap,"onUpdate:modelValue":a[8]||(a[8]=e=>t.value.yGap=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),c(N,{prefixLabel:"x 轴偏移",align:"right",placeholder:"请输入x 轴偏移",modelValue:t.value.xOffset,"onUpdate:modelValue":a[9]||(a[9]=e=>t.value.xOffset=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),c(N,{margin:[0,24],prefixLabel:"y 轴偏移",align:"right",placeholder:"请输入y 轴偏移",modelValue:t.value.yOffset,"onUpdate:modelValue":a[10]||(a[10]=e=>t.value.yOffset=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),c(G,{width:636,onChange:l,rows:1,maxFile:1,url:"https://mockapi.eolink.com/tNYKNA7ac71aa90bcbe83c5815871a5b419601e96a5524d/upload"}),c(N,{margin:[0,24],prefixLabel:"图片宽度",align:"right",placeholder:"请输入图片宽度",modelValue:t.value.imageWidth,"onUpdate:modelValue":a[11]||(a[11]=e=>t.value.imageWidth=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),c(N,{prefixLabel:"图片高度",align:"right",placeholder:"请输入图片高度",modelValue:t.value.imageHeight,"onUpdate:modelValue":a[12]||(a[12]=e=>t.value.imageHeight=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),c(N,{margin:[0,24],prefixLabel:"图片透明度",align:"right",placeholder:"请输入图片透明度",modelValue:t.value.imageOpacity,"onUpdate:modelValue":a[13]||(a[13]=e=>t.value.imageOpacity=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"])])),_:1})])),_:1},8,["font-size","line-height","fullscreen","width","height","x-offset","y-offset","x-gap","y-gap","rotate","content","image","image-width","image-height","image-opacity"])])),_:1})}}});export{k as default};
