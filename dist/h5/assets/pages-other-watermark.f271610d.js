import{d as e,r as t,c as a,p as l,m as i,R as u,S as n,I as o,L as r,Z as d,T as m,o as s,a as p,w as f,N as g,b as h,n as c,O as v,u as x,g as y,H as b,j as V}from"./index-5c06cf16.js";import{t as w}from"./tm-sheet.2873fe67.js";import{t as _}from"./tm-text.fdd4f0a8.js";import{_ as S}from"./tm-divider.vue_vue_type_script_setup_true_lang.0bd9a5e3.js";import{_ as O,a as $}from"./tm-radio.vue_vue_type_script_setup_true_lang.8fe0c58b.js";import{t as H}from"./tm-input.12bd2bac.js";import{t as N}from"./tm-app.20954b06.js";import{_ as U}from"./tm-upload.vue_vue_type_script_setup_true_lang.eb626325.js";import"./tm-icon.5716c798.js";import"./tm-button.5fc2eaaa.js";import"./tm-image.vue_vue_type_script_setup_true_lang.f325e7c1.js";import"./tm-translate.4fbb7927.js";const z=e({__name:"tm-watermark",props:{cross:Boolean,debug:Boolean,fullscreen:Boolean,width:{type:Number,default:64},height:{type:Number,default:64},zIndex:{type:Number,default:999},xGap:{type:Number,default:0},yGap:{type:Number,default:0},yOffset:{type:Number,default:0},xOffset:{type:Number,default:0},rotate:{type:Number,default:0},image:String,imageOpacity:{type:Number,default:1},imageHeight:Number,imageWidth:Number,content:String,selectable:{type:Boolean,default:!0},fontSize:{type:Number,default:14},fontFamily:String,fontStyle:{type:String,default:"normal"},fontVariant:{type:String,default:""},fontWeight:{type:Number,default:400},fontColor:{type:String,default:"rgba(128, 128, 128, .3)"},fontStretch:{type:String,default:""},lineHeight:{type:Number,default:14},unit:{type:String,default:"rpx"}},setup(e){var w;const _=e,S=(null==(w=y())?void 0:w.proxy)??null;t();const O=t({width:_.width,height:_.height}),$=t(),H=a((()=>({zIndex:_.zIndex,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat",top:0,left:0,backgroundSize:"rpx"==_.unit?`${r(_.xGap+_.width)} px`:`${_.xGap+_.width} px`,backgroundPosition:_.cross?`${"rpx"==_.unit?r(_.width/2):_.width/2}px ${"rpx"==_.unit?r(_.height/2):_.height/2}px, 0 0`:"",backgroundImage:_.cross?`url(${$.value}), url(${$.value})`:`url(${$.value})`})));async function N(){const e=n("waterCanvas",S),t=o().pixelRatio,{xGap:a,yGap:l,width:i,height:u,yOffset:m,xOffset:s,rotate:p,image:f,content:g,fontColor:h,fontStyle:c,fontVariant:v,fontStretch:x,fontWeight:y,fontFamily:b,fontSize:V,lineHeight:w,debug:$}=_,H=(a+(i>0?i:1))*t,N=(l+(u>0?u:1))*t,z="rpx"==_.unit?r(s*t):s*t,G="rpx"==_.unit?r(m*t):m*t,L="rpx"==_.unit?r(H):H,M="rpx"==_.unit?r(N):N;if(O.value={width:H,height:N},e){e.translate(0,0);const a="rpx"==_.unit?r(i*t):i*t,l="rpx"==_.unit?r(u*t):u*t;if($&&(e.strokeStyle="grey",e.strokeRect(0,0,a,l)),e.rotate(p*(Math.PI/180)),f){const{imageWidth:a,imageHeight:l}=_;await d({src:f,success:function(i){e.globalAlpha=_.imageOpacity,e.drawImage(f,z,G,(_.imageWidth||(l?i.width*l/i.height:i.width))*t,(_.imageHeight||(a?i.height*a/i.width:i.height))*t),U({ctx:e,canvas:null,canvasWidthPx:L,canvasHeightPx:M})}})}else if(g){$&&(e.strokeStyle="green",e.strokeRect(0,0,a,l));const i="rpx"==_.unit?r(V*t):V*t,u="rpx"==_.unit?r(w*t):w*t,n="rpx"==_.unit?r(G+w*t):G+w*t;e.font=`${c} ${y} ${i}px/${u}px ${x} ${v} ${b||"sans-serif"}`,e.fillStyle=h,e.fillText(g,z,n),U({ctx:e,canvas:null,canvasWidthPx:L,canvasHeightPx:M})}}}function U({ctx:e,canvas:t,canvasWidthPx:a,canvasHeightPx:l}){e.draw(!1,(()=>{m({width:a,height:l,destWidth:a,destHeight:l,canvasId:"waterCanvas",success:function(e){$.value=e.tempFilePath}})}))}return l((()=>{i((async function(){await N()}))})),u((()=>_),(async()=>{await N()}),{deep:!0}),(e,t)=>{const a=b,l=V;return s(),p(l,null,{default:f((()=>[g(e.$slots,"default"),h(l,{class:"overflow fixed",style:{left:"-999px"}},{default:f((()=>[h(a,{id:"waterCanvas","canvas-id":"waterCanvas",style:c({width:`${O.value.width}${_.unit}`,height:`${O.value.height}${_.unit}`})},null,8,["style"])])),_:1}),h(l,{class:v(_.fullscreen?"fixed":"absolute"),style:c(x(H))},null,8,["class","style"])])),_:3})}}}),G=e({__name:"watermark",setup(e){const a=t({content:"TMUI",fontSize:12,lineHeight:12,fullscreen:!1,width:60,height:60,xGap:0,yGap:0,xOffset:14,yOffset:30,rotate:-20,image:"",imageOpacity:.24,imageWidth:60,imageHeight:60});function l(e){a.value.image=e[0].url}return(e,t)=>{const i=V;return s(),p(N,null,{default:f((()=>[h(w,{followDark:!1},{default:f((()=>[h(_,{_class:"text-weight-b",label:"页面水印"}),h(_,{"font-size":24,label:"简单点，满足就好"})])),_:1}),h(z,{selectable:"","font-size":a.value.fontSize,"line-height":a.value.lineHeight,fullscreen:a.value.fullscreen,width:a.value.width,height:a.value.height,"x-offset":a.value.xOffset,"y-offset":a.value.yOffset,"x-gap":a.value.xGap,"y-gap":a.value.yGap,rotate:a.value.rotate,content:a.value.content,image:a.value.image,"image-width":a.value.imageWidth,"image-height":a.value.imageHeight,"image-opacity":a.value.imageOpacity},{default:f((()=>[h(w,null,{default:f((()=>[h(i,{class:"flex flex-row flex-row-bottom-start"},{default:f((()=>[h(_,{label:"属性设置"}),h(_,{"font-size":22,_class:"ml-10",label:"(实时生效)"})])),_:1}),h(S),h(O,{modelValue:a.value.fullscreen,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value.fullscreen=e),defaultValue:!1},{default:f((()=>[h($,{value:!0,label:"全屏幕"}),h($,{value:!1,label:"包围内"})])),_:1},8,["modelValue"]),h(S),h(H,{prefixLabel:"文本内容",align:"right",placeholder:"请输入文本",modelValue:a.value.content,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value.content=e)},null,8,["modelValue"]),h(H,{margin:[0,24],prefixLabel:"字体大小",align:"right",placeholder:"请输入字号",modelValue:a.value.fontSize,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value.fontSize=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),h(H,{prefixLabel:"字体行高",align:"right",placeholder:"请输入行高",modelValue:a.value.lineHeight,"onUpdate:modelValue":t[3]||(t[3]=e=>a.value.lineHeight=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),h(H,{margin:[0,24],prefixLabel:"旋转角度",align:"right",placeholder:"请输入旋转角度",modelValue:a.value.rotate,"onUpdate:modelValue":t[4]||(t[4]=e=>a.value.rotate=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),h(H,{prefixLabel:"宽度",align:"right",placeholder:"请输入宽度",modelValue:a.value.width,"onUpdate:modelValue":t[5]||(t[5]=e=>a.value.width=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),h(H,{margin:[0,24],prefixLabel:"高度",align:"right",placeholder:"请输入高度",modelValue:a.value.height,"onUpdate:modelValue":t[6]||(t[6]=e=>a.value.height=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),h(H,{prefixLabel:"x 轴间隔",align:"right",placeholder:"请输入x 轴间隔",modelValue:a.value.xGap,"onUpdate:modelValue":t[7]||(t[7]=e=>a.value.xGap=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),h(H,{margin:[0,24],prefixLabel:"y 轴间隔",align:"right",placeholder:"请输入y 轴间隔",modelValue:a.value.yGap,"onUpdate:modelValue":t[8]||(t[8]=e=>a.value.yGap=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),h(H,{prefixLabel:"x 轴偏移",align:"right",placeholder:"请输入x 轴偏移",modelValue:a.value.xOffset,"onUpdate:modelValue":t[9]||(t[9]=e=>a.value.xOffset=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),h(H,{margin:[0,24],prefixLabel:"y 轴偏移",align:"right",placeholder:"请输入y 轴偏移",modelValue:a.value.yOffset,"onUpdate:modelValue":t[10]||(t[10]=e=>a.value.yOffset=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),h(U,{width:636,onChange:l,rows:1,maxFile:1,url:"https://mockapi.eolink.com/tNYKNA7ac71aa90bcbe83c5815871a5b419601e96a5524d/upload"}),h(H,{margin:[0,24],prefixLabel:"图片宽度",align:"right",placeholder:"请输入图片宽度",modelValue:a.value.imageWidth,"onUpdate:modelValue":t[11]||(t[11]=e=>a.value.imageWidth=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),h(H,{prefixLabel:"图片高度",align:"right",placeholder:"请输入图片高度",modelValue:a.value.imageHeight,"onUpdate:modelValue":t[12]||(t[12]=e=>a.value.imageHeight=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"]),h(H,{margin:[0,24],prefixLabel:"图片透明度",align:"right",placeholder:"请输入图片透明度",modelValue:a.value.imageOpacity,"onUpdate:modelValue":t[13]||(t[13]=e=>a.value.imageOpacity=e),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"])])),_:1})])),_:1},8,["font-size","line-height","fullscreen","width","height","x-offset","y-offset","x-gap","y-gap","rotate","content","image","image-width","image-height","image-opacity"])])),_:1})}}});export{G as default};
