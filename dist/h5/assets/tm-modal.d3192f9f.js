import{d as e,r as l,c as t,R as a,p as o,o as n,a as r,w as s,b as i,N as u,u as d,V as c,n as f,O as p,k as y,ay as v,g as h,L as m,Q as x,m as b,j as k,$ as g,_ as w}from"./index-5c06cf16.js";import{t as _}from"./tm-translate.4fbb7927.js";import{t as C}from"./tm-text.fdd4f0a8.js";import{t as S}from"./tm-icon.5716c798.js";import{t as B}from"./tm-overlay.3ea1101a.js";import{t as N}from"./tm-sheet.2873fe67.js";import{c as T,u as I,f as z,g as D,d as j,h as L}from"./tm-app.20954b06.js";const R=w(e({__name:"tm-modal",props:{...T,mask:{type:[Boolean],default:!1},border:{type:Number,default:2},show:{type:[Boolean],default:!1},width:{type:Number,default:600},height:{type:Number,default:450},round:{type:Number,default:10},duration:{type:Number,default:250},overlayClick:{type:Boolean,default:!0},transprent:{type:[Boolean],default:!1},closeable:{type:[Boolean],default:!1},color:{type:String,default:"white"},title:[String],okText:{type:[String],default:"完成"},okColor:{type:[String],default:"primary"},okLinear:{type:[String],default:""},okLlinearDeep:{type:[String],default:"accent"},cancelColor:{type:[String],default:"primary"},cancelText:{type:[String],default:"取消"},cancelLinear:{type:[String],default:""},cancelLlinearDeep:{type:[String],default:"accent"},btnRound:{type:Number,default:24},hideCancel:{type:[Boolean],default:!1},splitBtn:{type:Boolean,default:!1},beforeClose:{type:Function,default:()=>()=>!0},content:{type:String,default:""},disabled:{type:Boolean,default:!1},titleStyle:{type:[Array,String,Object],default:()=>[]},zIndex:{type:[Number,String],default:999},teleport:{type:Boolean,default:!0}},emits:["click","open","close","update:show","ok","cancel"],setup(e,{expose:w,emit:T}){var R;const $=e,A=l(null),E=l(null),O=I();null==(R=h())||R.proxy;const P=t((()=>O.tmStore)),U=t((()=>z($))),V=t((()=>D($))),F=t((()=>j($,P.value))),J=t((()=>L($,F.value,P.value)));let Q=null,Y=null,Z=!1,q=null;const G=l(!0);let H=!1;uni.$tm.u.getUid(4);const K=l(!1);let M=l($.show),W=NaN;function X(e,l=500,t=!1){if(isNaN(W)||clearTimeout(W),t){var a=!W;W=setTimeout((()=>{W=NaN}),l),a&&"function"==typeof e&&e()}else W=setTimeout((()=>{"function"==typeof e&&e()}),l)}function ee(e,l=500,t=!0){t?H||(H=!0,"function"==typeof e&&e(),setTimeout((()=>{H=!1}),l)):H||(H=!0,setTimeout((()=>{H=!1,"function"==typeof e&&e()}),l))}a((()=>$.show),(e=>{e?fe():pe()})),o((()=>{M.value&&fe()}));const le=t((()=>"round-"+$.round)),te=t((()=>"zoom"!=ae.value?G.value:!G.value)),ae=t((()=>"zoom")),oe=t((()=>$.width+"rpx")),ne=t((()=>$.height+"rpx")),re=t((()=>{let e=0;return $.splitBtn&&(e=m(64)),m($.height)-44-m(90)-e+"px"})),se=t((()=>"flex-center"));async function ie(){$.disabled||X((async()=>{try{if("function"==typeof $.beforeClose){K.value=!0;let e=await $.beforeClose();if("function"==typeof e&&(e=await e()),K.value=!1,!e)return}T("ok",x(q)),Z=!0,pe()}catch(e){K.value=!1}}),250,!0)}function ue(){$.disabled||K.value||(Z=!1,T("cancel",x(q)),pe())}function de(){b((function(){var e;null==(e=A.value)||e.play()})),T("open"),T("update:show",!0),M.value=!0}function ce(){b((()=>{T("close"),T("update:show",!1),M.value=!1,Y&&Z&&Y(),Q&&!Z&&Q()}))}function fe(){$.disabled||K.value||1!=M.value&&X((()=>{var e;G.value=!0,M.value=!0,null==(e=E.value)||e.open(!0)}),$.duration,!0)}async function pe(e=null){var l,t;G.value=!1,A.value&&(null==(l=E.value)||l.close(),null==(t=A.value)||t.play())}function ye(e){0!=M.value&&(T("click",e),$.overlayClick&&!$.disabled&&!K.value&&E.value&&(G.value=!1,ee((()=>{var e,l;Z=!1,null==(e=E.value)||e.close(),null==(l=A.value)||l.play()}),$.duration,!0)))}return w({close:pe,open:function(e=null){if(!K.value&&1!=M.value)return new Promise(((l,t)=>{ee((async()=>{var a;G.value=!0,null==(a=E.value)||a.open(!0),q=e,Q=t,Y=l}),$.duration,!0)}))}}),(l,t)=>{const a=k,o=g;return n(),r(a,null,{default:s((()=>[i(a,{onClick:fe},{default:s((()=>[u(l.$slots,"trigger",{},void 0,!0)])),_:3}),i(B,{zIndex:$.zIndex,ref_key:"overlayAni",ref:E,blur:"",duration:$.duration,onClose:ce,onOpen:de,onClick:ye,align:d(se),overlayClick:!1,show:d(M),"onUpdate:show":t[1]||(t[1]=e=>v(M)?M.value=e:M=e),teleport:$.teleport},{default:s((()=>[i(_,{reverse:d(te),width:d(oe),height:d(ne),ref_key:"drawerANI",ref:A,"auto-play":!1,name:d(ae),duration:$.duration},{default:s((()=>[i(a,{onClick:t[0]||(t[0]=c((e=>e.stopPropagation()),["stop"])),style:f([{width:d(oe),height:d(ne),boxSizing:"border-box"},$.transprent?"":d(J).borderCss,$.transprent?"":d(J).backgroundColorCss,$.transprent?"":d(J).shadowColor,d(U)]),class:p([d(le),"flex flex-col overflow ",d(V)])},{default:s((()=>[i(a,{class:p(["flex flex-row px-24",[$.closeable?"flex-row-center-between":"flex-center"]]),style:{height:"44px"}},{default:s((()=>[u(l.$slots,"title",{},(()=>[i(C,{_style:$.titleStyle,dark:$.dark,followTheme:!1,_class:"text-overflow-1 text-weight-b text-size-m text-align-center",label:$.title},null,8,["_style","dark","label"])]),!0),e.closeable?(n(),r(S,{key:0,_class:"opacity-3",name:"tmicon-times-circle-fill",fontSize:32,onClick:pe})):y("v-if",!0)])),_:3},8,["class"]),i(o,{"scroll-y":"",style:f([$.height?{height:d(re)}:""])},{default:s((()=>[i(a,{class:"px-32"},{default:s((()=>[u(l.$slots,"default",{},(()=>[i(C,{"font-size":30,dark:$.dark,followTheme:!1,label:$.content,_style:"line-height:46rpx"},null,8,["dark","label"])]),!0)])),_:3})])),_:3},8,["style"]),i(a,{class:p(["flex flex-row",[$.splitBtn?"pa-32":""]])},{default:s((()=>[u(l.$slots,"button",{},(()=>[$.hideCancel?y("v-if",!0):(n(),r(a,{key:0,class:"flex-1 overflow",style:{height:"90rpx"}},{default:s((()=>[i(N,{dark:$.dark,followTheme:!0,isDisabledRoundAndriod:!0,onClick:ue,height:90,linear:$.cancelLinear,linearDeep:$.cancelLlinearDeep,text:"",color:$.cancelColor,_class:["flex-center overflow flex"],"paren-class":$.splitBtn?"round-"+$.btnRound:"round-bl-"+$.round,margin:[0,0],padding:[0,0]},{default:s((()=>[i(C,{_class:"text-weight-b",_style:"line-height:90rpx",dark:$.dark,followTheme:!1,userInteractionEnabled:!1,label:$.cancelText},null,8,["dark","label"])])),_:1},8,["dark","linear","linearDeep","color","paren-class"])])),_:1})),$.splitBtn&&!$.hideCancel?(n(),r(a,{key:1,class:"overflow",style:{width:"24rpx"}})):y("v-if",!0),i(a,{class:p(["flex-1 flex",[K.value?"opacity-5":"","overflow"]]),style:{height:"90rpx"}},{default:s((()=>[i(N,{paretClass:"flex-1",class:"flex-1",dark:$.dark,followTheme:!0,isDisabledRoundAndriod:!0,onClick:ie,height:90,linear:$.okLinear,linearDeep:$.okLlinearDeep,color:$.okColor,margin:[0,0],_class:["flex-center overflow"],"paren-class":$.splitBtn?"round-"+$.btnRound:"round-br-"+$.round,padding:[0,0]},{default:s((()=>[i(a,{userInteractionEnabled:!1,class:"flex flex-row"},{default:s((()=>[K.value?(n(),r(a,{key:0,class:"pr-10"},{default:s((()=>[i(S,{userInteractionEnabled:!1,name:"tmicon-loading",spin:""})])),_:1})):y("v-if",!0),i(C,{_class:"text-weight-b",dark:$.dark,userInteractionEnabled:!1,label:$.okText},null,8,["dark","label"])])),_:1})])),_:1},8,["dark","linear","linearDeep","color","paren-class"])])),_:1},8,["class"])]),!0)])),_:3},8,["class"])])),_:3},8,["style","class"])])),_:3},8,["reverse","width","height","name","duration"])])),_:3},8,["zIndex","duration","align","show","teleport"])])),_:3})}}}),[["__scopeId","data-v-7aa030ad"]]);export{R as t};
