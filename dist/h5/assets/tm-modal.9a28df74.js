var e=Object.defineProperty,l=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(l,t,a)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,s=(e,l,t)=>new Promise(((a,o)=>{var n=e=>{try{s(t.next(e))}catch(l){o(l)}},r=e=>{try{s(t.throw(e))}catch(l){o(l)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,r);s((t=t.apply(e,l)).next())}));import{d as i,r as u,c,Q as d,m as f,o as p,a as y,w as v,b as h,M as m,u as b,U as x,n as g,N as k,j as w,ay as _,g as C,K as S,P as j,k as B,i as N,$ as T,_ as I}from"./index-6b165856.js";import{t as D}from"./tm-translate.1f1c80c0.js";import{t as O}from"./tm-text.6c910eb0.js";import{t as P}from"./tm-icon.65b53dc0.js";import{t as z}from"./tm-overlay.a19aca82.js";import{t as L}from"./tm-sheet.3639b36a.js";import{c as $,u as A,f as E,g as R,d as U,h as F}from"./tm-app.d6cf2f93.js";const J=i({__name:"tm-modal",props:(K=((e,l)=>{for(var t in l||(l={}))o.call(l,t)&&r(e,t,l[t]);if(a)for(var t of a(l))n.call(l,t)&&r(e,t,l[t]);return e})({},$),M={mask:{type:[Boolean],default:!1},border:{type:Number,default:2},show:{type:[Boolean],default:!1},width:{type:Number,default:600},height:{type:Number,default:450},round:{type:Number,default:10},duration:{type:Number,default:250},overlayClick:{type:Boolean,default:!0},transprent:{type:[Boolean],default:!1},closeable:{type:[Boolean],default:!1},color:{type:String,default:"white"},title:[String],okText:{type:[String],default:"完成"},okColor:{type:[String],default:"primary"},okLinear:{type:[String],default:""},okLlinearDeep:{type:[String],default:"accent"},cancelColor:{type:[String],default:"primary"},cancelText:{type:[String],default:"取消"},cancelLinear:{type:[String],default:""},cancelLlinearDeep:{type:[String],default:"accent"},btnRound:{type:Number,default:24},hideCancel:{type:[Boolean],default:!1},splitBtn:{type:Boolean,default:!1},beforeClose:{type:Function,default:()=>()=>!0},content:{type:String,default:""},disabled:{type:Boolean,default:!1},titleStyle:{type:[Array,String,Object],default:()=>[]},zIndex:{type:[Number,String],default:999},teleport:{type:Boolean,default:!0}},l(K,t(M))),emits:["click","open","close","update:show","ok","cancel"],setup(e,{expose:l,emit:t}){var a;const o=e,n=u(null),r=u(null),i=A();null==(a=C())||a.proxy;const I=c((()=>i.tmStore)),$=c((()=>E(o))),J=c((()=>R(o))),K=c((()=>U(o,I.value))),M=c((()=>F(o,K.value,I.value)));let Q=null,V=null,Y=!1,Z=null;const q=u(!0);let G=!1;uni.$tm.u.getUid(4);const H=u(!1);let W=u(o.show),X=NaN;function ee(e,l=500,t=!1){if(isNaN(X)||clearTimeout(X),t){var a=!X;X=setTimeout((()=>{X=NaN}),l),a&&"function"==typeof e&&e()}else X=setTimeout((()=>{"function"==typeof e&&e()}),l)}function le(e,l=500,t=!0){t?G||(G=!0,"function"==typeof e&&e(),setTimeout((()=>{G=!1}),l)):G||(G=!0,setTimeout((()=>{G=!1,"function"==typeof e&&e()}),l))}d((()=>o.show),(e=>{e?pe():ye()})),f((()=>{W.value&&pe()}));const te=c((()=>"round-"+o.round)),ae=c((()=>"zoom"!=oe.value?q.value:!q.value)),oe=c((()=>"zoom")),ne=c((()=>o.width+"rpx")),re=c((()=>o.height+"rpx")),se=c((()=>{let e=0;return o.splitBtn&&(e=S(64)),S(o.height)-44-S(90)-e+"px"})),ie=c((()=>"flex-center"));function ue(){return s(this,null,(function*(){o.disabled||ee((()=>s(this,null,(function*(){try{if("function"==typeof o.beforeClose){H.value=!0;let e=yield o.beforeClose();if("function"==typeof e&&(e=yield e()),H.value=!1,!e)return}t("ok",j(Z)),Y=!0,ye()}catch(e){H.value=!1}}))),250,!0)}))}function ce(){o.disabled||H.value||(Y=!1,t("cancel",j(Z)),ye())}function de(){B((function(){var e;null==(e=n.value)||e.play()})),t("open"),t("update:show",!0),W.value=!0}function fe(){B((()=>{t("close"),t("update:show",!1),W.value=!1,V&&Y&&V(),Q&&!Y&&Q()}))}function pe(){o.disabled||H.value||1!=W.value&&ee((()=>{var e;q.value=!0,W.value=!0,null==(e=r.value)||e.open(!0)}),o.duration,!0)}function ye(e=null){return s(this,null,(function*(){var e,l;q.value=!1,n.value&&(null==(e=r.value)||e.close(),null==(l=n.value)||l.play())}))}function ve(e){0!=W.value&&(t("click",e),o.overlayClick&&!o.disabled&&!H.value&&r.value&&(q.value=!1,le((()=>{var e,l;Y=!1,null==(e=r.value)||e.close(),null==(l=n.value)||l.play()}),o.duration,!0)))}return l({close:ye,open:function(e=null){if(!H.value&&1!=W.value)return new Promise(((l,t)=>{le((()=>s(this,null,(function*(){var a;q.value=!0,null==(a=r.value)||a.open(!0),Z=e,Q=t,V=l}))),o.duration,!0)}))}}),(l,t)=>{const a=N,s=T;return p(),y(a,null,{default:v((()=>[h(a,{onClick:pe},{default:v((()=>[m(l.$slots,"trigger",{},void 0,!0)])),_:3}),h(z,{zIndex:o.zIndex,ref_key:"overlayAni",ref:r,blur:"",duration:o.duration,onClose:fe,onOpen:de,onClick:ve,align:b(ie),overlayClick:!1,show:b(W),"onUpdate:show":t[1]||(t[1]=e=>_(W)?W.value=e:W=e),teleport:o.teleport},{default:v((()=>[h(D,{reverse:b(ae),width:b(ne),height:b(re),ref_key:"drawerANI",ref:n,"auto-play":!1,name:b(oe),duration:o.duration},{default:v((()=>[h(a,{onClick:t[0]||(t[0]=x((e=>e.stopPropagation()),["stop"])),style:g([{width:b(ne),height:b(re),boxSizing:"border-box"},o.transprent?"":b(M).borderCss,o.transprent?"":b(M).backgroundColorCss,o.transprent?"":b(M).shadowColor,b($)]),class:k([b(te),"flex flex-col overflow ",b(J)])},{default:v((()=>[h(a,{class:k(["flex flex-row px-24",[o.closeable?"flex-row-center-between":"flex-center"]]),style:{height:"44px"}},{default:v((()=>[m(l.$slots,"title",{},(()=>[h(O,{_style:o.titleStyle,dark:o.dark,followTheme:!1,_class:"text-overflow-1 text-weight-b text-size-m text-align-center",label:o.title},null,8,["_style","dark","label"])]),!0),e.closeable?(p(),y(P,{key:0,_class:"opacity-3",name:"tmicon-times-circle-fill",fontSize:32,onClick:ye})):w("v-if",!0)])),_:3},8,["class"]),h(s,{"scroll-y":"",style:g([o.height?{height:b(se)}:""])},{default:v((()=>[h(a,{class:"px-32"},{default:v((()=>[m(l.$slots,"default",{},(()=>[h(O,{"font-size":30,dark:o.dark,followTheme:!1,label:o.content,_style:"line-height:46rpx"},null,8,["dark","label"])]),!0)])),_:3})])),_:3},8,["style"]),h(a,{class:k(["flex flex-row",[o.splitBtn?"pa-32":""]])},{default:v((()=>[m(l.$slots,"button",{},(()=>[o.hideCancel?w("v-if",!0):(p(),y(a,{key:0,class:"flex-1 overflow",style:{height:"90rpx"}},{default:v((()=>[h(L,{dark:o.dark,followTheme:!0,isDisabledRoundAndriod:!0,onClick:ce,height:90,linear:o.cancelLinear,linearDeep:o.cancelLlinearDeep,text:"",color:o.cancelColor,_class:["flex-center overflow flex"],"paren-class":o.splitBtn?"round-"+o.btnRound:"round-bl-"+o.round,margin:[0,0],padding:[0,0]},{default:v((()=>[h(O,{_class:"text-weight-b",_style:"line-height:90rpx",dark:o.dark,followTheme:!1,userInteractionEnabled:!1,label:o.cancelText},null,8,["dark","label"])])),_:1},8,["dark","linear","linearDeep","color","paren-class"])])),_:1})),o.splitBtn&&!o.hideCancel?(p(),y(a,{key:1,class:"overflow",style:{width:"24rpx"}})):w("v-if",!0),h(a,{class:k(["flex-1 flex",[H.value?"opacity-5":"","overflow"]]),style:{height:"90rpx"}},{default:v((()=>[h(L,{paretClass:"flex-1",class:"flex-1",dark:o.dark,followTheme:!0,isDisabledRoundAndriod:!0,onClick:ue,height:90,linear:o.okLinear,linearDeep:o.okLlinearDeep,color:o.okColor,margin:[0,0],_class:["flex-center overflow"],"paren-class":o.splitBtn?"round-"+o.btnRound:"round-br-"+o.round,padding:[0,0]},{default:v((()=>[h(a,{userInteractionEnabled:!1,class:"flex flex-row"},{default:v((()=>[H.value?(p(),y(a,{key:0,class:"pr-10"},{default:v((()=>[h(P,{userInteractionEnabled:!1,name:"tmicon-loading",spin:""})])),_:1})):w("v-if",!0),h(O,{_class:"text-weight-b",dark:o.dark,userInteractionEnabled:!1,label:o.okText},null,8,["dark","label"])])),_:1})])),_:1},8,["dark","linear","linearDeep","color","paren-class"])])),_:1},8,["class"])]),!0)])),_:3},8,["class"])])),_:3},8,["style","class"])])),_:3},8,["reverse","width","height","name","duration"])])),_:3},8,["zIndex","duration","align","show","teleport"])])),_:3})}}});var K,M;const Q=I(J,[["__scopeId","data-v-7aa030ad"]]);export{Q as t};
