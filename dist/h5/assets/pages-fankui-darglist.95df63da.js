var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a;import{d as r,r as u,Q as i,o as p,a as f,w as c,b as d,e as v,f as h,F as g,n as m,N as x,k as b,K as y,i as _,j as w,U as T,P as N,_ as j}from"./index-6b165856.js";import{t as O}from"./tm-app.d6cf2f93.js";import{t as P}from"./tm-sheet.3639b36a.js";import{t as M}from"./tm-text.6c910eb0.js";import{t as I}from"./tm-icon.65b53dc0.js";const S=j(r({__name:"tm-drag-list",props:{disabled:{type:[String,Boolean],default:!1},width:{type:Number,default:700},height:{type:Number,default:90},list:{type:Array,default:()=>[]},rangKey:{type:String,default:"text"},rightIcon:{type:String,default:"icon-menu"},bgColor:{type:String,default:"white"}},emits:["change"],setup(e,{emit:r}){const j=e,O=u(0),S=u(0),k=u(0);let L=0;const z=u(NaN),D=u(NaN),Y=u([]),$=u(!1),C=u(!1);function E(e,t){if(e.preventDefault(),e.stopPropagation(),!j.disabled)if($.value=!1,D.value=t,Y.value,-1==e.type.indexOf("mouse")&&1==e.changedTouches.length){var l=e.changedTouches[0];L=l.pageY-e.currentTarget.offsetTop-Y.value[t].top}else L=e.pageY-e.currentTarget.offsetTop-Y.value[t].top}function K(e,r){if(j.disabled)return;if(e.preventDefault(),e.stopPropagation(),isNaN(D.value))return;let u=0;var i;-1==e.type.indexOf("mouse")&&1==e.changedTouches.length?u=e.changedTouches[0].pageY-L:u=e.pageY-L;Y.value.splice(r,1,(i=((e,t)=>{for(var l in t||(t={}))o.call(t,l)&&s(e,l,t[l]);if(a)for(var l of a(t))n.call(t,l)&&s(e,l,t[l]);return e})({},Y.value[r]),t(i,l({top:u}))));const p=r,f=Y.value[p].i,c=Y.value[p].__id;let d=Math.round(u/S.value);d=d<0?0:d,d=d>Y.value.length-1?Y.value.length-1:d,d=Math.abs(d),r=d;let v=[...Y.value];for(let t=0;t<v.length;t++)f<d?v[t].i>f&&v[t].i<=d&&(v[t].i-=1):f>d&&v[t].i<f&&v[t].i>=d&&(v[t].i+=1);v[p].i=d,v=v.map((e=>(e.__id!=c&&(e.top=e.i*S.value),e))),Y.value=v,z.value=d}function U(e,t){if(j.disabled)return;if(e.preventDefault(),e.stopPropagation(),D.value=NaN,$.value=!0,isNaN(z.value))return;let l=[...Y.value];l=l.map((e=>(e.top=e.i*S.value,e))),l.sort(((e,t)=>e.i-t.i)),Y.value=[...l],function(){if(j.disabled)return;r("change",N(Y.value))}()}return i((()=>j.list),(()=>{!function(){let e=uni.$tm.u.deepClone(j.list);b((function(){Y.value=[],O.value=y(j.width)||700,S.value=y(j.height)||120,k.value=S.value*e.length;for(let t=0;t<e.length;t++){let l=e[t];l.top=t*S.value,l.i=t,l.__id=uni.$tm.u.getUid()}Y.value=[...e]}))}(),console.log(8)}),{deep:!0,immediate:!0}),(t,l)=>{const a=_;return p(),f(a,{ref:"tm-dragList",class:"tm-dragList flex flex-col flex-col-center-center"},{default:c((()=>[d(a,{style:m({height:S.value*e.list.length+"px",width:O.value+"px"}),class:x(["relative flex flex-col",[e.disabled?"opacity-4":""]])},{default:c((()=>[(p(!0),v(g,null,h(Y.value,((e,t)=>(p(),f(a,{class:x(["overflow flex flex-col",["absolute","tm-dragList-item","flex-between"]]),key:t,style:m([{top:`${e.top}px`,height:S.value+"px",width:O.value+"px",zIndex:D.value==t?5:0},C.value?{"transition-delay":"0.1s"}:{"transition-duration":D.value==t||$.value?"0s":"0.25s"}])},{default:c((()=>[d(P,{"hover-class":"opacity-6",border:1,"border-direction":"bottom",color:D.value==t?"grey-3":"white",_class:"flex-1 flex flex-row flex-between",class:"flex-1",margin:[0,0],padding:[0,0]},{default:c((()=>[d(a,{class:"flex flex-row flex-row-center-start pl-12",style:m({height:S.value-1+"px"})},{default:c((()=>[e.icon?(p(),f(a,{key:0,class:"flex-shrink fulled-height flex-center"},{default:c((()=>[d(I,{color:e.color,name:e.icon,fontSize:40},null,8,["color","name"])])),_:2},1024)):w("v-if",!0),d(M,{_class:" pl-24","font-size":30,label:e.text},null,8,["label"])])),_:2},1032,["style"]),d(a,{style:m({height:S.value-1+"px",width:"100rpx"}),onTouchstart:T((e=>E(e,t)),["stop","prevent"]),onLongpress:e=>function(e){$.value=!1,D.value=e}(t),onMousedown:e=>E(e,t),onTouchmove:T((e=>K(e,t)),["stop","prevent"]),onMousemove:T((e=>K(e,t)),["stop","prevent"]),onTouchend:e=>U(e),onMouseup:e=>U(e),class:"flex-shrink flex flex-row flex-row-center-center opacity-3"},{default:c((()=>[d(I,{userInteractionEnabled:!1,name:"tmicon-menu"})])),_:2},1032,["style","onTouchstart","onLongpress","onMousedown","onTouchmove","onMousemove","onTouchend","onMouseup"])])),_:2},1032,["color"])])),_:2},1032,["style"])))),128))])),_:1},8,["style","class"])])),_:1},512)}}}),[["__scopeId","data-v-00179796"]]),k=r({__name:"darglist",setup(e){u(!1),u("bottom");const t=u([{text:"测试项目1-1"},{text:"测试项目2-1"},{text:"测试项目3-1"},{text:"测试项目4-1"},{text:"测试项目5-1"}]);return(e,l)=>(p(),f(O,null,{default:c((()=>[d(P,null,{default:c((()=>[d(M,{"font-size":24,_class:"font-weight-b",label:"长按图标开始拖动"})])),_:1}),d(S,{list:t.value},null,8,["list"])])),_:1}))}});export{k as default};
