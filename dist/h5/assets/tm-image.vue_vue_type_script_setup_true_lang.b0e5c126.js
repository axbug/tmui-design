var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a;import{d as i,r as s,c as u,O as d,Q as c,o as p,a as f,w as y,b as h,N as m,u as v,n as g,j as x,M as b,U as w,g as P,a3 as k,X as _,i as j}from"./index-6b165856.js";import{t as I}from"./tm-sheet.3639b36a.js";import{t as O}from"./tm-text.6c910eb0.js";import{t as S}from"./tm-icon.65b53dc0.js";import{t as B}from"./tm-translate.1f1c80c0.js";import{c as L}from"./tm-app.d6cf2f93.js";const E=i({__name:"tm-image",props:($=((e,t)=>{for(var l in t||(t={}))r.call(t,l)&&n(e,l,t[l]);if(a)for(var l of a(t))o.call(t,l)&&n(e,l,t[l]);return e})({},L),z={margin:{type:Array,default:()=>[0,0]},padding:{type:Array,default:()=>[0,0]},color:{type:String,default:"white"},transprent:{type:[Boolean,String],default:!0},border:{type:Number,default:0},width:{type:[Number],default:200,required:!0},height:{type:[Number],default:200,required:!0},src:{type:String,default:"",required:!0},errorIcon:{type:String,default:""},errorLabel:{type:String,default:"重新加载"},loadIcon:{type:String,default:""},showLoad:{type:Boolean,default:!0},preview:{type:[Boolean],default:!1},extra:{type:[Boolean],default:!1},extraPosition:{type:String,default:"in"},delete:{type:[Boolean],default:!1},allowDelete:{type:[Boolean],default:!0},model:{type:String,default:"scaleToFill"},unit:{type:String,default:"rpx"},showMenuByLongPress:{type:[Boolean],default:!1}},t($,l(z))),emits:["load","error","click","delete","close"],setup(e,{emit:t}){var l,a,r;const o=e,n=s(null),i=null!=(a=null==(l=P())?void 0:l.proxy)?a:null;o.height||o.width||console.error("错误：图片宽度和高度必须设置一个");const L=u((()=>o.width)),E=u((()=>o.height-o.padding[1])),$=u((()=>o.src)),z=s(!0),C=s(!1),K=s(!1),N=s(o.loadIcon||"tmicon-shuaxin"),q=s(o.errorIcon||"tmicon-exclamation-circle");let D=null==i?void 0:i.$parent;for(;D&&"tmImageGroup"!=(null==D?void 0:D.tmImageGroup)&&D;)D=null!=(r=null==D?void 0:D.$parent)?r:void 0;const G=d("ImagGrupList",u((()=>[])));function M(e){z.value=!1,t("load",e)}function A(e){console.error("图片加载错:"+o.src,e),C.value=!0,z.value=!1,t("error",e)}function F(e){if(t("click",e),o.preview){let e=G.value.length>0?G.value:[o.src];k({urls:e,current:o.src})}}function J(){return e=this,l=null,a=function*(){var e,l;K.value=!1,o.allowDelete?(null==(e=n.value)?void 0:e.play)?null==(l=n.value)||l.play():(K.value=!0,t("close",o.src)):t("delete",o.src)},new Promise(((t,r)=>{var o=e=>{try{i(a.next(e))}catch(t){r(t)}},n=e=>{try{i(a.throw(e))}catch(t){r(t)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,n);i((a=a.apply(e,l)).next())}));var e,l,a}function Q(){K.value=!0,t("close",o.src)}function T(){z.value=!0,C.value=!1}return(null==D?void 0:D.pushKey)&&D.pushKey({width:L.value,height:L.value,src:o.src}),c($,(()=>{z.value=!0,C.value=!1,(null==D?void 0:D.pushKey)&&D.pushKey({width:L.value,height:L.value,src:o.src})})),(e,t)=>{const l=_,a=j;return K.value?x("v-if",!0):(p(),f(a,{key:0,style:g([{margin:o.margin[0]+o.unit+" "+(o.margin[1]||o.margin[0])+o.unit}])},{default:y((()=>[h(B,{width:v(L)+2*o.padding[0]+o.unit,onEnd:Q,ref_key:"aniplay",ref:n,autoPlay:!1,name:"zoom",reverse:""},{default:y((()=>[h(I,{margin:[0],color:o.color,transprent:o.transprent,round:o.round,border:o.border,padding:[o.padding[0],0],class:m(["round-"+o.round]),width:v(L)-2*o.padding[0],unit:o.unit,height:v(E)-2*o.padding[0]},{default:y((()=>[h(a,{class:m([`pb-${o.padding[1]}`,"flex flex-col flex-col-center-center","relative"])},{default:y((()=>[C.value?x("v-if",!0):(p(),f(l,{key:0,onLoad:M,onError:A,"show-menu-by-longpress":o.showMenuByLongPress,onClick:F,class:m(["round-"+o.round,z.value?"opacity-0":""]),src:v($),style:g([{width:v(L)+o.unit,height:v(E)+o.unit}]),mode:o.model},null,8,["show-menu-by-longpress","class","src","style","mode"])),z.value&&!C.value?(p(),f(a,{key:1,style:g([{width:v(L)+o.unit,height:v(E)+10+o.unit}]),class:"flex flex-center opacity-3 absolute l-0 t-0"},{default:y((()=>[b(e.$slots,"load",{},(()=>[o.showLoad?(p(),f(S,{key:0,"font-size":26,spin:"",name:N.value},null,8,["name"])):x("v-if",!0)]))])),_:3},8,["style"])):x("v-if",!0),!z.value&&C.value?(p(),f(a,{key:2,style:g([{width:v(L)+o.unit,height:v(E)+o.unit}]),class:"flex flex-col flex-center opacity-5 absolute l-0 t-0"},{default:y((()=>[b(e.$slots,"error",{},(()=>[h(a,{onClick:T},{default:y((()=>[h(S,{userInteractionEnabled:!1,name:q.value},null,8,["name"]),h(O,{userInteractionEnabled:!1,_class:"pt-10","font-size":26,label:o.errorLabel},null,8,["label"])])),_:1})]))])),_:3},8,["style"])):x("v-if",!0),x(" extra "),o.extra?(p(),f(a,{key:3,eventPenetrationEnabled:!0,class:m(["in"==o.extraPosition?"absolute l-0 b-0 zIndex-5 ":"","flex flex-col flex-col-bottom-start "]),style:g([o.extra&&"in"==o.extraPosition?{height:v(E)+o.unit,width:v(L)+o.unit}:"",o.extra&&"out"==o.extraPosition?{width:v(L)+o.unit}:""])},{default:y((()=>[h(a,{onClick:w(F,["stop"]),class:m(["flex flex-col flex-col-bottom-start flex-1"]),style:g([o.extra&&"in"==o.extraPosition?{height:v(E)+o.unit,width:v(L)+o.unit}:"",o.extra&&"out"==o.extraPosition?{width:v(L)+o.unit}:""])},{default:y((()=>[b(e.$slots,"extra")])),_:3},8,["onClick","style"])])),_:3},8,["class","style"])):x("v-if",!0),x(" delete 展示删除按钮。 "),o.delete?(p(),f(a,{key:4,class:"absolute r-4 t-4 flex flex-col flex-col-center-end zIndex-10",style:g([o.delete?{width:v(L)+o.unit}:""])},{default:y((()=>[h(S,{onClick:J,color:"red",name:"tmicon-times-circle-fill"})])),_:1},8,["style"])):x("v-if",!0)])),_:3},8,["class"])])),_:3},8,["color","transprent","round","border","padding","class","width","unit","height"])])),_:3},8,["width"])])),_:3},8,["style"]))}}});var $,z;export{E as _};
