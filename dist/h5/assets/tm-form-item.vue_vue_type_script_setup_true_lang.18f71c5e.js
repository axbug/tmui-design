import{d as e,r as l,ad as t,at as a,c as r,R as o,o as i,a as u,w as n,N as d,m as s,Q as m,P as f,M as p,p as v,b as c,O as g,n as y,k as h,u as b,g as x,j as _}from"./index-5c06cf16.js";import{t as F}from"./tm-sheet.2873fe67.js";import{t as q}from"./tm-text.fdd4f0a8.js";import{_ as w}from"./tm-divider.vue_vue_type_script_setup_true_lang.0bd9a5e3.js";function C(e,l){return(e=e.map((e=>"function"==typeof e.validator&&!0===e.required?e:"boolean"==typeof e.validator&&!0===e.required?{...e,validator:e=>{if(null===e||""===e||void 0===e)return!1;if("object"==typeof e)if(Array.isArray(e)){if(0==e.length)return!1}else if(0===Object.keys(e).length&&e.constructor===Object)return!1;if("boolean"==typeof e)return e;if("number"==typeof e){if(isNaN(e))return!1;if(Number(e)<0)return!1}return"string"!=typeof e||0!=e.trim().length}}:{...e,validator:e=>!0}))).filter((e=>"function"==typeof e.validator&&!0===e.required)).map((e=>{let t=!0;if("function"==typeof e.validator){t=!!e.validator(l)}else t=!0;return{message:String(e.message),validator:t}}))}function $(e,l=""){if(""==l)return e;for(var t=l.split(".");t.length>1;){e=e[String(t.shift())]}return e[t[0]]}const A=e({__name:"tm-form",props:{modelValue:{type:Object,default:()=>({}),required:!0},margin:{type:Array,default:()=>[32,24]},padding:{type:Array,default:()=>[16,0]},layout:{type:String,default:"horizontal"},labelWidth:{type:Number,default:160},labelAlign:{type:String,default:"left"},border:{type:Boolean,default:!0},transprent:{type:Boolean,default:!1}},emits:["submit","validate","reset","clearValidate","update:modelValue"],setup(e,{expose:f,emit:p}){const v=e,c=l(v.modelValue),g=uni.$tm.u.deepClone(v.modelValue);t((()=>{c.value=v.modelValue}));const y=l([]);l(["tm-radio-group","tm-checkbox-box","tm-input","tm-rate","tm-slider","tm-segtab","tm-switch","tm-upload"]);const h=l(""),b=l([]);a("tmFormFun",r((()=>h.value))),a("tmFormLabelWidth",r((()=>v.labelWidth))),a("tmFormLabelAlign",r((()=>v.labelAlign))),a("tmFormLayout",r((()=>v.layout))),a("tmFormBorder",r((()=>v.border))),a("tmFormTransprent",r((()=>v.transprent))),a("formCallFiled",r((()=>c.value))),a("validateResultList",r((()=>b.value)));let x=NaN;function _(){var e,l;h.value="validate";let t=m(y.value),a=!0,r=[];for(let o=0,i=t.length;o<i;o++){let i=t[o],u=$(c.value,i.field);const n=C(i.rules,u);let d={message:"校验通过",validator:!0};for(let t=0;t<n.length;t++)if(!n[t].validator){a=!1,d.message=(null==(e=n[t])?void 0:e.message)??"校验通过",d.validator=(null==(l=n[t])?void 0:l.validator)??!0;break}r.push({field:i.field,...d})}return{result:r,isPass:a,data:m(c.value),validate:a}}return o((()=>v.modelValue),(()=>{clearTimeout(x),"validate"==h.value&&(x=setTimeout((function(){const e=_();b.value=[...e.result]}),100))}),{deep:!0}),f({reset:function(){h.value="reset";let e=uni.$tm.u.deepClone(g);p("update:modelValue",e),p("reset"),c.value=e},validate:_,clearValidate:function(){h.value="clearValidate",s((()=>{p("clearValidate")}))},submit:function(){h.value="validate",uni.$tm.u.throttle((()=>{const e=_();b.value=[...e.result],p("submit",{data:m(c.value),...e})}),220,!1)},pushKey:function(e){if(!e.field)return;let l=y.value.findIndex((l=>l.id==e.id));-1==l?y.value.push(e):y.value[l]={...e}},delKey:function(e){let l=y.value.findIndex((l=>l.id==e.id));l>-1&&y.value.splice(l,1)},tmFormComnameId:"tmFormId"}),(e,l)=>(i(),u(F,{transprent:v.transprent,round:3,_class:"flex flex-col overflow",padding:v.padding,margin:v.margin},{default:n((()=>[d(e.$slots,"default")])),_:3},8,["transprent","padding","margin"]))}}),V=e({__name:"tm-form-item",props:{parentClass:{type:String,default:""},align:{type:String,default:""},label:{type:String,default:""},desc:{type:String,default:""},margin:{type:Array,default:()=>[12,12]},padding:{type:Array,default:()=>[0,0]},field:{type:String,default:""},help:{type:String,default:""},required:{type:Boolean,default:!1},rules:{type:[Object,Array],default:()=>[{validator:!1,required:!1}]},border:{type:Boolean,default:null},showError:{type:Boolean,default:!0},showTopErrorGap:{type:Boolean,default:!0},requiredTitleChangeColor:{type:Boolean,default:!1},transprent:{type:[Boolean,String],default:null},round:{type:Number,default:0},errHeight:{type:Number,default:30},labelWidth:{type:Number,default:0}},setup(e,{expose:t}){var a;const s=e,m=(null==(a=x())?void 0:a.proxy)??null,C=l({label:"",field:s.field,value:null,isRequiredError:!1,message:"",id:uni.$tm.u.getUid(1),componentsName:"",rules:[]}),$=l(s.required),A=f("tmFormLabelWidth",r((()=>100))),V=f("tmFormLabelAlign",r((()=>"left"))),k=f("tmFormLayout",r((()=>"horizontal"))),z=f("tmFormBorder",r((()=>!0))),N=f("tmFormTransprent",r((()=>!1))),S=f("tmFormFun",r((()=>""))),j=f("validateResultList",r((()=>[]))),B=r((()=>null!==s.border&&"boolean"==typeof s.border?s.border:z.value)),E=r((()=>s.label));let I=null==m?void 0:m.$parent;for(;I&&"tmFormId"!=(null==I?void 0:I.tmFormComnameId)&&I;)I=(null==I?void 0:I.$parent)??void 0;p((()=>{R()}));const L=r((()=>{var e,l,t;let a=[];return Array.isArray(null==s?void 0:s.rules)?null==s||s.rules.forEach((e=>{let l=(null==e?void 0:e.required)||s.required;a.push({message:(null==e?void 0:e.message)??"请填写必要的内容",required:l,validator:(null==e?void 0:e.validator)??!1})})):a=[{message:(null==(e=null==s?void 0:s.rules)?void 0:e.message)??"请填写必要的内容",required:(null==(l=s.rules)?void 0:l.required)||s.required,validator:(null==(t=s.rules)?void 0:t.validator)??!1}],a}));function T(e){I&&(C.value={...C.value,...e??{},rules:L.value},I.pushKey({...C.value}))}function R(){I&&I.delKey(C.value)}return t({pushCom:T,delCom:R,tmFormComnameFormItem:"tmFormComnameFormItem"}),v((()=>{T()})),o((()=>j.value),(()=>{const e=j.value.filter((e=>e.field==s.field));e.length>0&&(C.value.message=e[0].message,C.value.isRequiredError=!e[0].validator)}),{deep:!0,immediate:!0}),(e,l)=>{const t=_;return i(),u(t,{class:g([`mx-${s.margin[0]}`])},{default:n((()=>[c(F,{transprent:null!==s.transprent?s.transprent:b(N),round:s.round,margin:[0,0],padding:s.padding},{default:n((()=>[c(t,{class:g([`py-${s.margin[1]}`])},{default:n((()=>[s.showError&&s.showTopErrorGap?(i(),u(t,{key:0,style:y({height:`${s.errHeight}rpx`})},null,8,["style"])):h("v-if",!0),c(t,{class:g(["flex","horizontal"==b(k)?"flex-row ":" ","horizontal"!=b(k)||s.align?"":"flex-row-center-start","vertical"!=b(k)||s.align?"":"flex-col",s.align,s.parentClass])},{default:n((()=>[b(E)?(i(),u(t,{key:0,style:y(["horizontal"==b(k)?{width:(s.labelWidth||b(A))+"rpx"}:""]),class:g(["flex flex-row",["right"==b(V)?"flex-row-center-end":"flex-row-center-start","horizontal"!=b(k)?"mb-24 flex-1 ":"mr-32 "]])},{default:n((()=>[c(t,{style:{width:"12px"},class:"flex flex-row flex-row-center-center"},{default:n((()=>[$.value?(i(),u(q,{key:0,color:"red","font-size":30,label:"*"})):h("v-if",!0)])),_:1}),c(t,{class:"flex flex-1",style:{width:"0px"}},{default:n((()=>[c(q,{color:"validate"==b(S)&&1==C.value.isRequiredError&&s.requiredTitleChangeColor?"red":"","font-size":30,label:b(E)},null,8,["color","label"])])),_:1})])),_:1},8,["style","class"])):h("v-if",!0),c(t,{class:"flex-1",style:y(["horizontal"==b(k)?{width:"0px"}:""])},{default:n((()=>[d(e.$slots,"default")])),_:3},8,["style"])])),_:3},8,["class"]),c(t,{class:g(s.desc?"pt-12":"")},{default:n((()=>[d(e.$slots,"desc",{},(()=>[c(q,{color:"grey-darken-2","font-size":22,label:s.desc},null,8,["label"])]))])),_:3},8,["class"]),s.showError?(i(),u(t,{key:1,style:y({height:`${s.errHeight}rpx`})},{default:n((()=>["validate"==b(S)&&1==C.value.isRequiredError?(i(),u(t,{key:0},{default:n((()=>[d(e.$slots,"error",{data:{message:C.value.message}},(()=>[c(q,{color:"red","font-size":22,label:C.value.message},null,8,["label"])]))])),_:3})):h("v-if",!0)])),_:3},8,["style"])):h("v-if",!0)])),_:3},8,["class"])])),_:3},8,["transprent","round","padding"]),b(B)?(i(),u(t,{key:0},{default:n((()=>[c(w,{border:2,padding:[0,0],margin:[0,0]})])),_:1})):h("v-if",!0)])),_:3},8,["class"])}}});export{A as _,V as a};
