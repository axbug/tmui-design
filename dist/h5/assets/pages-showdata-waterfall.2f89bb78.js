var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,n=(e,t)=>{for(var l in t||(t={}))i.call(t,l)&&r(e,l,t[l]);if(a)for(var l of a(t))o.call(t,l)&&r(e,l,t[l]);return e},u=(e,a)=>t(e,l(a)),s=(e,t,l)=>new Promise(((a,i)=>{var o=e=>{try{n(l.next(e))}catch(t){i(t)}},r=e=>{try{n(l.throw(e))}catch(t){i(t)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,r);n((l=l.apply(e,t)).next())}));import{d as p,c,r as m,at as d,o as g,a as f,w as h,b as v,M as x,n as _,u as b,j as w,K as y,i as j,g as O,O as N,m as P,k as W,I as C,P as k,e as H,f as I,F as q,h as T}from"./index-6b165856.js";import{t as z}from"./tm-app.d6cf2f93.js";import{t as L}from"./tm-text.6c910eb0.js";import{t as $}from"./tm-sheet.3639b36a.js";import{t as R}from"./tm-icon.65b53dc0.js";import{_ as U}from"./tm-image.vue_vue_type_script_setup_true_lang.b0e5c126.js";import"./tm-translate.1f1c80c0.js";const B=p({__name:"tm-waterfall",props:{width:{type:Number,default:750},gutter:{type:Number,default:12},bottomHeight:{type:Number,default:50},isLoadPlaceholder:{type:Boolean,default:!0},isLoadPlaceholderTransprent:{type:Boolean,default:!1}},setup(e,{expose:t}){const l=e,a=c((()=>l.width)),i=c((()=>(a.value-l.gutter)/2)),o=m([]),r=m([[],[]]),n=m([]),u=m([]),p=c((()=>{let e=y(l.gutter),t=r.value[0].map((e=>e.height)),a=0==t.length?0:t.reduce(((t,l)=>t+l+e)),i=r.value[1].map((e=>e.height)),o=0==i.length?0:i.reduce(((t,l)=>t+l+e));return{left:a,right:o,maxHeight:Math.max(o,a),minHeight:Math.min(o,a)}}));return d("tmWaterFallItemRealWidth",c((()=>y(i.value)))),t({parentNameId:"tmWaterfallId",pushKey:function(e){return s(this,null,(function*(){let t=o.value.findIndex((t=>t.id==e.id)),a=e;return t>-1?(o.value[t]=a,a):(o.value.push(a),function(e){var t,a;let o=p.value.left>p.value.right?1:0,u=null!=(a=null==(t=r.value[o][r.value[o].length-1])?void 0:t.bottom)?a:0;e.top=u+y(l.gutter),e.bottom=e.top+e.height,e.left=0==o?0:y(i.value)+y(l.gutter);let s=n.value.findIndex((t=>t.id==e.id));r.value[o].push(e),s>-1?n.value[s]=e:n.value.push(e);return e}(a))}))},sumTotal:function(e){u.value.push(e)},clear:function(){o.value=[],n.value=[],u.value=[],r.value=[[],[]]}}),(e,t)=>{const i=j;return g(),f(i,null,{default:h((()=>[v(i,{class:"flex flex-col flex-col-top-start flex-between relative overflow",style:_([{width:b(a)+"rpx",height:b(p).maxHeight+l.bottomHeight+"px"}])},{default:h((()=>[x(e.$slots,"default")])),_:3},8,["style"]),w(" 虚拟加载占位符。 "),u.value.length!=n.value.length&&l.isLoadPlaceholder?(g(),f($,{key:0,_class:"flex flex-center",margin:[0,0],padding:[0,0],transprent:l.isLoadPlaceholderTransprent},{default:h((()=>[v(R,{name:"tmicon-shuaxin",spin:""})])),_:1},8,["transprent"])):w("v-if",!0)])),_:3})}}}),E=p({__name:"tm-waterfall-item",props:{img:{type:String,default:""},color:{type:String,default:"white"},round:{type:Number,default:4}},emits:["img-click","click"],setup(e,{emit:t}){var l,a;const i=e,o=null!=(a=null==(l=O())?void 0:l.proxy)?a:null,r=m(!1),p=N("tmWaterFallItemRealWidth",c((()=>y(p.value))));let d=m({id:uni.$tm.u.getUid(2),width:p.value,height:p.value,imgWidth:p.value,imgHeight:p.value,bottom:0,index:NaN,top:0,left:0});const H=m(!i.img),I=function(){var e;let t=o.$parent;for(;t&&"tmWaterfallId"!=(null==t?void 0:t.parentNameId)&&t;)t=null!=(e=null==t?void 0:t.$parent)?e:void 0;return t}(),q=m(!1);function T(e){const{width:t,height:l}=e.detail;let a=p.value,i=a/(t/l);d.value=u(n({},d.value),{imgWidth:a,imgHeight:i}),setTimeout((()=>{W((()=>L()))}),50)}function z(){const e=p.value,t=p.value;p.value,console.log(t),d.value=u(n({},d.value),{imgWidth:e,imgHeight:e}),setTimeout((()=>{W((()=>L())),r.value=!0}),50)}function L(){W((function(){C().in(o).select(".itemWall").boundingClientRect((e=>{if(0===e.height&&0===e.width)L();else{H.value=!0;const{width:t,height:l}=e;d.value=u(n({},d.value),{height:l}),!1===q.value&&H.value&&(!function(){s(this,null,(function*(){if(I){let e=yield I.pushKey(k(d.value));d.value=e}}))}(),q.value=!0)}})).exec()}))}function B(e){t("img-click",d.value)}function E(e){t("click",d.value)}return I||console.error("请不要单独使用此组件，请放置在:tm-waterfall内；"),I.sumTotal(d.value.id),P((()=>{W((()=>{!0===H.value&&L()}))})),(e,t)=>{const l=j;return g(),f(l,{onClick:E,ref:"itemWall",class:"absolute itemWall",style:_([q.value?"":{transform:"translateX(-1000px)"},q.value?{transform:`translateX(${b(d).left}px) translateY(${b(d).top}px)`}:""])},{default:h((()=>[v($,{margin:[0,0],padding:[0,0],round:i.round,width:b(p),unit:"px",color:i.color,_class:"flex flex-col flex-col-top-start",eventPenetrationEnabled:!0},{default:h((()=>[!r.value&&i.img?(g(),f(U,{key:0,onClick:B,round:i.round,onLoad:T,onError:z,src:i.img,unit:"px",height:b(d).imgHeight,width:b(d).imgWidth},null,8,["round","src","height","width"])):w("v-if",!0),r.value?(g(),f(l,{key:1,class:"flex flex-row flex-row-center-center",userInteractionEnabled:!1,style:_([r.value?{height:b(d).imgWidth+"px",width:b(d).imgWidth+"px"}:""])},{default:h((()=>[v(R,{name:"tmicon-exclamation-circle"})])),_:1},8,["style"])):w("v-if",!0),v(l,{class:"flex flex-col flex-1 flex-col-top-start"},{default:h((()=>[x(e.$slots,"default")])),_:3})])),_:3},8,["round","width","color"])])),_:3},8,["style"])}}}),F=p({__name:"waterfall",setup(e){const t=m(null),l=m([{img:"https://gw.alicdn.com/bao/uploaded/i2/1848622920/O1CN018zBHJ91XRPJ4bHW78_!!0-item_pic.jpg_320x320q90.jpg",text:"杨大爷麻辣香肠腊肠500克四川特产烟熏肉农家自制川味烤腊肉辣肠",price:"49",num:"3000+"},{img:"https://gw.alicdn.com/imgextra/i4/2207613550143/O1CN01hPpOvy1CvXQdlZLeC_!!2207613550143-0-alimamacc.jpg_q90.jpg",text:"",price:"200",num:"3000+"},{img:"https://gw.alicdn.com/bao/uploaded/i4/14498052/O1CN01pa6ScB29LrgfkRp8V_!!14498052.jpg_320x320q90.jpg",text:"带盖 酸奶杯一次性塑料布丁杯胖胖pp果冻杯慕斯甜品杯双皮奶100套",price:"12.8",num:"1500+"},{img:"https://images.pexels.com/photos/12640459/pexels-photo-12640459.jpeg?auto=compress&cs=tinysrgb&w=1600&lazy=load",text:"带盖 酸奶杯一次性塑料布丁杯胖胖pp果冻杯慕斯甜品杯双皮奶100套",price:"12.8",num:"1500+"},{img:"https://gw.alicdn.com/bao/uploaded/i4/1026973813/O1CN014Kirba1e2OrHg7gwN_!!1026973813.jpg_320x320q90.jpg",text:"带盖 酸奶杯一次性塑料布丁杯胖胖pp果冻杯慕斯甜品杯双皮奶100套",price:"12.8",num:"1500+"},{img:"https://gw.alicdn.com/imgextra/i3/23844911/O1CN01N1UxMS1m9Hs6gGu6E_!!23844911-0-alimamacc.jpg",text:"",price:"200",num:"3000+"},{img:"https://gw.alicdn.com/bao/uploaded/i4/2418392409/O1CN01zT4JbA1TfMoU30Uub_!!2418392409.jpg_320x320q90.jpg",text:"50枚挂耳咖啡滤袋日本材质手冲咖啡滤纸咖啡粉滤袋挂耳咖啡袋包邮",price:"12.8",num:"1500+"},{img:"https://gw.alicdn.com/bao/uploaded/i2/6000000001207/O1CN016TztFg1Kmqqrtarb0_!!6000000001207-0-picassoopen.jpg_320x320q90.jpg",text:"带盖 酸奶杯一次性塑料布丁杯胖胖pp果冻杯慕斯甜品杯双皮奶100套",price:"12.8",num:"1500+"},{img:"https://gw.alicdn.com/bao/uploaded/i3/2200531292142/O1CN01gFUdOw1Rh4vjN44sB_!!0-item_pic.jpg_320x320q90.jpg",text:"带盖 酸奶杯一次性塑料布丁杯胖胖pp果冻杯慕斯甜品杯双皮奶100套",price:"12.8",num:"1500+"}]);function a(){T({url:"tree"})}return(e,i)=>{const o=j;return g(),f(z,null,{default:h((()=>[v(o,{class:"flex flex-col flex-col-top-center"},{default:h((()=>[v(B,{ref_key:"wall",ref:t,width:718},{default:h((()=>[(g(!0),H(q,null,I(l.value,((e,t)=>(g(),f(E,{onClick:a,img:e.img},{default:h((()=>[v(o,{class:"pt-12 pb-12 px-12"},{default:h((()=>[v(L,{label:e.text,_class:"text-overflow-2"},null,8,["label"]),v(o,{class:"flex flex-row flex-row-bottom-start mt-24"},{default:h((()=>[w(' <tm-text color="orange" :font-size="24" label=\'¥\'></tm-text> '),v(L,{color:"orange",_class:"px-10","font-size":36,label:e.price},null,8,["label"]),v(L,{color:"grey","font-size":24,label:e.num},null,8,["label"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["img"])))),256))])),_:1},512)])),_:1})])),_:1})}}});export{F as default};
