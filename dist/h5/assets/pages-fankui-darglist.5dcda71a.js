import{d as e,r as t,R as l,o as a,a as o,w as s,b as n,e as u,f as i,F as r,n as f,O as p,m as c,L as d,j as v,k as h,V as g,Q as m,_ as x}from"./index-5c06cf16.js";import{t as y}from"./tm-app.20954b06.js";import{t as _}from"./tm-sheet.2873fe67.js";import{t as b}from"./tm-text.fdd4f0a8.js";import{t as w}from"./tm-icon.5716c798.js";const T=x(e({__name:"tm-drag-list",props:{disabled:{type:[String,Boolean],default:!1},width:{type:Number,default:700},height:{type:Number,default:90},list:{type:Array,default:()=>[]},rangKey:{type:String,default:"text"},rightIcon:{type:String,default:"icon-menu"},bgColor:{type:String,default:"white"}},emits:["change"],setup(e,{emit:x}){const y=e,T=t(0),N=t(0),M=t(0);let j=0;const L=t(NaN),k=t(NaN),I=t([]),S=t(!1),z=t(!1);function P(e,t){if(e.preventDefault(),e.stopPropagation(),!y.disabled)if(S.value=!1,k.value=t,I.value,-1==e.type.indexOf("mouse")&&1==e.changedTouches.length){var l=e.changedTouches[0];j=l.pageY-e.currentTarget.offsetTop-I.value[t].top}else j=e.pageY-e.currentTarget.offsetTop-I.value[t].top}function Y(e,t){if(y.disabled)return;if(e.preventDefault(),e.stopPropagation(),isNaN(k.value))return;let l=0;-1==e.type.indexOf("mouse")&&1==e.changedTouches.length?l=e.changedTouches[0].pageY-j:l=e.pageY-j;I.value.splice(t,1,{...I.value[t],top:l});const a=t,o=I.value[a].i,s=I.value[a].__id;let n=Math.round(l/N.value);n=n<0?0:n,n=n>I.value.length-1?I.value.length-1:n,n=Math.abs(n),t=n;let u=[...I.value];for(let i=0;i<u.length;i++)o<n?u[i].i>o&&u[i].i<=n&&(u[i].i-=1):o>n&&u[i].i<o&&u[i].i>=n&&(u[i].i+=1);u[a].i=n,u=u.map((e=>(e.__id!=s&&(e.top=e.i*N.value),e))),I.value=u,L.value=n}function D(e,t){if(y.disabled)return;if(e.preventDefault(),e.stopPropagation(),k.value=NaN,S.value=!0,isNaN(L.value))return;let l=[...I.value];l=l.map((e=>(e.top=e.i*N.value,e))),l.sort(((e,t)=>e.i-t.i)),I.value=[...l],function(){if(y.disabled)return;x("change",m(I.value))}()}return l((()=>y.list),(()=>{!function(){let e=uni.$tm.u.deepClone(y.list);c((function(){I.value=[],T.value=d(y.width)||700,N.value=d(y.height)||120,M.value=N.value*e.length;for(let t=0;t<e.length;t++){let l=e[t];l.top=t*N.value,l.i=t,l.__id=uni.$tm.u.getUid()}I.value=[...e]}))}(),console.log(8)}),{deep:!0,immediate:!0}),(t,l)=>{const c=v;return a(),o(c,{ref:"tm-dragList",class:"tm-dragList flex flex-col flex-col-center-center"},{default:s((()=>[n(c,{style:f({height:N.value*e.list.length+"px",width:T.value+"px"}),class:p(["relative flex flex-col",[e.disabled?"opacity-4":""]])},{default:s((()=>[(a(!0),u(r,null,i(I.value,((e,t)=>(a(),o(c,{class:p(["overflow flex flex-col",["absolute","tm-dragList-item","flex-between"]]),key:t,style:f([{top:`${e.top}px`,height:N.value+"px",width:T.value+"px",zIndex:k.value==t?5:0},z.value?{"transition-delay":"0.1s"}:{"transition-duration":k.value==t||S.value?"0s":"0.25s"}])},{default:s((()=>[n(_,{"hover-class":"opacity-6",border:1,"border-direction":"bottom",color:k.value==t?"grey-3":"white",_class:"flex-1 flex flex-row flex-between",class:"flex-1",margin:[0,0],padding:[0,0]},{default:s((()=>[n(c,{class:"flex flex-row flex-row-center-start pl-12",style:f({height:N.value-1+"px"})},{default:s((()=>[e.icon?(a(),o(c,{key:0,class:"flex-shrink fulled-height flex-center"},{default:s((()=>[n(w,{color:e.color,name:e.icon,fontSize:40},null,8,["color","name"])])),_:2},1024)):h("v-if",!0),n(b,{_class:" pl-24","font-size":30,label:e.text},null,8,["label"])])),_:2},1032,["style"]),n(c,{style:f({height:N.value-1+"px",width:"100rpx"}),onTouchstart:g((e=>P(e,t)),["stop","prevent"]),onLongpress:e=>function(e){S.value=!1,k.value=e}(t),onMousedown:e=>P(e,t),onTouchmove:g((e=>Y(e,t)),["stop","prevent"]),onMousemove:g((e=>Y(e,t)),["stop","prevent"]),onTouchend:e=>D(e),onMouseup:e=>D(e),class:"flex-shrink flex flex-row flex-row-center-center opacity-3"},{default:s((()=>[n(w,{userInteractionEnabled:!1,name:"tmicon-menu"})])),_:2},1032,["style","onTouchstart","onLongpress","onMousedown","onTouchmove","onMousemove","onTouchend","onMouseup"])])),_:2},1032,["color"])])),_:2},1032,["style"])))),128))])),_:1},8,["style","class"])])),_:1},512)}}}),[["__scopeId","data-v-00179796"]]),N=e({__name:"darglist",setup(e){t(!1),t("bottom");const l=t([{text:"测试项目1-1"},{text:"测试项目2-1"},{text:"测试项目3-1"},{text:"测试项目4-1"},{text:"测试项目5-1"}]);return(e,t)=>(a(),o(y,null,{default:s((()=>[n(_,null,{default:s((()=>[n(b,{"font-size":24,_class:"font-weight-b",label:"长按图标开始拖动"})])),_:1}),n(T,{list:l.value},null,8,["list"])])),_:1}))}});export{N as default};
