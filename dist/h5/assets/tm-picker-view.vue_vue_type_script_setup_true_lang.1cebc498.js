import{d as e,g as a,c as t,r as l,L as n,p as u,az as d,R as r,m as i,o,a as s,w as m,n as g,u as p,b as c,e as f,F as y,f as h,O as v,k as b,j as x,aG as k,aH as K,_,Q as C,v as S,x as w}from"./index-5c06cf16.js";import{u as V}from"./tm-app.20954b06.js";import{t as A}from"./tm-text.fdd4f0a8.js";const j=_(e({__name:"picker-panel",props:{followTheme:{type:[Boolean],default:!0},col:{type:Number,default:0},disabled:{type:Boolean,default:!1},height:{type:Number,default:600},data:{type:Array,default:()=>[],required:!0},dataKey:{type:String,default:"text"},mapKey:{type:String,default:"text"},immediateChange:{type:Boolean,default:!0}},emits:["change","end","start"],setup(e,{emit:_}){var C;const S=e;null==(C=a())||C.proxy;const w=V(),j=t((()=>w.tmStore.dark)),B=t((()=>S.data)),T=l(0),z=l(!1);t((()=>(n(S.height)-34)/2)),l(0);const I=t((()=>j.value?"background-image:linear-gradient(rgba(17, 17, 17, 1.0),rgba(106, 106, 106, 0.2)),linear-gradient(rgba(106, 106, 106, 0.2),rgba(17, 17, 17, 1.0))":"background-image:linear-gradient(rgba(255,255,255,0.95),rgba(255,255,255,0.6)),linear-gradient(rgba(255,255,255,0.6),rgba(255,255,255,0.95))"));function N(e){T.value=e.detail.value[0],_("change",T.value)}function q(){i((function(){}))}return t((()=>j?"background:linear-gradient(0deg,rgba(0,0,0,0.4),rgba(0,0,0,0),rgba(0,0,0,0.4))":"background:linear-gradient(rgba(255,255,255,0.95),rgba(255,255,255,0.6))")),u((()=>{z.value=!0,q(),setTimeout((function(){T.value=S.col}),50)})),d((()=>q())),r((()=>S.col),(()=>{i((()=>{T.value=S.col}))})),(e,a)=>{const t=x,l=k,n=K;return o(),s(t,{class:"flex-1 relative",style:g({height:S.height+"rpx"})},{default:m((()=>[z.value?(o(),s(n,{key:0,onPickend:a[0]||(a[0]=e=>_("end")),onPickstart:a[1]||(a[1]=e=>_("start")),value:[T.value],onChange:N,style:g([{height:S.height+"rpx"}]),"mask-style":p(I),immediateChange:S.immediateChange,"indicator-style":"height:50px;background-image: linear-gradient(to bottom,rgba(0, 0, 0, 0.04),rgba(0, 0, 0, 0.01),rgba(0,0,0, 0.04));"},{default:m((()=>[c(l,null,{default:m((()=>[(o(!0),f(y,null,h(p(B),((e,a)=>(o(),s(t,{key:a,class:v(["flex itemcel",[a==T.value?"":"UnitemSelected",e.disabled?"opacity-5":""]])},{default:m((()=>["string"==typeof e?(o(),s(A,{key:0,_class:"text-align-center","font-size":e.length>7?24:30,dark:p(j),label:e},null,8,["font-size","dark","label"])):b("v-if",!0),"object"==typeof e?(o(),s(A,{key:1,_class:"text-align-center","font-size":e[S.mapKey||S.dataKey].length>7?24:30,dark:p(j),label:e[S.mapKey||S.dataKey]||""},null,8,["font-size","dark","label"])):b("v-if",!0)])),_:2},1032,["class"])))),128))])),_:1})])),_:1},8,["value","style","mask-style","immediateChange"])):b("v-if",!0)])),_:1},8,["style"])}}}),[["__scopeId","data-v-c5ea9dbd"]]),B=e({__name:"tm-picker-view",props:{followTheme:{type:[Boolean],default:!0},height:{type:Number,default:450},modelValue:{type:Array,default:()=>[]},modelStr:{type:[String],default:""},defaultValue:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[],required:!0},dataKey:{type:String,default:"text"},mapKey:{type:String,default:"text"},beforeChange:{type:[Boolean,Function],default:()=>!1},immediateChange:{type:Boolean,default:!1}},emits:["change","update:modelValue","update:modelStr","end","start"],setup(e,{emit:a}){const n=e,u=l([...n.defaultValue]),d=l([]),g=t((()=>{let e=[];return d.value.forEach(((a,t)=>{let l=a[u.value[t]];void 0!==l&&e.push(l[n.mapKey||n.dataKey]??"")})),e.join("/")}));function p(e=0,a){var t;let l=[];if(0==a.length)return[];void 0===u.value[e]&&u.value.push(0);let n=a[u.value[e]];if(n||(u.value[e]=0,n=a[u.value[e]]),n&&(null==n?void 0:n.children)&&Array.isArray(null==n?void 0:n.children)&&(null==(t=null==n?void 0:n.children)?void 0:t.length)>0){l.push(a);let t=p(e+1,null==n?void 0:n.children);l=[...l,...t]}else(null==a?void 0:a.length)>0&&Array.isArray(a)&&a&&l.push(a);return l}return r((()=>u.value),(()=>{i((()=>{a("update:modelStr",g.value)}))}),{deep:!0}),d.value=p(0,n.columns),r((()=>n.columns),(()=>{d.value=p(0,n.columns)}),{deep:!0}),r((()=>n.modelValue),(()=>{u.value=n.modelValue,d.value=p(0,n.columns)}),{deep:!0}),i((()=>{a("update:modelValue",C(u.value)),a("update:modelStr",g.value||n.modelStr)})),(e,t)=>{const l=x;return o(),s(l,{class:"flex flex-row"},{default:m((()=>[(o(!0),f(y,null,h(d.value,((e,l)=>(o(),s(j,{immediateChange:n.immediateChange,followTheme:n.followTheme,onEnd:t[0]||(t[0]=e=>a("end")),onStart:t[1]||(t[1]=e=>a("start")),dataKey:n.mapKey||n.dataKey,mapKey:n.mapKey||n.dataKey,onChange:e=>async function(e,t){let l=!0,r=d.value[t][e];const o={from:{itemindex:u.value[t],levelIndex:t,data:d.value[t][u.value[t]]},to:{itemindex:e,levelIndex:t,data:r}};if(u.value.splice(t,1,e),"function"==typeof n.beforeChange){S({title:"...",mask:!0});let e=await n.beforeChange(o);"function"==typeof e&&(e=await e(o)),e||(l=!1,i((()=>{u.value.splice(t,1,o.from.itemindex)})),w())}1==(null==r?void 0:r.disabled)&&(l=!1,i((()=>{u.value.splice(t,1,o.from.itemindex)}))),l&&(d.value=p(0,n.columns),a("change",t,e),a("update:modelValue",C(u.value)))}(e,l),col:u.value[l],data:e,key:l,height:n.height,class:"flex-1"},null,8,["immediateChange","followTheme","dataKey","mapKey","onChange","col","data","height"])))),128))])),_:1})}}});export{B as _};
