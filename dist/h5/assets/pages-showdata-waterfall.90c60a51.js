import{d as e,c as t,r as l,at as a,o as i,a as o,w as u,b as n,N as r,n as s,u as m,k as p,L as c,j as d,g,P as f,p as h,m as v,J as x,Q as _,e as w,f as b,F as y,h as j}from"./index-5c06cf16.js";import{t as N}from"./tm-app.20954b06.js";import{t as W}from"./tm-text.fdd4f0a8.js";import{t as C}from"./tm-sheet.2873fe67.js";import{t as k}from"./tm-icon.5716c798.js";import{_ as H}from"./tm-image.vue_vue_type_script_setup_true_lang.f325e7c1.js";import"./tm-translate.4fbb7927.js";const O=e({__name:"tm-waterfall",props:{width:{type:Number,default:750},gutter:{type:Number,default:12},bottomHeight:{type:Number,default:50},isLoadPlaceholder:{type:Boolean,default:!0},isLoadPlaceholderTransprent:{type:Boolean,default:!1}},setup(e,{expose:g}){const f=e,h=t((()=>f.width)),v=t((()=>(h.value-f.gutter)/2)),x=l([]),_=l([[],[]]),w=l([]),b=l([]),y=t((()=>{let e=c(f.gutter),t=_.value[0].map((e=>e.height)),l=0==t.length?0:t.reduce(((t,l)=>t+l+e)),a=_.value[1].map((e=>e.height)),i=0==a.length?0:a.reduce(((t,l)=>t+l+e));return{left:l,right:i,maxHeight:Math.max(i,l),minHeight:Math.min(i,l)}}));return a("tmWaterFallItemRealWidth",t((()=>c(v.value)))),g({parentNameId:"tmWaterfallId",pushKey:async function(e){let t=x.value.findIndex((t=>t.id==e.id)),l=e;return t>-1?(x.value[t]=l,l):(x.value.push(l),function(e){var t;let l=y.value.left>y.value.right?1:0,a=(null==(t=_.value[l][_.value[l].length-1])?void 0:t.bottom)??0;e.top=a+c(f.gutter),e.bottom=e.top+e.height,e.left=0==l?0:c(v.value)+c(f.gutter);let i=w.value.findIndex((t=>t.id==e.id));_.value[l].push(e),i>-1?w.value[i]=e:w.value.push(e);return e}(l))},sumTotal:function(e){b.value.push(e)},clear:function(){x.value=[],w.value=[],b.value=[],_.value=[[],[]]}}),(e,t)=>{const l=d;return i(),o(l,null,{default:u((()=>[n(l,{class:"flex flex-col flex-col-top-start flex-between relative overflow",style:s([{width:m(h)+"rpx",height:m(y).maxHeight+f.bottomHeight+"px"}])},{default:u((()=>[r(e.$slots,"default")])),_:3},8,["style"]),p(" 虚拟加载占位符。 "),b.value.length!=w.value.length&&f.isLoadPlaceholder?(i(),o(C,{key:0,_class:"flex flex-center",margin:[0,0],padding:[0,0],transprent:f.isLoadPlaceholderTransprent},{default:u((()=>[n(k,{name:"tmicon-shuaxin",spin:""})])),_:1},8,["transprent"])):p("v-if",!0)])),_:3})}}}),I=e({__name:"tm-waterfall-item",props:{img:{type:String,default:""},color:{type:String,default:"white"},round:{type:Number,default:4}},emits:["img-click","click"],setup(e,{emit:a}){var w;const b=e,y=(null==(w=g())?void 0:w.proxy)??null,j=l(!1),N=f("tmWaterFallItemRealWidth",t((()=>c(N.value))));let W=l({id:uni.$tm.u.getUid(2),width:N.value,height:N.value,imgWidth:N.value,imgHeight:N.value,bottom:0,index:NaN,top:0,left:0});const O=l(!b.img),I=function(){let e=y.$parent;for(;e&&"tmWaterfallId"!=(null==e?void 0:e.parentNameId)&&e;)e=(null==e?void 0:e.$parent)??void 0;return e}(),q=l(!1);function P(e){const{width:t,height:l}=e.detail;let a=N.value,i=a/(t/l);W.value={...W.value,imgWidth:a,imgHeight:i},setTimeout((()=>{v((()=>L()))}),50)}function T(){const e=N.value,t=N.value;N.value,console.log(t),W.value={...W.value,imgWidth:e,imgHeight:e},setTimeout((()=>{v((()=>L())),j.value=!0}),50)}function L(){v((function(){x().in(y).select(".itemWall").boundingClientRect((e=>{if(0===e.height&&0===e.width)L();else{O.value=!0;const{width:t,height:l}=e;W.value={...W.value,height:l},!1===q.value&&O.value&&(!async function(){if(I){let e=await I.pushKey(_(W.value));W.value=e}}(),q.value=!0)}})).exec()}))}function z(e){a("img-click",W.value)}function $(e){a("click",W.value)}return I||console.error("请不要单独使用此组件，请放置在:tm-waterfall内；"),I.sumTotal(W.value.id),h((()=>{v((()=>{!0===O.value&&L()}))})),(e,t)=>{const l=d;return i(),o(l,{onClick:$,ref:"itemWall",class:"absolute itemWall",style:s([q.value?"":{transform:"translateX(-1000px)"},q.value?{transform:`translateX(${m(W).left}px) translateY(${m(W).top}px)`}:""])},{default:u((()=>[n(C,{margin:[0,0],padding:[0,0],round:b.round,width:m(N),unit:"px",color:b.color,_class:"flex flex-col flex-col-top-start",eventPenetrationEnabled:!0},{default:u((()=>[!j.value&&b.img?(i(),o(H,{key:0,onClick:z,round:b.round,onLoad:P,onError:T,src:b.img,unit:"px",height:m(W).imgHeight,width:m(W).imgWidth},null,8,["round","src","height","width"])):p("v-if",!0),j.value?(i(),o(l,{key:1,class:"flex flex-row flex-row-center-center",userInteractionEnabled:!1,style:s([j.value?{height:m(W).imgWidth+"px",width:m(W).imgWidth+"px"}:""])},{default:u((()=>[n(k,{name:"tmicon-exclamation-circle"})])),_:1},8,["style"])):p("v-if",!0),n(l,{class:"flex flex-col flex-1 flex-col-top-start"},{default:u((()=>[r(e.$slots,"default")])),_:3})])),_:3},8,["round","width","color"])])),_:3},8,["style"])}}}),q=e({__name:"waterfall",setup(e){const t=l(null),a=l([{img:"https://gw.alicdn.com/bao/uploaded/i2/1848622920/O1CN018zBHJ91XRPJ4bHW78_!!0-item_pic.jpg_320x320q90.jpg",text:"杨大爷麻辣香肠腊肠500克四川特产烟熏肉农家自制川味烤腊肉辣肠",price:"49",num:"3000+"},{img:"https://gw.alicdn.com/imgextra/i4/2207613550143/O1CN01hPpOvy1CvXQdlZLeC_!!2207613550143-0-alimamacc.jpg_q90.jpg",text:"",price:"200",num:"3000+"},{img:"https://gw.alicdn.com/bao/uploaded/i4/14498052/O1CN01pa6ScB29LrgfkRp8V_!!14498052.jpg_320x320q90.jpg",text:"带盖 酸奶杯一次性塑料布丁杯胖胖pp果冻杯慕斯甜品杯双皮奶100套",price:"12.8",num:"1500+"},{img:"https://images.pexels.com/photos/12640459/pexels-photo-12640459.jpeg?auto=compress&cs=tinysrgb&w=1600&lazy=load",text:"带盖 酸奶杯一次性塑料布丁杯胖胖pp果冻杯慕斯甜品杯双皮奶100套",price:"12.8",num:"1500+"},{img:"https://gw.alicdn.com/bao/uploaded/i4/1026973813/O1CN014Kirba1e2OrHg7gwN_!!1026973813.jpg_320x320q90.jpg",text:"带盖 酸奶杯一次性塑料布丁杯胖胖pp果冻杯慕斯甜品杯双皮奶100套",price:"12.8",num:"1500+"},{img:"https://gw.alicdn.com/imgextra/i3/23844911/O1CN01N1UxMS1m9Hs6gGu6E_!!23844911-0-alimamacc.jpg",text:"",price:"200",num:"3000+"},{img:"https://gw.alicdn.com/bao/uploaded/i4/2418392409/O1CN01zT4JbA1TfMoU30Uub_!!2418392409.jpg_320x320q90.jpg",text:"50枚挂耳咖啡滤袋日本材质手冲咖啡滤纸咖啡粉滤袋挂耳咖啡袋包邮",price:"12.8",num:"1500+"},{img:"https://gw.alicdn.com/bao/uploaded/i2/6000000001207/O1CN016TztFg1Kmqqrtarb0_!!6000000001207-0-picassoopen.jpg_320x320q90.jpg",text:"带盖 酸奶杯一次性塑料布丁杯胖胖pp果冻杯慕斯甜品杯双皮奶100套",price:"12.8",num:"1500+"},{img:"https://gw.alicdn.com/bao/uploaded/i3/2200531292142/O1CN01gFUdOw1Rh4vjN44sB_!!0-item_pic.jpg_320x320q90.jpg",text:"带盖 酸奶杯一次性塑料布丁杯胖胖pp果冻杯慕斯甜品杯双皮奶100套",price:"12.8",num:"1500+"}]);function r(){j({url:"tree"})}return(e,l)=>{const s=d;return i(),o(N,null,{default:u((()=>[n(s,{class:"flex flex-col flex-col-top-center"},{default:u((()=>[n(O,{ref_key:"wall",ref:t,width:718},{default:u((()=>[(i(!0),w(y,null,b(a.value,((e,t)=>(i(),o(I,{onClick:r,img:e.img},{default:u((()=>[n(s,{class:"pt-12 pb-12 px-12"},{default:u((()=>[n(W,{label:e.text,_class:"text-overflow-2"},null,8,["label"]),n(s,{class:"flex flex-row flex-row-bottom-start mt-24"},{default:u((()=>[p(' <tm-text color="orange" :font-size="24" label=\'¥\'></tm-text> '),n(W,{color:"orange",_class:"px-10","font-size":36,label:e.price},null,8,["label"]),n(W,{color:"grey","font-size":24,label:e.num},null,8,["label"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["img"])))),256))])),_:1},512)])),_:1})])),_:1})}}});export{q as default};
