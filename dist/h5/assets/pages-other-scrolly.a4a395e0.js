import{d as e,r as l,c as a,R as t,p as o,m as u,o as s,a as r,w as n,b as i,O as c,n as m,N as f,u as v,k as p,g as d,j as y,$ as h,_ as g,e as _,f as x,F as b,v as V,x as T,U as B,a0 as w,X as k}from"./index-5c06cf16.js";import{t as H}from"./tm-app.20954b06.js";import{t as j}from"./tm-icon.5716c798.js";import{t as $}from"./tm-text.fdd4f0a8.js";import{_ as N}from"./tm-divider.vue_vue_type_script_setup_true_lang.0bd9a5e3.js";import{t as Y}from"./tm-sheet.2873fe67.js";const z=g(e({__name:"tm-scrolly",props:{...{width:{type:Number,default:0},height:{type:Number,default:600},loadingTexts:{type:Array,default:()=>["下拉刷新","松手刷新","正在刷新","刷新完成"]},maxBarHeight:{type:Number,default:120},refreshTimeout:{type:Number,default:5e3},modelValue:{type:[Boolean],default:null},defaultValue:{type:Boolean,default:!1},loadBarHeight:{type:Number,default:120},bottomValue:{type:[Boolean],default:null}}},emits:["bottom","change","refresh","timeout","update:modelValue","update:bottomValue"],setup(e,{emit:g}){var _;const x=e;null==(_=d())||_.proxy;const b=l(null),V=l(!1),T=l(x.maxBarHeight),B=l(0);let w=0,k=0;const H=l(-1),N=l(!1),Y=l(!0),z=l(0),O=a((()=>x.loadingTexts)),S=l(x.bottomValue);function R(){S.value||(g("update:bottomValue"),g("bottom"))}function U(){Y.value=!0}function X(e){var l;Y.value=0===(null==(l=e.detail)?void 0:l.scrollTop)}function I(e){if(V.value||!Y.value)return;const{touches:l}=e;if(1!==l.length)return;const{pageX:a,pageY:t}=l[0];N.value=!1,b.value={pageX:a,pageY:t},V.value=!0}function P(e){if(!b.value)return;const{touches:l}=e;if(1!==l.length)return;const{pageY:a}=l[0],t=a-b.value.pageY,o=uni.$tm.u.torpx(t);o>0&&(o>T.value?F(T.value):F(o))}function A(e){if(!b.value)return;const{changedTouches:l}=e;if(1!==l.length)return;const{pageY:a}=l[0],t=uni.$tm.u.torpx(a-b.value.pageY);b.value=null,N.value=!0,S.value=!1,t>x.loadBarHeight?(B.value=x.loadBarHeight,H.value=2,g("change",!0),g("update:modelValue",!0),g("refresh"),w=setTimeout((()=>{w=null,2===H.value&&(g("timeout"),J())}),x.refreshTimeout)):J()}function F(e){return e>=x.loadBarHeight?H.value=1:H.value=0,new Promise((l=>{B.value=e,u((()=>{l(e)}))}))}function J(){B.value=0,g("change",!1),g("update:modelValue",!1),k=setTimeout((()=>{k=null,H.value=-1,V.value=!1,N.value=!1,Y.value=!0}),350)}return t((()=>x.modelValue),(()=>{x.modelValue||(null!=w&&clearTimeout(w),H.value=3,J())})),t((()=>x.bottomValue),(()=>{S.value=x.bottomValue})),o((()=>{clearTimeout(w),clearTimeout(k),u((()=>{x.defaultValue&&(F(x.loadBarHeight),H.value=2,N.value=!0,V.value=!0,Y.value=!1,b.value=null)}))})),(e,l)=>{const a=y,t=h;return s(),r(t,{class:"scroyy","scroll-top":z.value,onTouchstart:I,onTouchmove:P,onTouchend:A,onScroll:X,onScrolltoupper:U,onScrolltolower:R,"scroll-y":"","enable-back-to-top":"",enhanced:"","scroll-with-animation":"",bounces:!1,style:m({height:x.height+"rpx"})},{default:n((()=>[i(a,{class:c(["scroyy__track","scroyy__track--"+(N.value?"loosing":"")]),style:m({transform:`translate3d(0, ${B.value}rpx, 0)`})},{default:n((()=>[i(a,{class:c(["scroyy__tips",["scroyy__track--"+(N.value?"loosing":"")]]),style:m({height:B.value+"rpx"})},{default:n((()=>[f(e.$slots,"pull",{status:{refreshStatus:H.value}},(()=>[2===H.value?(s(),r(a,{key:0,class:"flex flex-row flex-row-center-center"},{default:n((()=>[i(j,{"font-size":24,color:"primary",name:"tmicon-shuaxin",spin:""}),i($,{color:"grey",_class:"pl-16",label:v(O)[H.value]},null,8,["label"])])),_:1})):p("v-if",!0),-1!=H.value&&2!=H.value?(s(),r(a,{key:1,class:"flex flex-row flex-row-center-center srrryration",style:m({opacity:""+(0==H.value?B.value/x.loadBarHeight:1)})},{default:n((()=>[i(a,{class:c(0==H.value?"srrryration srrryrationOn":"srrryration srrryrationOf")},{default:n((()=>[i(j,{"font-size":24,color:"primary",name:"tmicon-long-arrow-down"})])),_:1},8,["class"]),i($,{color:"grey",_class:"pl-16",label:v(O)[H.value]},null,8,["label"])])),_:1},8,["style"])):p("v-if",!0)]),!0)])),_:3},8,["class","style"]),f(e.$slots,"default",{},void 0,!0),i(a,{class:c(["scroyy__track--loosing flex "]),style:m({height:(S.value?x.loadBarHeight:0)+"rpx"})},{default:n((()=>[f(e.$slots,"bottom",{status:{isBootRefresh:S.value}},(()=>[S.value?(s(),r(a,{key:0,class:"flex flex-row flex-row-center-center",style:m({height:(S.value?x.loadBarHeight:0)+"rpx"})},{default:n((()=>[i(j,{"font-size":24,color:"primary",name:"tmicon-shuaxin",spin:""}),i($,{color:"grey",_class:"pl-16",label:"数据加载中"})])),_:1},8,["style"])):p("v-if",!0)]),!0)])),_:3},8,["style"])])),_:3},8,["class","style"])])),_:3},8,["scroll-top","style"])}}}),[["__scopeId","data-v-8f47e96a"]]),O=e({__name:"scrolly",setup(e){const a=l(!1),t=l(!1);function o(){setTimeout((function(){a.value=!1}),1500)}function u(){t.value=!0,V({title:"...",mask:!0}),setTimeout((function(){t.value=!1,T()}),1500)}return(e,l)=>{const c=k,m=y;return s(),r(H,null,{default:n((()=>[i(Y,null,{default:n((()=>[i($,{"font-size":32,label:"纵向滚动,也可称之为下拉,触底刷新组件"}),i(N),i($,{label:"不支持在pc端使用.请在移动端查看效果,在nvue端使用的是原生高性能下拉组件,非nvue端使用自定下拉组件."}),i(z,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value=e),"bottom-value":t.value,"onUpdate:bottomValue":l[1]||(l[1]=e=>t.value=e),onRefresh:o,onBottom:u},{default:n((()=>[i($,{label:"触摸区域,体验下拉刷新操作."}),(s(),_(b,null,x(50,((e,l)=>i(m,{key:l,style:{height:"40px"},class:"px-36"},{default:n((()=>[i(c,null,{default:n((()=>[B(w(e),1)])),_:2},1024)])),_:2},1024))),64))])),_:1},8,["modelValue","bottom-value"])])),_:1})])),_:1})}}});export{O as default};
