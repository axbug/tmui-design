import{d as e,r as t,p as n,R as i,L as l,o,a,w as u,k as s,b as c,e as r,f as d,F as h,n as m,g as p,j as f,ab as x,O as _,ac as g,_ as v}from"./index-5c06cf16.js";import{t as y}from"./tm-app.20954b06.js";import{t as w}from"./tm-sheet.2873fe67.js";import{t as b}from"./tm-text.fdd4f0a8.js";import{_ as T}from"./tm-divider.vue_vue_type_script_setup_true_lang.0bd9a5e3.js";import{t as z}from"./tm-icon.5716c798.js";const $=v(e({__name:"tm-sort",props:{width:{type:Number,default:750},height:{type:Number,default:174},itemHeight:{type:Number,default:88},column:{type:Number,default:3},color:{type:String,default:"white"},fontSize:{type:Number,default:24},iconSize:{type:Number,default:36},list:{type:Array,default:()=>[]}},emits:["start","end"],setup(e,{emit:v}){var y;const T=e;t(0);const $=(null==(y=p())?void 0:y.proxy)??null;let k=0,N=0,S=0;const j=t([]),C=t(-1),I=t(-1);let D=NaN,E={left:0,top:0};const H=t(!1);let M=T.list;function O(){clearTimeout(D),D=setTimeout((()=>{X()}),100)}function X(e=!1){let t=T.column;e||(M=M.map(((e,t)=>(e._id=t,e))));let n=uni.$tm.u.deepClone(M),i=uni.$tm.u.splitData(n,t),o=i.length;S=o,k=l(T.width/t),N=l(T.itemHeight),i=i.map(((n,i)=>n=n.map(((n,l)=>(n._index=i*t+l,n._id=n._id,e?(n._x=l*k-.5,n._y=i*N-.5):(n._x=l*k,n._y=i*N),n._newx=l*k,n._newy=i*N,n.width=k,n.height=N,n))))),j.value=[];let a=[];i.forEach((e=>{a.push(...e)})),j.value=[...a],e&&setTimeout((()=>{j.value=j.value.map((e=>(e._x=e._newx,e._y=e._newy,e)))}),50)}function Y(){H.value=!0,v("start",M)}function q(e,t){H.value=!1;let n=uni.$tm.u.deepClone(M),i=uni.$tm.u.deepClone(M);const l=i[t];let o=A(e,t);const[a]=i.splice(o,1,l);i.splice(t,1,a),M=[...i],X(!0),C.value=-1,I.value=-1,v("end",M,n)}function A(e,t=0){let{clientX:n,clientY:i,pageX:l,pageY:o}=e.changedTouches[0],a=n??l,u=i??o,s=0;a=a<=E.left?E.left:a,u=u<=E.top?E.top:u;let c=a-E.left,r=u-E.top,d=Math.floor(c/k),h=Math.floor(r/N);return h>=S-1&&(h=S-1),d>=T.column-1&&(d=T.column-1),s=h*T.column+d,s>=M.length&&(s=M.length-1),s}return n((()=>{O(),setTimeout((()=>{uni.$tm.u.quereyDom($,"#box").then((e=>{e&&(E.left=e.left,E.top=e.top)}))}),50)})),i((()=>T.list),(()=>{M=uni.$tm.u.deepClone(T.list),O()}),{deep:!0}),(e,t)=>{const n=f,i=g,l=x;return o(),a(n,{id:"box",ref:"box",style:m({width:T.width+"rpx",height:T.height+"rpx"})},{default:u((()=>[s(' <view \r\n        class="flex flex-row-top-start flex-row flex-wrap"\r\n        :style="{ width: props.width + \'rpx\', height: props.height + \'rpx\', background: \'red\' }">\r\n            <view v-for="(item, index) in _data" :key="index"\r\n                :style="{ width: `${item.width}px`, height: `${item.height}px`, background: \'yellow\' }">\r\n                {{ item._id }}\r\n            </view>\r\n        </view> '),c(l,{style:m({width:T.width+"rpx",height:T.height+"rpx"})},{default:u((()=>[(o(!0),r(h,null,d(j.value,((e,t)=>(o(),a(i,{class:_([[C.value===e._index?"opacity-6 zIndex-1":"zIndex-0"],""]),animation:!1,onTouchstart:Y,onTouchmove:e=>function(e,t){H.value&&(clearTimeout(D),D=setTimeout((()=>{I.value=A(e,t),H.value||(I.value=-1)}),150))}(e,t),onTouchcancel:e=>q(e,t),onTouchend:e=>q(e,t),onChange:e=>function(e,t){H.value&&(e.detail,C.value=t)}(e,t),x:e._x,y:e._y,style:m({width:`${e.width}px`,height:`${e.height}px`,background:"white"}),"data-index":e._index,direction:"all",key:t},{default:u((()=>[c(n,{class:_([I.value===t?"onSelecteItemStyle ":"","onSelecteItem "])},{default:u((()=>[c(w,{border:0,margin:[0],padding:[0],width:e.width,height:e.height,unit:"px",color:I.value===t?"grey-2":T.color,_class:"flex flex-col flex-col-center-center"},{default:u((()=>[e.icon?(o(),a(z,{key:0,"font-size":T.iconSize,name:(null==e?void 0:e.icon)??""},null,8,["font-size","name"])):s("v-if",!0),c(b,{_class:"text-align-center","font-size":T.fontSize,label:(null==e?void 0:e.text)??""},null,8,["font-size","label"])])),_:2},1032,["width","height","color"])])),_:2},1032,["class"])])),_:2},1032,["class","onTouchmove","onTouchcancel","onTouchend","onChange","x","y","style","data-index"])))),128))])),_:1},8,["style"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-065a6ce3"]]),k=e({__name:"sort",setup(e){const n=t([]);function i(e,t){console.log("排序后：",e,"排序前：",t)}return n.value=[{icon:"tmicon-google",text:"谷歌"},{icon:"tmicon-paypal",text:"paypal"},{icon:"tmicon-md-planet",text:"星球"},{icon:"tmicon-ios-rose",text:"玫瑰花"},{icon:"tmicon-ios-cafe",text:"咖啡"},{icon:"tmicon-ios-leaf",text:"绿色健康"},{icon:"tmicon-ios-umbrella",text:"安全"}],(e,t)=>(o(),a(y,null,{default:u((()=>[c(w,{width:662},{default:u((()=>[c(b,{label:"宫格排序，在nvue上： 截止3.6.18 uni sdk 的movable有bug,具体来说是动态修改宽和高时，可移动范围会跑上面去。 理论上是支持nvue，只有当uni修复此bug才可使用，否则，请使用vue页面。"}),c(T)])),_:1}),c($,{onEnd:i,list:n.value,height:460,"item-height":150},null,8,["list"])])),_:1}))}});export{k as default};
