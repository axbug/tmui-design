import{d as e,r as a,H as l,m as u,k as t,R as v,o as s,a as n,w as o,b as i,T as r,j as c,n as x,N as h,u as p,U as f,g as d,V as y,q as m,S as g,W as w,i as b,G as $,X as I,_}from"./index-6b165856.js";import{t as k}from"./tm-app.d6cf2f93.js";import{t as E}from"./tm-text.6c910eb0.js";const M=_(e({__name:"tm-cropimg",props:{url:{type:String,default:""},width:{type:Number,default:150},height:{type:Number,default:150}},emits:["confirm","cance"],setup(e,{emit:_}){var k,M,T;const X=e,H=null!=(M=null==(k=d())?void 0:k.proxy)?M:null,P=a(X.url),{safeArea:Y,windowWidth:W,windowHeight:j,statusBarHeight:C}=l(),N=(null==Y?void 0:Y.width)||W;let F=null!=(T=null==Y?void 0:Y.height)?T:j-44;const L=a({px:0,py:0,px2:0,py2:0,xy:0}),S=a({w:X.width,h:X.height,x:0,y:0}),V=a({scale:1,oldscale:1,center:[0,0],sourceImgWidth:0,sourceImgHeight:0,w:0,h:0,x:0,y:0});let q=a(!1),z=0,A=a(!1),B=null;function G(e){if(!P.value)return;q.value=!0;let a=e.touches[0],l=e.touches[1];"mousedown"==e.type&&(a=e),z=function(e,a){if(e>=S.value.x-15&&e<=S.value.x+15&&a>=S.value.y&&a<=S.value.y+S.value.h)return 1;if(e>=S.value.x&&e<=S.value.w&&a>=S.value.y-15&&a<=S.value.y+15)return 1;if(e>=S.value.x+S.value.w-15&&e<=S.value.x+S.value.w+15&&a>=S.value.y&&a<=S.value.y+S.value.h)return 1;if(e>=S.value.x&&e<=S.value.x+S.value.w&&a>=S.value.y+S.value.h-15&&a<=S.value.y+S.value.h+15)return 1;return 0}(a.pageX,a.pageY),0==z?(L.value.px=a.pageX-V.value.x,L.value.py=a.pageY-V.value.y):(L.value.px=a.pageX-S.value.x,L.value.py=a.pageY-S.value.y),l&&(L.value.px2=l.pageX,L.value.py2=l.pageY),V.value.oldscale=V.value.scale}function R(e){if(!P.value)return;let a=e.touches[0];e.touches[1],"mousedown"==e.type&&(a=e),q.value&&(0==z?(V.value.x=a.pageX-L.value.px,V.value.y=a.pageY-L.value.py):(S.value.x=a.pageX-L.value.px,S.value.y=a.pageY-L.value.py))}function U(e){P.value&&(q.value=!1,A.value=!1,S.value.x<=12&&(S.value.x=12),S.value.x>=N-S.value.w-12&&(S.value.x=N-S.value.w-12),S.value.y<=12&&(S.value.y=12),S.value.y>=F-S.value.h-90&&(S.value.y=F-S.value.h-90),V.value.x>=S.value.x&&(V.value.x=S.value.x),V.value.x+V.value.w<=S.value.x+S.value.w&&(V.value.x=S.value.x-(V.value.w-S.value.w)),V.value.y>=S.value.y&&(V.value.y=S.value.y),V.value.y+V.value.h<=S.value.y+S.value.h&&(V.value.y=S.value.y-(V.value.h-S.value.h)))}function D(){y({count:1,success(e){let a=e.tempFilePaths;1==a.length&&(P.value=a[0],V.value.scale=1,V.value.oldscale=1)}})}function J(e){const{width:a,height:l}=e.detail;V.value.sourceImgWidth=a,V.value.sourceImgHeight=l,function(){V.value.x=S.value.x;let e=S.value.w,a=e/(V.value.sourceImgWidth/V.value.sourceImgHeight);V.value.h=a,V.value.w=e,V.value.h<S.value.h&&(V.value.h=S.value.h,V.value.w=V.value.h*(e/a));V.value.y=-(V.value.h-S.value.h)/2+S.value.y,V.value.center=[V.value.w/2,V.value.h/2]}()}function K(e){console.log(e)}function O(){if(!P.value)return void m({title:"未选择",icon:"none"});let e=Math.abs(V.value.x-S.value.x),a=Math.abs(V.value.y-S.value.y);B.drawImage(P.value,-e,-a,V.value.w,V.value.h),B.draw(!1,(e=>{console.log("绘制成功 "),g({canvasId:"imgid",success(e){_("confirm",e.tempFilePath)}},H)}))}return u((()=>{t((function(){setTimeout((function(){B=v("imgid",H)}),50)}))})),function(){let e=(N-S.value.w)/2,a=(F-S.value.h)/2;S.value.x=e,S.value.y=a}(),(e,a)=>{const l=w,u=b,t=$,v=I;return s(),n(u,{onLongpress:a[1]||(a[1]=()=>{}),onTouchstart:G,onTouchmove:f(R,["stop","prevent"]),onTouchend:U,onTouchcancel:U,onMousedown:G,onMousemove:f(R,["stop","prevent"]),onMouseup:U,onMouseleave:U,class:"relative overflow",style:x([{width:`${p(N)}px`,height:`${p(F)}px`,background:"#000000"}])},{default:o((()=>[P.value?c("v-if",!0):(s(),n(u,{key:0,class:"flex flex-center py-24"},{default:o((()=>[i(l,{style:{"font-size":"24rpx",color:"white"}},{default:o((()=>[r("请选择选择图片才可操作")])),_:1})])),_:1})),i(t,{id:"imgid","canvas-id":"imgid",class:"l-0 t-0",style:x([{width:`${S.value.w}px`,height:`${S.value.h}px`,transform:"translate(-1000px,-1000px)"}])},null,8,["style"]),c(" transform: `translate(${imgPos.x}px,${imgPos.y}px) scale(${imgPos.scale},${imgPos.scale})` "),c(' <image v-if="url" :src="url"></image> '),P.value?(s(),n(v,{key:1,onError:K,class:h(["absolute l-0 t-0",[p(q)?"opacity-10":"ani opacity-5"]]),userInteractionEnabled:!1,onLoad:J,src:P.value,style:x([{width:`${V.value.w||1}px`,height:`${V.value.h||1}px`,transform:P.value?`translate(${V.value.x}px,${V.value.y}px) scale(${V.value.scale},${V.value.scale})`:"translate(-1000px,-1000px)","transform-origin":`${V.value.center[0]}px ${V.value.center[1]}px`}])},null,8,["class","src","style"])):c("v-if",!0),c(" \t\t   "),i(u,{class:h([[p(q)?"":"ani"],"absolute l-0 t-0 rect"]),userInteractionEnabled:!1,style:x([{width:S.value.w+"px",height:S.value.h+"px",transform:`translate(${S.value.x}px,${S.value.y}px)`}])},null,8,["class","style"]),i(u,{class:"absolute l-0 b-0",style:x({width:`${p(N)}px`,height:"80px"})},{default:o((()=>[c(' \t<view class="flex-center mb-24">\r\n\t\t\t\t<tm-slider @change="scaleChange" :width="600" :max=\'3\' :min=\'1\'></tm-slider>\r\n\t\t\t</view> '),i(u,{class:"flex-row flex flex-row-center-between"},{default:o((()=>[c(" 翻转 "),c(' <view class="flex-1 flex flex-center">\r\n\t\t\t\t\t<tm-text :userInteractionEnabled="false" color="white" label="旋转"></tm-text>\r\n\t\t\t\t</view> '),c(" 取消 "),i(u,{onClick:a[0]||(a[0]=e=>_("cance")),class:"flex-1 flex flex-center"},{default:o((()=>[i(E,{userInteractionEnabled:!1,color:"white",label:"取消"})])),_:1}),c(" 选择图片 "),i(u,{onClick:D,class:"flex-1 flex flex-center"},{default:o((()=>[i(E,{userInteractionEnabled:!1,color:"white",label:"选择图片"})])),_:1}),c(" 确认 "),i(u,{onClick:O,class:"flex-1 flex flex-center"},{default:o((()=>[i(E,{userInteractionEnabled:!1,color:"white",label:"确认"})])),_:1})])),_:1})])),_:1},8,["style"])])),_:1},8,["onTouchmove","onMousemove","style"])}}}),[["__scopeId","data-v-f09629f2"]]),T=e({__name:"cropimg",setup:e=>(e,a)=>(s(),n(k,null,{default:o((()=>[i(M)])),_:1}))});export{T as default};
