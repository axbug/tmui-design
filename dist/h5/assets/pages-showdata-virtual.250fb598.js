import{d as e,L as t,r as l,c as a,p as o,o as r,a as u,w as i,b as s,k as n,n as f,u as c,N as d,j as p,$ as v,e as m,f as h,F as x}from"./index-5c06cf16.js";import{t as _}from"./tm-app.20954b06.js";import{t as g}from"./tm-sheet.2873fe67.js";import{t as y}from"./tm-text.fdd4f0a8.js";import{_ as b}from"./tm-image.vue_vue_type_script_setup_true_lang.f325e7c1.js";import{t as w}from"./tm-icon.5716c798.js";import{_ as k}from"./tm-divider.vue_vue_type_script_setup_true_lang.0bd9a5e3.js";import"./tm-translate.4fbb7927.js";const j=e({__name:"tm-virtual-list",props:{width:{type:Number,default:300},height:{type:Number,default:500},topHeight:{type:Number,default:0},itemHeight:{type:Number,default:0,required:!0},data:{type:Array,default:()=>[]},load:{type:[Function,Boolean],default:()=>!0},firstLoad:{type:Boolean,default:!0},color:{type:String,default:"primary"}},emits:["pullEnd","pullStart","status"],setup(e,{emit:m}){const h=e,x=t(h.itemHeight),_=t(h.topHeight),b=t(h.height),k=l(0),j=a((()=>h.data.length)),E=a((()=>{const e=[0];for(let t=1;t<j.value;t++)e.push(e[t-1]+x);return e})),$=a((()=>(j.value?E.value[j.value-1]+x:0)+_)),z=a((()=>function(){let e=0,t=j.value?j.value-1:j.value;for(;t!==e;){const l=Math.floor((t-e)/2+e);if(E.value[l]<=k.value&&E.value[l+1]>k.value)return l;if(l===e)return t;E.value[l]<=k.value?e=l:t=l}return j.value}())),H=a((()=>Math.max(0,z.value-2))),I=a((()=>function(){let e;for(e=z.value;e<j.value;e++)if(E.value[e]>E.value[z.value]+b)return e;return e}())),M=a((()=>Math.min(j.value-1,I.value+2))),N=a((()=>M.value-H.value+1)),S=a((()=>E.value[H.value]+_)),L=a((()=>h.data.slice(H.value,H.value+N.value))),T=l(!1),B=l(""),C=l("never");function F(e){let t=e.detail;k.value=t.scrollTop,Math.ceil(k.value)<-80&&P(),Math.ceil(k.value)>=0&&"error"==C.value&&(T.value=!1)}const P=async e=>{if(m("pullStart"),"function"==typeof h.load){if(T.value)return;B.value="top",T.value=!0,C.value="loading";let e=await h.load("top");if("function"==typeof e&&(e=await e("top")),!e)return void(C.value="error");T.value=!1,C.value="success"}},Y=async e=>{if(m("pullEnd"),"function"==typeof h.load){if(T.value)return;B.value="bottom",T.value=!0,C.value="loading";let e=await h.load("bottom");if("function"==typeof e&&(e=await e("bottom")),!e)return void(C.value="error");T.value=!1,C.value="success"}},q=function(e){T.value=!1,"pullEnd"==e?Y():P()};return o((()=>{h.firstLoad&&P()})),(e,t)=>{const l=p,a=v;return r(),u(l,{class:"flex flex-col"},{default:i((()=>[s(a,{"refresher-triggered":T.value,onScrolltolower:Y,"scroll-with-animation":!0,onScroll:F,"scroll-y":!0,style:f([{height:c(b)+"px","overflow-anchor":"auto",width:`${h.width}rpx`}])},{default:i((()=>[T.value&&"top"==B.value?(r(),u(g,{key:0,height:40,unit:"px",margin:[0,0],_class:"flex flex-col flex-col-center-center"},{default:i((()=>["loading"==C.value?(r(),u(w,{key:0,color:h.color,"font-size":24,spin:"",name:"tmicon-shuaxin"},null,8,["color"])):n("v-if",!0),"error"==C.value?(r(),u(l,{key:1,onClick:t[0]||(t[0]=e=>q("pullTop")),class:"flex flex-row flex-center"},{default:i((()=>[s(w,{userInteractionEnabled:!1,color:"red","font-size":24,name:"tmicon-times-circle-fill"}),s(y,{userInteractionEnabled:!1,color:"red","font-size":24,_class:"pl-16",label:"加载失败,点我重试"})])),_:1})):n("v-if",!0)])),_:1})):n("v-if",!0),s(l,{class:"flex flex-col relative",style:f([{height:c($)+"px"}])},{default:i((()=>[s(l,{class:"absolute l-0 t-0 flex flex-col",style:f({height:`${h.topHeight}rpx`,width:`${h.width}rpx`})},{default:i((()=>[d(e.$slots,"top")])),_:3},8,["style"]),s(l,{class:"absolute l-0 t-0 flex flex-col",style:f({transform:`translateY(${c(S)}px)`,width:`${h.width}rpx`})},{default:i((()=>[d(e.$slots,"default",{data:c(L)})])),_:3},8,["style"])])),_:3},8,["style"]),T.value&&"bottom"==B.value?(r(),u(g,{key:1,height:40,unit:"px",margin:[0,0],_class:"flex flex-col flex-col-center-center"},{default:i((()=>["loading"==C.value?(r(),u(w,{key:0,color:h.color,"font-size":24,spin:"",name:"tmicon-shuaxin"},null,8,["color"])):n("v-if",!0),"error"==C.value?(r(),u(l,{key:1,onClick:t[1]||(t[1]=e=>q("pullEnd")),class:"flex flex-row flex-center"},{default:i((()=>[s(w,{userInteractionEnabled:!1,color:"red","font-size":24,name:"tmicon-times-circle-fill"}),s(y,{userInteractionEnabled:!1,color:"red","font-size":24,_class:"pl-16",label:"加载失败,点我重试"})])),_:1})):n("v-if",!0)])),_:1})):n("v-if",!0)])),_:3},8,["refresher-triggered","style"])])),_:3})}}}),E=e({__name:"virtual",setup(e){const t=l([]),a=e=>new Promise(((l,a)=>{setTimeout((function(){if("top"==e){t.value=[];for(let e=0;e<10;e++)t.value.push({src:"https://i0.pickpik.com/photos/298/434/513/beach-dawn-dusk-ocean-thumb.jpg",index:e})}else if("bottom"==e){let e=t.value.length;for(let l=e;l<10+e;l++)t.value.push({src:"https://i0.pickpik.com/photos/298/434/513/beach-dawn-dusk-ocean-thumb.jpg",index:l})}l(!0)}),2500)}));return(e,l)=>{const o=p;return r(),u(_,null,{default:i((()=>[s(g,null,{default:i((()=>[s(y,{"font-size":30,_class:"font-weight-b",label:"基础示例,更多见文档，以下是展示你可以无限加载图片列表，你将看不到任何卡顿或者阻塞。超高性能的虚拟列表。"}),s(k),s(o,{class:"flex flex-col flex-col-top-center"},{default:i((()=>[s(j,{load:a,width:626,height:900,data:t.value,itemHeight:160},{default:i((({data:e})=>[(r(!0),m(x,null,h(e,((e,t)=>(r(),u(g,{border:1,borderDirection:"bottom",height:160,width:626,_class:"flex flex-row flex-row-center-start",padding:[0,0],margin:[0,0],key:t},{default:i((()=>[s(o,{class:"flex flex-row flex-row-center-between flex-1"},{default:i((()=>[s(b,{width:200,height:100,src:e.src},null,8,["src"]),s(y,{label:"image-Row-"+e.index},null,8,["label"])])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["data"])])),_:1})])),_:1})])),_:1})}}});export{E as default};
