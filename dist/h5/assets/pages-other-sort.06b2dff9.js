import{d as e,r as t,m as l,Q as n,K as i,o,a,w as u,j as s,b as c,e as r,f as d,F as m,n as h,g as p,i as f,ab as x,N as _,ac as g,_ as v}from"./index-6b165856.js";import{t as y}from"./tm-app.d6cf2f93.js";import{t as w}from"./tm-sheet.3639b36a.js";import{t as b}from"./tm-text.6c910eb0.js";import{_ as T}from"./tm-divider.vue_vue_type_script_setup_true_lang.cbbfcb4c.js";import{t as z}from"./tm-icon.65b53dc0.js";const $=v(e({__name:"tm-sort",props:{width:{type:Number,default:750},height:{type:Number,default:174},itemHeight:{type:Number,default:88},column:{type:Number,default:3},color:{type:String,default:"white"},fontSize:{type:Number,default:24},iconSize:{type:Number,default:36},list:{type:Array,default:()=>[]}},emits:["start","end"],setup(e,{emit:v}){var y,T;const $=e;t(0);const N=null!=(T=null==(y=p())?void 0:y.proxy)?T:null;let S=0,j=0,k=0;const C=t([]),I=t(-1),D=t(-1);let E=NaN,H={left:0,top:0};const M=t(!1);let X=$.list;function Y(){clearTimeout(E),E=setTimeout((()=>{q()}),100)}function q(e=!1){let t=$.column;e||(X=X.map(((e,t)=>(e._id=t,e))));let l=uni.$tm.u.deepClone(X),n=uni.$tm.u.splitData(l,t),o=n.length;k=o,S=i($.width/t),j=i($.itemHeight),n=n.map(((l,n)=>l=l.map(((l,i)=>(l._index=n*t+i,l._id=l._id,e?(l._x=i*S-.5,l._y=n*j-.5):(l._x=i*S,l._y=n*j),l._newx=i*S,l._newy=n*j,l.width=S,l.height=j,l))))),C.value=[];let a=[];n.forEach((e=>{a.push(...e)})),C.value=[...a],e&&setTimeout((()=>{C.value=C.value.map((e=>(e._x=e._newx,e._y=e._newy,e)))}),50)}function A(){M.value=!0,v("start",X)}function F(e,t){M.value=!1;let l=uni.$tm.u.deepClone(X),n=uni.$tm.u.deepClone(X);const i=n[t];let o=J(e,t);const[a]=n.splice(o,1,i);n.splice(t,1,a),X=[...n],q(!0),I.value=-1,D.value=-1,v("end",X,l)}function J(e,t=0){let{clientX:l,clientY:n,pageX:i,pageY:o}=e.changedTouches[0],a=null!=l?l:i,u=null!=n?n:o,s=0;a=a<=H.left?H.left:a,u=u<=H.top?H.top:u;let c=a-H.left,r=u-H.top,d=Math.floor(c/S),m=Math.floor(r/j);return m>=k-1&&(m=k-1),d>=$.column-1&&(d=$.column-1),s=m*$.column+d,s>=X.length&&(s=X.length-1),s}return l((()=>{Y(),setTimeout((()=>{uni.$tm.u.quereyDom(N,"#box").then((e=>{e&&(H.left=e.left,H.top=e.top)}))}),50)})),n((()=>$.list),(()=>{X=uni.$tm.u.deepClone($.list),Y()}),{deep:!0}),(e,t)=>{const l=f,n=g,i=x;return o(),a(l,{id:"box",ref:"box",style:h({width:$.width+"rpx",height:$.height+"rpx"})},{default:u((()=>[s(' <view \r\n        class="flex flex-row-top-start flex-row flex-wrap"\r\n        :style="{ width: props.width + \'rpx\', height: props.height + \'rpx\', background: \'red\' }">\r\n            <view v-for="(item, index) in _data" :key="index"\r\n                :style="{ width: `${item.width}px`, height: `${item.height}px`, background: \'yellow\' }">\r\n                {{ item._id }}\r\n            </view>\r\n        </view> '),c(i,{style:h({width:$.width+"rpx",height:$.height+"rpx"})},{default:u((()=>[(o(!0),r(m,null,d(C.value,((e,t)=>(o(),a(n,{class:_([[I.value===e._index?"opacity-6 zIndex-1":"zIndex-0"],""]),animation:!1,onTouchstart:A,onTouchmove:e=>function(e,t){M.value&&(clearTimeout(E),E=setTimeout((()=>{D.value=J(e,t),M.value||(D.value=-1)}),150))}(e,t),onTouchcancel:e=>F(e,t),onTouchend:e=>F(e,t),onChange:e=>function(e,t){M.value&&(e.detail,I.value=t)}(e,t),x:e._x,y:e._y,style:h({width:`${e.width}px`,height:`${e.height}px`,background:"white"}),"data-index":e._index,direction:"all",key:t},{default:u((()=>[c(l,{class:_([D.value===t?"onSelecteItemStyle ":"","onSelecteItem "])},{default:u((()=>[c(w,{border:0,margin:[0],padding:[0],width:e.width,height:e.height,unit:"px",color:D.value===t?"grey-2":$.color,_class:"flex flex-col flex-col-center-center"},{default:u((()=>{var t,l;return[e.icon?(o(),a(z,{key:0,"font-size":$.iconSize,name:null!=(t=null==e?void 0:e.icon)?t:""},null,8,["font-size","name"])):s("v-if",!0),c(b,{_class:"text-align-center","font-size":$.fontSize,label:null!=(l=null==e?void 0:e.text)?l:""},null,8,["font-size","label"])]})),_:2},1032,["width","height","color"])])),_:2},1032,["class"])])),_:2},1032,["class","onTouchmove","onTouchcancel","onTouchend","onChange","x","y","style","data-index"])))),128))])),_:1},8,["style"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-065a6ce3"]]),N=e({__name:"sort",setup(e){const l=t([]);function n(e,t){console.log("排序后：",e,"排序前：",t)}return l.value=[{icon:"tmicon-google",text:"谷歌"},{icon:"tmicon-paypal",text:"paypal"},{icon:"tmicon-md-planet",text:"星球"},{icon:"tmicon-ios-rose",text:"玫瑰花"},{icon:"tmicon-ios-cafe",text:"咖啡"},{icon:"tmicon-ios-leaf",text:"绿色健康"},{icon:"tmicon-ios-umbrella",text:"安全"}],(e,t)=>(o(),a(y,null,{default:u((()=>[c(w,{width:662},{default:u((()=>[c(b,{label:"宫格排序，在nvue上： 截止3.6.18 uni sdk 的movable有bug,具体来说是动态修改宽和高时，可移动范围会跑上面去。 理论上是支持nvue，只有当uni修复此bug才可使用，否则，请使用vue页面。"}),c(T)])),_:1}),c($,{onEnd:n,list:l.value,height:460,"item-height":150},null,8,["list"])])),_:1}))}});export{N as default};
