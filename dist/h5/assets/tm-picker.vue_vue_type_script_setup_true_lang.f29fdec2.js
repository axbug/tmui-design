import{d as e,r as l,c as t,P as a,ad as n,R as u,p as o,o as d,a as i,w as r,N as s,b as f,u as m,k as c,n as p,g as h,L as v,m as y,Q as g,j as b}from"./index-5c06cf16.js";import{c as x}from"./tm-app.20954b06.js";import{t as C}from"./tm-drawer.5aba0891.js";import{_ as S}from"./tm-picker-view.vue_vue_type_script_setup_true_lang.1cebc498.js";import{t as k}from"./tm-button.5fc2eaaa.js";const _=e({__name:"tm-picker",props:{...x,modelValue:{type:Array,default:()=>[]},modelStr:{type:[String],default:""},defaultValue:{type:Array,default:()=>[]},selectedModel:{type:String,default:"index"},columns:{type:Array,default:()=>[],required:!0},dataKey:{type:String,default:"text"},mapKey:{type:String,default:"text"},beforeChange:{type:[Boolean,Function],default:()=>!1},show:{type:[Boolean],default:!1},color:{type:String,default:"primary"},linear:{type:String,default:""},linearDeep:{type:String,default:"light"},btnRound:{type:Number,default:0},round:{type:Number,default:12},height:{type:Number,default:700},immediateChange:{type:Boolean,default:!1},inContent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},zIndex:{type:[Number,String],default:999},duration:{type:Number,default:300}},emits:["update:show","update:modelValue","update:modelStr","confirm","cancel","close","open"],setup(e,{emit:x}){var _;const w=e,V=l(null);null==(_=h())||_.proxy;const I=l(!0),K=l([]),N=t((()=>w.columns)),j=l(w.modelStr),M=l(!0),B=a("tmuiSysInfo",t((()=>({bottom:0,height:750,width:v(750),top:0,isCustomHeader:!1,sysinfo:null}))));let z=NaN;function T(e){I.value=e,x("update:show",I.value),Q(N.value,w.selectedModel,0,w.modelValue),x("close")}function A(){x("open")}function R(){0==K.value.length&&function(e=[],l="name",t=0,a=[]){let n=[...K.value];if(K.value=[],"name"==l){let u=e.filter((e=>a[t]==e.text));0==u.length?(u=e[0],u&&(a[t]=u.text,n[t]=0,u.children&&Q(u.children,l,t+1,a))):(u=u[0],u&&(n[t]=e.findIndex((e=>e.text==u.text)),u.children&&Q(u.children,l,t+1,a)))}else if("id"==l){let u=e.filter((e=>a[t]==e.id));0==u.length?(u=e[0],u&&(a[t]=u.id,n[t]=0,u.children&&Q(u.children,l,t+1,a))):(u=u[0],u&&(n[t]=e.findIndex((e=>e.id==u.id)),u.children&&Q(u.children,l,t+1,a)))}else n=[...a];K.value=[...n],K.value}(N.value,w.selectedModel,0,w.defaultValue),function(){let e=[];e="name"==w.selectedModel?j.value.split("/")??[]:"id"==w.selectedModel?U(N.value,0):[...K.value];x("update:modelValue",e),x("update:modelStr",j.value)}(),y((()=>{var e;x("confirm",g(K.value)),null==(e=V.value)||e.close()}))}function D(){M.value&&x("cancel")}function O(){clearTimeout(z),z=setTimeout((function(){if(!j.value&&K.value.length>0){let e=q(N.value,0).join("/");x("update:modelStr",e)}0==K.value.length&&x("update:modelStr","")}),100)}function Q(e=[],l="name",t=0,a=[]){if(0==a.length)return K.value=[],[];let n=[...K.value];if(K.value=[],"name"==l){let u=e.filter((e=>a[t]==e.text));0==u.length||(u=u[0],u&&(n[t]=e.findIndex((e=>e.text==u.text)),u.children&&Q(u.children,l,t+1,a)))}else if("id"==l){let u=e.filter((e=>a[t]==e.id));0==u.length||(u=u[0],u&&(n[t]=e.findIndex((e=>e.id==u.id)),u.children&&Q(u.children,l,t+1,a)))}else n=[...a];return K.value=[...n],K.value}function U(e=[],l=0){let t=[];for(let a=0;a<e.length;a++)if(a==K.value[l]){if(t.push(e[a].id),void 0!==K.value[l]){let n=U(e[a].children,l+1);t=[...t,...n]}break}return t}function q(e=[],l=0){let t=[];for(let a=0;a<e.length;a++)if(a==K.value[l]){if(t.push(e[a].text),void 0!==K.value[l]){let n=q(e[a].children,l+1);t=[...t,...n]}break}return t}n((()=>{I.value=w.show})),u([()=>w.columns,()=>w.modelValue],(()=>{clearTimeout(z),z=setTimeout((function(){Q(N.value,w.selectedModel,0,w.modelValue),O()}),500)}),{deep:!0}),o((()=>{w.defaultValue.length>0&&(Q(N.value,w.selectedModel,0,w.defaultValue),O())}));const E=t((()=>w.height+B.value.bottom+80));return(e,l)=>{const t=b;return d(),i(t,{onClick:l[4]||(l[4]=e=>I.value=!w.disabled&&!I.value)},{default:r((()=>[s(e.$slots,"default"),f(C,{zIndex:w.zIndex,inContent:w.inContent,disabbleScroll:!0,round:w.round,ref_key:"drawer",ref:V,height:m(E),closeable:!0,overlayClick:M.value,onOpen:A,onCancel:D,onOk:R,show:I.value,onClose:T,title:"请选择","ok-text":"确认"},{default:r((()=>[I.value?(d(),i(S,{key:0,dataKey:w.mapKey||w.dataKey,"map-key":w.mapKey||w.dataKey,height:m(E)-230,onEnd:l[0]||(l[0]=e=>M.value=!0),onStart:l[1]||(l[1]=e=>M.value=!1),value:K.value,"onUpdate:modelValue":l[2]||(l[2]=e=>K.value=e),"onUpdate:modelStr":l[3]||(l[3]=e=>j.value=e),"model-str":j.value,"default-value":K.value,beforeChange:w.beforeChange,immediateChange:w.immediateChange,columns:m(N)},null,8,["dataKey","map-key","height","value","model-str","default-value","beforeChange","immediateChange","columns"])):c("v-if",!0),f(k,{label:"确认选择",block:"",margin:[32,12],color:w.color,linear:w.linear,"linear-deep":w.linearDeep,onClick:R,round:w.btnRound},null,8,["color","linear","linear-deep","round"]),f(t,{style:p({height:m(B).bottom+"px"})},null,8,["style"])])),_:1},8,["zIndex","inContent","round","height","overlayClick","show"])])),_:3})}}});export{_};
