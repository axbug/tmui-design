var e=Object.defineProperty,t=(t,o,l)=>(((t,o,l)=>{o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[o]=l})(t,"symbol"!=typeof o?o+"":o,l),l);import{d as o,r as l,p as a,S as s,J as n,L as i,o as u,a as r,w as h,b as d,V as c,n as p,g as f,t as v,T as m,H as g,j as _,e as y,f as w,F as x,u as T}from"./index-5c06cf16.js";import{t as b}from"./tm-app.20954b06.js";import{t as j}from"./tm-sheet.2873fe67.js";import{t as k}from"./tm-text.fdd4f0a8.js";import{t as M}from"./tm-button.5fc2eaaa.js";import{_ as C}from"./tm-divider.vue_vue_type_script_setup_true_lang.0bd9a5e3.js";import{_ as P,a as V}from"./tm-radio.vue_vue_type_script_setup_true_lang.8fe0c58b.js";import{_ as D}from"./tm-slider.vue_vue_type_script_setup_true_lang.4f5e1a70.js";import"./tm-icon.5716c798.js";const L=o({__name:"tm-sign-board",props:{width:{type:Number,default:750},height:{type:Number,default:500},lineWidth:{type:Number,default:5},lineColor:{type:String,default:"red"}},setup(e,{expose:o}){var y;const w=e,x=(null==(y=f())?void 0:y.proxy)??null,T=l("canvasId");let b;T.value="tm"+uni.$tm.u.getUid(5);let j,k=0,M=0;function C(e){if(j)if(-1==e.type.indexOf("mouse")&&1==e.changedTouches.length){var t=e.changedTouches[0];j.down(t.x,t.y)}else j.down(e.pageX-e.currentTarget.offsetLeft-k,e.pageY-e.currentTarget.offsetTop-M)}function P(e){if(j)if((null==e?void 0:e.preventDefault)&&(null==e||e.preventDefault()),(null==e?void 0:e.stopPropagation)&&(null==e||e.stopPropagation()),-1==e.type.indexOf("mouse")&&1==e.changedTouches.length){var t=e.changedTouches[0];j.move(t.x,t.y)}else j.move(e.pageX-e.currentTarget.offsetLeft-k,e.pageY-e.currentTarget.offsetTop-M)}function V(e){if(j)if(-1==e.type.indexOf("mouse")&&1==e.changedTouches.length){var t=e.changedTouches[0];j.up(t.x,t.y)}else j.up(e.pageX-e.currentTarget.offsetLeft-k,e.pageY-e.currentTarget.offsetTop-M)}l(!1),a((()=>{setTimeout((()=>(b=s(T.value,x),void n().in(x).select("#"+T.value).boundingClientRect((e=>{k=e.left??0,M=e.top??0,j=new D(b,i(w.width),i(w.height))})).exec())),50)})),o({save:function(){return new Promise(((e,t)=>{if(!b)return v({title:"初始化失败",icon:"none"}),void t("初始化失败");m({x:0,y:0,destWidth:i(w.width),destHeight:i(w.height),width:w.width,height:w.height,canvasId:T.value,canvas:undefined,success:function(t){e(t.tempFilePath)},fail:e=>{console.error(e),t(e)}},x)}))},clear:function(){b?(b.clearRect(0,0,i(w.width),i(w.height)),b.draw(!1)):v({title:"初始化失败",icon:"none"})}});class D{constructor(e,o,l,a=2,s="black"){t(this,"_x",0),t(this,"_y",0),t(this,"_lineWidth",2),t(this,"_lineColor","black"),t(this,"cx"),t(this,"width",0),t(this,"height",0),t(this,"_isDown",!1),t(this,"_points",[]),this._lineColor=s,this._lineWidth=a,this.width=o,this.height=l,this.cx=e}down(e=0,t=0){this._isDown=!0,this._x=e,this._y=t}move(e=0,t=0){this._isDown&&(b.setStrokeStyle(w.lineColor),b.setLineWidth(w.lineWidth),b.setLineCap("round"),b.beginPath(),b.moveTo(this._x,this._y),b.lineTo(e,t),b.stroke(),b.closePath(),b.draw(!0),this._x=e,this._y=t)}up(e=0,t=0){this._isDown=!1,this._x=e,this._y=t}}return(e,t)=>{const o=g,l=_;return u(),r(l,{onMouseleave:V,onTouchcancel:V,ref:"tmspin",style:p({width:`${w.width}rpx`,height:`${w.height}rpx`})},{default:h((()=>[d(o,{onTouchstart:c(C,["stop"]),onTouchmove:c(P,["stop"]),onTouchend:c(V,["stop"]),onMousedown:c(C,["stop"]),onMousemove:c(P,["stop"]),onMouseup:c(V,["stop"]),onMouseleave:c(V,["stop"]),onTouchcancel:c(V,["stop"]),id:T.value,"canvas-id":T.value,class:"canvas",style:p({width:`${w.width}rpx`,height:`${w.height}rpx`,"touch-action":"none"})},null,8,["onTouchstart","onTouchmove","onTouchend","onMousedown","onMousemove","onMouseup","onMouseleave","onTouchcancel","id","canvas-id","style"])])),_:1},8,["style"])}}}),W=o({__name:"signBoard",setup(e){var t;const o=(null==(t=f())?void 0:t.proxy)??null,a=l(null),s=["red","blue","black","green"],n=l("red"),i=l(5),c=async()=>{var e;let t=await(null==(e=a.value)?void 0:e.save());v({title:"成功，请查看日志",icon:"none"}),console.log(t)};return(e,t)=>{const l=_;return u(),r(b,null,{default:h((()=>[d(j,{width:662},{default:h((()=>[d(k,{label:"签名板全端兼容，用于签名使用。请在下方书写"}),d(C),d(L,{"line-color":n.value,"line-width":i.value,ref_key:"board",ref:a,width:638,height:400},null,8,["line-color","line-width"]),d(C),d(l,{class:"py-24"},{default:h((()=>[d(k,{label:"选择书写颜色"})])),_:1}),d(P,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e)},{default:h((()=>[(u(),y(x,null,w(s,((e,t)=>d(V,{color:e,value:e,label:e,key:"index"},null,8,["color","value","label"]))),64))])),_:1},8,["modelValue"]),d(l,{class:"py-24"},{default:h((()=>[d(k,{label:"拖动改变粗细"})])),_:1}),d(D,{max:20,modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),"default-value":i.value},null,8,["modelValue","default-value"]),d(C),d(l,{class:"flex flex-row flex-center"},{default:h((()=>[d(M,{onClick:t[2]||(t[2]=e=>T(o).$refs.board.clear()),label:"清空"}),d(M,{color:"green",margin:[24,0],onClick:c,label:"保存签名"})])),_:1})])),_:1})])),_:1})}}});export{W as default};
