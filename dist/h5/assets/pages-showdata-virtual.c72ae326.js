var e=(e,l,t)=>new Promise(((a,o)=>{var r=e=>{try{i(t.next(e))}catch(l){o(l)}},u=e=>{try{i(t.throw(e))}catch(l){o(l)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,u);i((t=t.apply(e,l)).next())}));import{d as l,K as t,r as a,c as o,m as r,o as u,a as i,w as s,b as n,j as f,n as c,u as d,M as v,i as p,$ as m,e as h,f as x,F as y}from"./index-6b165856.js";import{t as _}from"./tm-app.d6cf2f93.js";import{t as g}from"./tm-sheet.3639b36a.js";import{t as b}from"./tm-text.6c910eb0.js";import{_ as w}from"./tm-image.vue_vue_type_script_setup_true_lang.b0e5c126.js";import{t as k}from"./tm-icon.65b53dc0.js";import{_ as j}from"./tm-divider.vue_vue_type_script_setup_true_lang.cbbfcb4c.js";import"./tm-translate.1f1c80c0.js";const E=l({__name:"tm-virtual-list",props:{width:{type:Number,default:300},height:{type:Number,default:500},topHeight:{type:Number,default:0},itemHeight:{type:Number,default:0,required:!0},data:{type:Array,default:()=>[]},load:{type:[Function,Boolean],default:()=>!0},firstLoad:{type:Boolean,default:!0},color:{type:String,default:"primary"}},emits:["pullEnd","pullStart","status"],setup(l,{emit:h}){const x=l,y=t(x.itemHeight),_=t(x.topHeight),w=t(x.height),j=a(0),E=o((()=>x.data.length)),$=o((()=>{const e=[0];for(let l=1;l<E.value;l++)e.push(e[l-1]+y);return e})),z=o((()=>(E.value?$.value[E.value-1]+y:0)+_)),H=o((()=>function(){let e=0,l=E.value?E.value-1:E.value;for(;l!==e;){const t=Math.floor((l-e)/2+e);if($.value[t]<=j.value&&$.value[t+1]>j.value)return t;if(t===e)return l;$.value[t]<=j.value?e=t:l=t}return E.value}())),M=o((()=>Math.max(0,H.value-2))),I=o((()=>function(){let e;for(e=H.value;e<E.value;e++)if($.value[e]>$.value[H.value]+w)return e;return e}())),S=o((()=>Math.min(E.value-1,I.value+2))),N=o((()=>S.value-M.value+1)),P=o((()=>$.value[M.value]+_)),T=o((()=>x.data.slice(M.value,M.value+N.value))),B=a(!1),C=a(""),F=a("never");function L(e){let l=e.detail;j.value=l.scrollTop,Math.ceil(j.value)<-80&&Y(),Math.ceil(j.value)>=0&&"error"==F.value&&(B.value=!1)}const Y=l=>e(this,null,(function*(){if(h("pullStart"),"function"==typeof x.load){if(B.value)return;C.value="top",B.value=!0,F.value="loading";let e=yield x.load("top");if("function"==typeof e&&(e=yield e("top")),!e)return void(F.value="error");B.value=!1,F.value="success"}})),q=l=>e(this,null,(function*(){if(h("pullEnd"),"function"==typeof x.load){if(B.value)return;C.value="bottom",B.value=!0,F.value="loading";let e=yield x.load("bottom");if("function"==typeof e&&(e=yield e("bottom")),!e)return void(F.value="error");B.value=!1,F.value="success"}})),A=function(e){B.value=!1,"pullEnd"==e?q():Y()};return r((()=>{x.firstLoad&&Y()})),(e,l)=>{const t=p,a=m;return u(),i(t,{class:"flex flex-col"},{default:s((()=>[n(a,{"refresher-triggered":B.value,onScrolltolower:q,"scroll-with-animation":!0,onScroll:L,"scroll-y":!0,style:c([{height:d(w)+"px","overflow-anchor":"auto",width:`${x.width}rpx`}])},{default:s((()=>[B.value&&"top"==C.value?(u(),i(g,{key:0,height:40,unit:"px",margin:[0,0],_class:"flex flex-col flex-col-center-center"},{default:s((()=>["loading"==F.value?(u(),i(k,{key:0,color:x.color,"font-size":24,spin:"",name:"tmicon-shuaxin"},null,8,["color"])):f("v-if",!0),"error"==F.value?(u(),i(t,{key:1,onClick:l[0]||(l[0]=e=>A("pullTop")),class:"flex flex-row flex-center"},{default:s((()=>[n(k,{userInteractionEnabled:!1,color:"red","font-size":24,name:"tmicon-times-circle-fill"}),n(b,{userInteractionEnabled:!1,color:"red","font-size":24,_class:"pl-16",label:"加载失败,点我重试"})])),_:1})):f("v-if",!0)])),_:1})):f("v-if",!0),n(t,{class:"flex flex-col relative",style:c([{height:d(z)+"px"}])},{default:s((()=>[n(t,{class:"absolute l-0 t-0 flex flex-col",style:c({height:`${x.topHeight}rpx`,width:`${x.width}rpx`})},{default:s((()=>[v(e.$slots,"top")])),_:3},8,["style"]),n(t,{class:"absolute l-0 t-0 flex flex-col",style:c({transform:`translateY(${d(P)}px)`,width:`${x.width}rpx`})},{default:s((()=>[v(e.$slots,"default",{data:d(T)})])),_:3},8,["style"])])),_:3},8,["style"]),B.value&&"bottom"==C.value?(u(),i(g,{key:1,height:40,unit:"px",margin:[0,0],_class:"flex flex-col flex-col-center-center"},{default:s((()=>["loading"==F.value?(u(),i(k,{key:0,color:x.color,"font-size":24,spin:"",name:"tmicon-shuaxin"},null,8,["color"])):f("v-if",!0),"error"==F.value?(u(),i(t,{key:1,onClick:l[1]||(l[1]=e=>A("pullEnd")),class:"flex flex-row flex-center"},{default:s((()=>[n(k,{userInteractionEnabled:!1,color:"red","font-size":24,name:"tmicon-times-circle-fill"}),n(b,{userInteractionEnabled:!1,color:"red","font-size":24,_class:"pl-16",label:"加载失败,点我重试"})])),_:1})):f("v-if",!0)])),_:1})):f("v-if",!0)])),_:3},8,["refresher-triggered","style"])])),_:3})}}}),$=l({__name:"virtual",setup(e){const l=a([]),t=e=>new Promise(((t,a)=>{setTimeout((function(){if("top"==e){l.value=[];for(let e=0;e<10;e++)l.value.push({src:"https://i0.pickpik.com/photos/298/434/513/beach-dawn-dusk-ocean-thumb.jpg",index:e})}else if("bottom"==e){let e=l.value.length;for(let t=e;t<10+e;t++)l.value.push({src:"https://i0.pickpik.com/photos/298/434/513/beach-dawn-dusk-ocean-thumb.jpg",index:t})}t(!0)}),2500)}));return(e,a)=>{const o=p;return u(),i(_,null,{default:s((()=>[n(g,null,{default:s((()=>[n(b,{"font-size":30,_class:"font-weight-b",label:"基础示例,更多见文档，以下是展示你可以无限加载图片列表，你将看不到任何卡顿或者阻塞。超高性能的虚拟列表。"}),n(j),n(o,{class:"flex flex-col flex-col-top-center"},{default:s((()=>[n(E,{load:t,width:626,height:900,data:l.value,itemHeight:160},{default:s((({data:e})=>[(u(!0),h(y,null,x(e,((e,l)=>(u(),i(g,{border:1,borderDirection:"bottom",height:160,width:626,_class:"flex flex-row flex-row-center-start",padding:[0,0],margin:[0,0],key:l},{default:s((()=>[n(o,{class:"flex flex-row flex-row-center-between flex-1"},{default:s((()=>[n(w,{width:200,height:100,src:e.src},null,8,["src"]),n(b,{label:"image-Row-"+e.index},null,8,["label"])])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["data"])])),_:1})])),_:1})])),_:1})}}});export{$ as default};
