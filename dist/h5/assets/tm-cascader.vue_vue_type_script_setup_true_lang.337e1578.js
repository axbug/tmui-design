var e=(e,l,t)=>new Promise(((a,o)=>{var r=e=>{try{n(t.next(e))}catch(l){o(l)}},u=e=>{try{n(t.throw(e))}catch(l){o(l)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,u);n((t=t.apply(e,l)).next())}));import{d as l,g as t,O as a,c as o,r,ad as u,o as n,a as i,w as c,b as f,u as d,j as s,U as v,N as h,k as m,i as p,e as y,F as g,f as w,n as x,$ as C,m as b,at as k,Q as T,M as _,t as A,v as S}from"./index-6b165856.js";import{t as V}from"./tm-text.6c910eb0.js";import{t as $}from"./tm-icon.65b53dc0.js";import{t as j}from"./tm-sheet.3639b36a.js";const N=l({__name:"node-cell",props:{followTheme:{type:[Boolean,String],default:!0},data:{type:Object,default:()=>{},required:!0},color:{type:String,default:"primary"},level:{type:Number,default:0}},emits:["click"],setup(e,{emit:l}){var y,g,w;const x=e,C=null!=(g=null==(y=t())?void 0:y.proxy)?g:null;let b=null==C?void 0:C.$parent;for(;b&&"tmCascader"!=(null==b?void 0:b.tmCascaderName)&&b;)b=null!=(w=null==b?void 0:b.$parent)?w:null;const k=a("tmCascaderValue",o((()=>[]))),T=o((()=>x.data)),_=r("");u((()=>function(){let e=k.value.filter((e=>e==T.value.id));_.value=e.length>0?e[0]:""}()));const A=o((()=>_.value==T.value.id));function S(){var e,t,a;T.value.disabled||("object"==typeof(null==(e=T.value)?void 0:e.children)&&Array.isArray(null==(t=T.value)?void 0:t.children)&&(null==(a=T.value)?void 0:a.children.length)>0?null==b||b.addActiveIndex(x.level+1):m((()=>{null==b||b.endSelected()})),null==b||b.pushValue(T.value,x.level,T.value.id),l("click"))}return(e,l)=>{const t=p;return n(),i(t,{onClick:v(S,["stop"]),class:h(["flex px-24 py-24 border-b-1 flex-col-full",[d(T).disabled?"opacity-5":""]])},{default:c((()=>[f(t,{userInteractionEnabled:!1,class:"flex flex-row flex-between"},{default:c((()=>[f(V,{followTheme:!!d(A)&&x.followTheme,color:d(A)?x.color:"",label:d(T).text},null,8,["followTheme","color","label"]),f(t,{"font-size":30,class:"flex flex-row flex-row-center-end"},{default:c((()=>[d(A)?(n(),i($,{key:0,followTheme:!!d(A)&&x.followTheme,"font-size":28,color:d(A)?x.color:"",name:"tmicon-check"},null,8,["followTheme","color"])):s("v-if",!0),!d(A)&&d(T).children?(n(),i($,{key:1,"font-size":22,name:"tmicon-angle-right",color:"grey-1"})):s("v-if",!0)])),_:1})])),_:1})])),_:1},8,["onClick","class"])}}}),z=l({__name:"base-cascader",props:{followTheme:{type:[Boolean,String],default:!0},data:{type:Array,default:()=>[],required:!0},height:{type:Number,default:0,required:!0},color:{type:String,default:"primary"},level:{type:Number,default:0}},emits:["cellClick"],setup(e,{emit:l}){const t=e,v=o((()=>t.data)),h=t.level+1,m=a("tmCascaderShowIndex",o((()=>0))),b=a("tmCascaderValue",o((()=>[]))),k=r([]);function T(e){l("cellClick",e)}return u((()=>{var e,l,a,o;if(b.value[t.level]){let r=v.value.filter((e=>e.id==b.value[t.level]));r.length>0&&"object"==typeof(null==(e=r[0])?void 0:e.children)&&Array.isArray(null==(l=r[0])?void 0:l.children)&&(null==(a=r[0])?void 0:a.children.length)>0&&(k.value=null==(o=r[0])?void 0:o.children)}})),(e,l)=>{const a=p,o=C;return n(),y(g,null,[s(' v-if="tmCascaderShowIndex==_level" '),f(a,null,{default:c((()=>[d(m)==t.level?(n(),i(o,{key:0,style:x([{height:`${t.height}rpx`}]),"scroll-y":""},{default:c((()=>[(n(!0),y(g,null,w(d(v),((e,l)=>(n(),i(a,{key:l},{default:c((()=>[f(N,{followTheme:t.followTheme,level:t.level,data:e,onClick:l=>T(e)},null,8,["followTheme","level","data","onClick"])])),_:2},1024)))),128))])),_:1},8,["style"])):s("v-if",!0),k.value.length>0?(n(),i(z,{key:1,followTheme:t.followTheme,level:h,height:t.height,color:t.color,data:k.value,onCellClick:T},null,8,["followTheme","height","color","data"])):s("v-if",!0)])),_:1})],2112)}}});function I(e,l,t="text"){if(!e)return[];const a=[];for(const o of e)l.includes(o.id)&&a.push(o),a.push(...I(o.children,l,t));return a}const B=function(e=[],l="",t=[],a="id"){void 0===t&&(t=[]),Array.isArray(l)||(l=[l]);let o=Array.from(t);for(let r=0,u=e.length;r<u;r++){if(o.push(e[r][a]),e[r].id===l[0])return o;let t=e[r].children;if(t&&t.length){let e=B(t,l,o,a="id");if(e)return e}o.pop()}return""},q=function(e=[],l="",t="id"){let a=null;for(let o=0,r=e.length;o<r;o++){let r=e[o];if(r[t]==l&&r.children){a=r;break}if(r.children){let e=q(r.children,l,t="id");e&&(a=e)}}return a},F=l({__name:"tm-cascader",props:{followTheme:{type:[Boolean,String],default:!0},data:{type:Array,default:()=>[],required:!0},defaultValue:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]},height:{type:Number,default:650},activeColor:{type:String,default:"primary"},color:{type:String,default:"white"},beforeTabClick:{type:[Function,Boolean],default:()=>!1},beforeCellClick:{type:[Function,Boolean],default:()=>!1},slotTabHeigth:{type:Number,default:0}},emits:["update:modelValue","tab-click","cell-click","change"],setup(l,{expose:t,emit:a}){const u=l;let v=r(u.data);let h=r([]);const x=r(""),C=r([]),$=r([]),N=r(0),F=r(0);function H(e=!1){let l=uni.$tm.u.deepClone(u.data),t=uni.$tm.u.deepClone(u.modelValue);e&&(t=uni.$tm.u.deepClone(u.defaultValue));let a=Array.isArray(t)?t:[];if(x.value=0==a.length?"":a[a.length-1],""==x.value||void 0===x.value)return;if(q(l,String(x.value),"id"))return;let o=I(l,a,"text");C.value=t,o.length>0&&($.value=o.map((e=>e.text))),N.value=C.value.length?C.value.length-1:0,F.value=N.value}function O(){let e=uni.$tm.u.deepClone(C.value),[l]=e.reverse();return function(e,l="",t=[],a="id"){void 0===t&&(t=[]),Array.isArray(l)||(l=[l]);let o=Array.from(t);for(let r=0,u=e.length;r<u;r++){if(o.push(e[r]),e[r].id===l[0])return o;let t=e[r].children;if(t&&t.length){let e=B(t,l,o,"id");if(e)return e}o.pop()}return null}(uni.$tm.u.deepClone(u.data),String(l),[],"id")}function P(l){return e(this,null,(function*(){if("function"==typeof u.beforeTabClick){A({title:"..."});let e=yield u.beforeTabClick();if("function"==typeof e&&(e=yield e()),S(),!e)return}N.value=l,a("tab-click",l)}))}return b((()=>{m((()=>H(!0)))})),k("tmCascaderValue",o((()=>C.value))),k("tmCascaderShowIndex",o((()=>N.value))),T((()=>u.modelValue),(()=>{if(0==u.modelValue.length)return x.value="",h.value=[],C.value=[],$.value=[],N.value=0,void(F.value=0);H()}),{deep:!0}),T((()=>u.data),(()=>{h.value=[],N.value=0,F.value=0,C.value=[],$.value=[]}),{deep:!0}),t({pushValue:function(e,l,t){C.value.length<l?(C.value.push(t),$.value.push(e.text)):(C.value[l]=t,$.value.splice(l,1,e.text),m((()=>{C.value=C.value.slice(0,l+1),$.value=$.value.slice(0,l+1)})))},addActiveIndex:function(l){return e(this,null,(function*(){if("function"==typeof u.beforeCellClick){A({title:"..."});let e=yield u.beforeCellClick();if("function"==typeof e&&(e=yield u.beforeCellClick()),S(),!e)return}N.value=l,F.value=l}))},tmCascaderName:"tmCascader",getValueStr:function(){return O().map((e=>e.text))},getValueObject:O,endSelected:function(){a("update:modelValue",C.value),m((()=>{a("change",C.value)}))},reFresh:function(e=[]){v.value=[],Array.isArray(e)?v.value=e.length>0?e:u.data:console.error("需要提供数组格式")}}),(e,t)=>{const o=p;return n(),i(j,{color:u.color,height:u.height,padding:[0,0]},{default:c((()=>[f(j,{color:u.color,text:"",round:3,border:0,_class:"flex flex-row overflow",height:68,margin:[0,0],padding:[24,0]},{default:c((()=>[f(o,{style:{height:"68rpx"},class:"flex flex-row flex-row-center-start"},{default:c((()=>[(n(!0),y(g,null,w($.value,((e,l)=>(n(),i(o,{key:l,class:"flex flex-row flex-row-center-start"},{default:c((()=>[f(o,null,{default:c((()=>[f(V,{followTheme:N.value==l&&u.followTheme,fontSize:28,_class:"text-overflow-1",color:N.value==l?u.activeColor:"",label:e,onClick:e=>P(l)},null,8,["followTheme","color","label","onClick"])])),_:2},1024),l<C.value.length-1?(n(),i(o,{key:0,class:"mx-10"},{default:c((()=>[f(V,{followTheme:u.followTheme,label:"/",fontSize:24,color:u.activeColor},null,8,["followTheme","color"])])),_:1})):s("v-if",!0)])),_:2},1024)))),128)),F.value==C.value.length?(n(),i(V,{key:0,followTheme:N.value==F.value&&u.followTheme,color:N.value==F.value?u.activeColor:"",fontSize:28,_class:"ml-10",label:">请选择",onClick:t[0]||(t[0]=e=>P(F.value))},null,8,["followTheme","color"])):s("v-if",!0)])),_:1})])),_:1},8,["color"]),f(o,{style:{height:"16rpx"}}),l.slotTabHeigth?(n(),i(o,{key:0,class:"flex flex-row flex-row-center-start"},{default:c((()=>[_(e.$slots,"default")])),_:3})):s("v-if",!0),f(o,{style:{height:"16rpx"}}),f(z,{followTheme:u.followTheme,color:u.activeColor,height:u.height-120-l.slotTabHeigth,data:d(v),onCellClick:t[1]||(t[1]=e=>a("cell-click",e))},null,8,["followTheme","color","height","data"])])),_:3},8,["color","height"])}}});export{F as _};
