import{d as e,r as t,c as l,P as a,R as o,o as n,a as r,w as i,b as s,O as u,u as d,n as c,k as f,N as p,V as y,g as m,a3 as h,i as v,j as g}from"./index-5c06cf16.js";import{t as x}from"./tm-sheet.2873fe67.js";import{t as w}from"./tm-text.fdd4f0a8.js";import{t as b}from"./tm-icon.5716c798.js";import{t as k}from"./tm-translate.4fbb7927.js";import{c as _}from"./tm-app.20954b06.js";const I=e({__name:"tm-image",props:{..._,margin:{type:Array,default:()=>[0,0]},padding:{type:Array,default:()=>[0,0]},color:{type:String,default:"white"},transprent:{type:[Boolean,String],default:!0},border:{type:Number,default:0},width:{type:[Number],default:200,required:!0},height:{type:[Number],default:200,required:!0},src:{type:String,default:"",required:!0},errorIcon:{type:String,default:""},errorLabel:{type:String,default:"重新加载"},loadIcon:{type:String,default:""},showLoad:{type:Boolean,default:!0},preview:{type:[Boolean],default:!1},extra:{type:[Boolean],default:!1},extraPosition:{type:String,default:"in"},delete:{type:[Boolean],default:!1},allowDelete:{type:[Boolean],default:!0},model:{type:String,default:"scaleToFill"},unit:{type:String,default:"rpx"},showMenuByLongPress:{type:[Boolean],default:!1}},emits:["load","error","click","delete","close"],setup(e,{emit:_}){var I;const P=e,B=t(null),S=(null==(I=m())?void 0:I.proxy)??null;P.height||P.width||console.error("错误：图片宽度和高度必须设置一个");const L=l((()=>P.width)),j=l((()=>P.height-P.padding[1])),$=l((()=>P.src)),z=t(!0),C=t(!1),E=t(!1),K=t(P.loadIcon||"tmicon-shuaxin"),N=t(P.errorIcon||"tmicon-exclamation-circle");let q=null==S?void 0:S.$parent;for(;q&&"tmImageGroup"!=(null==q?void 0:q.tmImageGroup)&&q;)q=(null==q?void 0:q.$parent)??void 0;const G=a("ImagGrupList",l((()=>[])));function A(e){z.value=!1,_("load",e)}function D(e){console.error("图片加载错:"+P.src,e),C.value=!0,z.value=!1,_("error",e)}function M(e){if(_("click",e),P.preview){let e=G.value.length>0?G.value:[P.src];h({urls:e,current:P.src})}}async function V(){var e,t;E.value=!1,P.allowDelete?(null==(e=B.value)?void 0:e.play)?null==(t=B.value)||t.play():(E.value=!0,_("close",P.src)):_("delete",P.src)}function F(){E.value=!0,_("close",P.src)}function J(){z.value=!0,C.value=!1}return(null==q?void 0:q.pushKey)&&q.pushKey({width:L.value,height:L.value,src:P.src}),o($,(()=>{z.value=!0,C.value=!1,(null==q?void 0:q.pushKey)&&q.pushKey({width:L.value,height:L.value,src:P.src})})),(e,t)=>{const l=v,a=g;return E.value?f("v-if",!0):(n(),r(a,{key:0,style:c([{margin:P.margin[0]+P.unit+" "+(P.margin[1]||P.margin[0])+P.unit}])},{default:i((()=>[s(k,{width:d(L)+2*P.padding[0]+P.unit,onEnd:F,ref_key:"aniplay",ref:B,autoPlay:!1,name:"zoom",reverse:""},{default:i((()=>[s(x,{margin:[0],color:P.color,transprent:P.transprent,round:P.round,border:P.border,padding:[P.padding[0],0],class:u(["round-"+P.round]),width:d(L)-2*P.padding[0],unit:P.unit,height:d(j)-2*P.padding[0]},{default:i((()=>[s(a,{class:u([`pb-${P.padding[1]}`,"flex flex-col flex-col-center-center","relative"])},{default:i((()=>[C.value?f("v-if",!0):(n(),r(l,{key:0,onLoad:A,onError:D,"show-menu-by-longpress":P.showMenuByLongPress,onClick:M,class:u(["round-"+P.round,z.value?"opacity-0":""]),src:d($),style:c([{width:d(L)+P.unit,height:d(j)+P.unit}]),mode:P.model},null,8,["show-menu-by-longpress","class","src","style","mode"])),z.value&&!C.value?(n(),r(a,{key:1,style:c([{width:d(L)+P.unit,height:d(j)+10+P.unit}]),class:"flex flex-center opacity-3 absolute l-0 t-0"},{default:i((()=>[p(e.$slots,"load",{},(()=>[P.showLoad?(n(),r(b,{key:0,"font-size":26,spin:"",name:K.value},null,8,["name"])):f("v-if",!0)]))])),_:3},8,["style"])):f("v-if",!0),!z.value&&C.value?(n(),r(a,{key:2,style:c([{width:d(L)+P.unit,height:d(j)+P.unit}]),class:"flex flex-col flex-center opacity-5 absolute l-0 t-0"},{default:i((()=>[p(e.$slots,"error",{},(()=>[s(a,{onClick:J},{default:i((()=>[s(b,{userInteractionEnabled:!1,name:N.value},null,8,["name"]),s(w,{userInteractionEnabled:!1,_class:"pt-10","font-size":26,label:P.errorLabel},null,8,["label"])])),_:1})]))])),_:3},8,["style"])):f("v-if",!0),f(" extra "),P.extra?(n(),r(a,{key:3,eventPenetrationEnabled:!0,class:u(["in"==P.extraPosition?"absolute l-0 b-0 zIndex-5 ":"","flex flex-col flex-col-bottom-start "]),style:c([P.extra&&"in"==P.extraPosition?{height:d(j)+P.unit,width:d(L)+P.unit}:"",P.extra&&"out"==P.extraPosition?{width:d(L)+P.unit}:""])},{default:i((()=>[s(a,{onClick:y(M,["stop"]),class:u(["flex flex-col flex-col-bottom-start flex-1"]),style:c([P.extra&&"in"==P.extraPosition?{height:d(j)+P.unit,width:d(L)+P.unit}:"",P.extra&&"out"==P.extraPosition?{width:d(L)+P.unit}:""])},{default:i((()=>[p(e.$slots,"extra")])),_:3},8,["onClick","style"])])),_:3},8,["class","style"])):f("v-if",!0),f(" delete 展示删除按钮。 "),P.delete?(n(),r(a,{key:4,class:"absolute r-4 t-4 flex flex-col flex-col-center-end zIndex-10",style:c([P.delete?{width:d(L)+P.unit}:""])},{default:i((()=>[s(b,{onClick:V,color:"red",name:"tmicon-times-circle-fill"})])),_:1},8,["style"])):f("v-if",!0)])),_:3},8,["class"])])),_:3},8,["color","transprent","round","border","padding","class","width","unit","height"])])),_:3},8,["width"])])),_:3},8,["style"]))}}});export{I as _};
